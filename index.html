<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CyberGuard Quest - Gamified Cybersecurity Training</title>
    <link rel="icon" type="image/png" href="./logo.png">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
    <style>
        /* Global Styles */
        :root {
            --primary: #00ff9d;
            --secondary: #00b8ff;
            --accent: #ff00e6;
            --dark: #0a0e17;
            --darker: #050811;
            --light: #f0f8ff;
            --terminal: #0aff0a;
            --warning: #ff6b00;
            --danger: #ff003c;
            --success: #00ff9d;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: var(--darker);
            color: var(--light);
            overflow-x: hidden;
            background-image: 
                radial-gradient(circle at 10% 20%, rgba(0, 255, 157, 0.05) 0%, transparent 20%),
                radial-gradient(circle at 90% 80%, rgba(0, 184, 255, 0.05) 0%, transparent 20%);
            min-height: 100vh;
        }
        
        /* Typing Animation */
        @keyframes typing {
            from { width: 0; }
            to { width: 100%; }
        }
        
        @keyframes blink {
            0%, 100% { border-color: transparent; }
            50% { border-color: var(--terminal); }
        }
        
        /* Terminal Scan Line */
        @keyframes scanline {
            0% { transform: translateY(-100%); }
            100% { transform: translateY(100vh); }
        }
        
        /* Glowing Effects */
        @keyframes glow {
            0%, 100% { text-shadow: 0 0 5px var(--primary), 0 0 10px var(--primary); }
            50% { text-shadow: 0 0 10px var(--primary), 0 0 20px var(--primary); }
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }
        
        /* Welcome Modal Specific Styles */
        .welcome-form {
            margin-top: 1.5rem;
        }
        
        .form-group {
            margin-bottom: 1.5rem;
        }
        
        .form-label {
            display: block;
            margin-bottom: 0.5rem;
            color: var(--light);
            font-size: 1.1rem;
        }
        
        .form-input {
            width: 100%;
            padding: 0.8rem 1rem;
            background-color: rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(0, 255, 157, 0.3);
            border-radius: 5px;
            color: var(--light);
            font-size: 1rem;
            transition: all 0.3s;
        }
        
        .form-input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 10px rgba(0, 255, 157, 0.5);
        }
        
        .avatar-options {
            display: flex;
            flex-wrap: wrap;
            gap: 1rem;
            margin: 1rem 0;
            justify-content: center;
        }
        
        .avatar-option {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background-color: rgba(0, 255, 157, 0.1);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            color: var(--primary);
            cursor: pointer;
            transition: all 0.3s;
            border: 2px solid transparent;
        }
        
        .avatar-option:hover {
            background-color: rgba(0, 255, 157, 0.2);
        }
        
        .avatar-option.selected {
            border-color: var(--primary);
            background-color: rgba(0, 255, 157, 0.3);
        }
        
        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }
        
        .modal.active {
            display: flex;
        }
        
        .modal-content {
            background-color: var(--dark);
            border: 2px solid var(--primary);
            border-radius: 10px;
            width: 90%;
            max-width: 800px;
            max-height: 90vh;
            overflow-y: auto;
            position: relative;
            box-shadow: 0 0 30px rgba(0, 255, 157, 0.3);
        }
        
        .modal-header {
            background: linear-gradient(to right, rgba(0, 255, 157, 0.1), rgba(0, 184, 255, 0.1));
            padding: 1.5rem;
            border-bottom: 1px solid rgba(0, 255, 157, 0.3);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .modal-title {
            font-size: 1.8rem;
            color: var(--primary);
        }
        
        .modal-close {
            background: none;
            border: none;
            color: var(--light);
            font-size: 1.5rem;
            cursor: pointer;
            transition: color 0.3s;
        }
        
        .modal-close:hover {
            color: var(--primary);
        }
        
        .modal-body {
            padding: 2rem;
        }
        
        /* Game Modal Styles */
        .game-modal {
            max-width: 900px;
        }
        
        .game-modal .modal-body {
            max-height: 70vh;
            overflow-y: auto;
        }
        
        /* Drag and Drop Styles */
        .drag-drop-container {
            display: flex;
            gap: 2rem;
            margin: 1rem 0;
        }
        
        .drag-source, .drop-target {
            flex: 1;
            min-height: 200px;
            border: 2px dashed rgba(0, 255, 157, 0.3);
            border-radius: 8px;
            padding: 1rem;
        }
        
        .drag-item {
            background-color: rgba(0, 184, 255, 0.2);
            border: 1px solid rgba(0, 184, 255, 0.3);
            padding: 0.8rem;
            margin: 0.5rem 0;
            border-radius: 5px;
            cursor: grab;
            transition: all 0.3s;
        }
        
        .drag-item:hover {
            background-color: rgba(0, 184, 255, 0.3);
            transform: translateY(-2px);
        }
        
        .drag-item.dragging {
            opacity: 0.5;
        }
        
        /* Network Map Styles */
        .network-map {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 1rem;
            margin: 1rem 0;
        }
        
        .network-node {
            background-color: rgba(0, 0, 0, 0.3);
            border: 2px solid rgba(0, 255, 157, 0.2);
            border-radius: 8px;
            padding: 1rem;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .network-node:hover {
            border-color: var(--primary);
            transform: scale(1.05);
        }
        
        .network-node.vulnerable {
            border-color: var(--danger);
            animation: pulse 1s infinite;
        }
        
        .network-node.secure {
            border-color: var(--success);
        }
        
        /* Hash Matching Styles */
        .hash-pairs {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
            margin: 1rem 0;
        }
        
        .hash-item {
            background-color: rgba(0, 0, 0, 0.3);
            border: 2px solid rgba(0, 255, 157, 0.2);
            border-radius: 8px;
            padding: 1rem;
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
            font-family: monospace;
        }
        
        .hash-item:hover {
            border-color: var(--primary);
        }
        
        .hash-item.selected {
            border-color: var(--warning);
            background-color: rgba(255, 107, 0, 0.1);
        }
        
        .hash-item.matched {
            border-color: var(--success);
            background-color: rgba(0, 255, 157, 0.1);
        }
        
        /* Navbar */
        .navbar {
            background-color: rgba(5, 8, 17, 0.9);
            border-bottom: 1px solid rgba(0, 255, 157, 0.2);
            padding: 1rem 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            z-index: 100;
            backdrop-filter: blur(10px);
        }
        
        .logo {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .logo-icon {
            color: var(--primary);
            font-size: 2rem;
            animation: glow 2s infinite;
        }
        
        .logo-text {
            font-size: 1.8rem;
            font-weight: 700;
            background: linear-gradient(to right, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
        }
        
        .nav-links {
            display: flex;
            gap: 2rem;
        }
        
        .nav-link {
            color: var(--light);
            text-decoration: none;
            font-weight: 500;
            padding: 0.5rem 1rem;
            border-radius: 4px;
            transition: all 0.3s;
            position: relative;
        }
        
        .nav-link:hover {
            background-color: rgba(0, 255, 157, 0.1);
            color: var(--primary);
        }
        
        .nav-link.active {
            background-color: rgba(0, 255, 157, 0.15);
            color: var(--primary);
        }
        
        .nav-link.active::after {
            content: '';
            position: absolute;
            bottom: -5px;
            left: 10%;
            width: 80%;
            height: 2px;
            background-color: var(--primary);
        }
        
        .user-profile {
            display: flex;
            align-items: center;
            gap: 1rem;
        }
        
        .xp-indicator {
            background-color: rgba(0, 0, 0, 0.3);
            border-radius: 20px;
            padding: 0.3rem 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            border: 1px solid rgba(0, 255, 157, 0.3);
        }
        
        .xp-icon {
            color: gold;
        }
        
        .level-badge {
            background: linear-gradient(to bottom right, #00ff9d, #00b8ff);
            color: var(--darker);
            font-weight: bold;
            padding: 0.3rem 0.8rem;
            border-radius: 20px;
            font-size: 0.9rem;
        }
        
        /* Save Menu Styles */
        .save-menu {
            display: flex;
            gap: 0.5rem;
            margin-left: 1rem;
        }
        
        .save-menu .btn {
            padding: 0.5rem 0.8rem;
            font-size: 0.9rem;
        }
        
        /* Main Content */
        .main-content {
            padding: 2rem;
            max-width: 1400px;
            margin: 0 auto;
            position: relative;
            min-height: calc(100vh - 100px);
        }
        
        .page {
            display: none;
            animation: fadeIn 0.5s;
        }
        
        .page.active {
            display: block;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        /* Footer */
        .footer {
            margin-top: 3rem;
            padding-top: 1.5rem;
            border-top: 1px solid rgba(0, 255, 157, 0.1);
            text-align: center;
            color: rgba(255, 255, 255, 0.5);
            font-size: 0.8rem;
        }
        
        .footer a {
            color: var(--primary);
            text-decoration: none;
        }
        
        /* Dashboard */
        .dashboard-header {
            margin-bottom: 2rem;
        }
        
        .dashboard-header h1 {
            font-size: 2.5rem;
            margin-bottom: 0.5rem;
            background: linear-gradient(to right, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
        }
        
        .dashboard-header p {
            color: #a0aec0;
            font-size: 1.1rem;
            max-width: 600px;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }
        
        .stat-card {
            background: rgba(10, 14, 23, 0.8);
            border: 1px solid rgba(0, 255, 157, 0.1);
            border-radius: 10px;
            padding: 1.5rem;
            transition: all 0.3s;
            position: relative;
            overflow: hidden;
        }
        
        .stat-card:hover {
            transform: translateY(-5px);
            border-color: rgba(0, 255, 157, 0.3);
            box-shadow: 0 10px 20px rgba(0, 255, 157, 0.1);
        }
        
        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 4px;
            background: linear-gradient(to right, var(--primary), var(--secondary));
        }
        
        .stat-title {
            color: #a0aec0;
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 0.5rem;
        }
        
        .stat-value {
            font-size: 2rem;
            font-weight: 700;
            color: var(--light);
        }
        
        .missions-section {
            margin-top: 2rem;
        }
        
        .section-title {
            font-size: 1.8rem;
            margin-bottom: 1.5rem;
            color: var(--light);
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .section-title i {
            color: var(--primary);
        }
        
        .missions-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 1.5rem;
        }
        
        .mission-card {
            background: rgba(10, 14, 23, 0.8);
            border: 1px solid rgba(0, 255, 157, 0.1);
            border-radius: 10px;
            padding: 1.5rem;
            transition: all 0.3s;
            position: relative;
            overflow: hidden;
        }
        
        .mission-card:hover {
            transform: translateY(-5px);
            border-color: rgba(0, 255, 157, 0.3);
            box-shadow: 0 10px 20px rgba(0, 255, 157, 0.1);
        }
        
        .mission-card.completed {
            border-color: rgba(0, 255, 157, 0.5);
        }
        
        .mission-card.completed::before {
            content: 'COMPLETED';
            position: absolute;
            top: 10px;
            right: -30px;
            background-color: var(--success);
            color: var(--darker);
            font-size: 0.7rem;
            font-weight: bold;
            padding: 3px 30px;
            transform: rotate(45deg);
        }
        
        .mission-card.active {
            border-color: var(--warning);
            animation: pulse 2s infinite;
        }
        
        .mission-card.locked {
            opacity: 0.6;
            filter: grayscale(0.7);
        }
        
        .mission-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 1rem;
        }
        
        .mission-icon {
            font-size: 2rem;
            color: var(--primary);
            background-color: rgba(0, 255, 157, 0.1);
            width: 60px;
            height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 10px;
        }
        
        .mission-xp {
            background-color: rgba(255, 215, 0, 0.1);
            color: gold;
            padding: 0.3rem 0.8rem;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 5px;
        }
        
        .mission-title {
            font-size: 1.3rem;
            margin-bottom: 0.5rem;
            color: var(--light);
        }
        
        .mission-desc {
            color: #a0aec0;
            margin-bottom: 1.5rem;
            line-height: 1.5;
        }
        
        .mission-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            margin-bottom: 1.5rem;
        }
        
        .mission-tag {
            background-color: rgba(0, 184, 255, 0.1);
            color: var(--secondary);
            padding: 0.3rem 0.8rem;
            border-radius: 20px;
            font-size: 0.8rem;
        }
        
        .mission-btn {
            width: 100%;
            padding: 0.8rem;
            background: linear-gradient(to right, var(--primary), var(--secondary));
            color: var(--darker);
            border: none;
            border-radius: 5px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .mission-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 255, 157, 0.3);
        }
        
        .mission-btn:disabled {
            background: #4a5568;
            color: #a0aec0;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        /* Mini-games */
        .games-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 2rem;
        }
        
        .game-card {
            background: rgba(10, 14, 23, 0.8);
            border: 1px solid rgba(0, 255, 157, 0.1);
            border-radius: 10px;
            padding: 1.5rem;
            transition: all 0.3s;
        }
        
        .game-card:hover {
            transform: translateY(-5px);
            border-color: rgba(0, 255, 157, 0.3);
            box-shadow: 0 10px 20px rgba(0, 255, 157, 0.1);
        }
        
        .game-header {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-bottom: 1.5rem;
        }
        
        .game-icon {
            font-size: 2.5rem;
            color: var(--accent);
        }
        
        .game-title {
            font-size: 1.5rem;
            color: var(--light);
        }
        
        .game-desc {
            color: #a0aec0;
            margin-bottom: 1.5rem;
            line-height: 1.5;
        }
        
        .game-ui {
            background-color: rgba(0, 0, 0, 0.3);
            border-radius: 8px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            border: 1px solid rgba(255, 255, 255, 0.05);
            min-height: 200px;
            display: flex;
            flex-direction: column;
        }
        
        /* Mission Interface */
        .mission-objective {
            background-color: rgba(0, 0, 0, 0.2);
            border-left: 4px solid var(--primary);
            padding: 1rem;
            margin-bottom: 1.5rem;
            border-radius: 0 5px 5px 0;
        }
        
        .objective-title {
            font-weight: 600;
            color: var(--primary);
            margin-bottom: 0.5rem;
        }
        
        .task-list {
            list-style-type: none;
            margin: 1rem 0;
        }
        
        .task-item {
            padding: 0.5rem 0;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .task-item.completed {
            color: var(--success);
        }
        
        .task-item i.fa-check {
            color: var(--success);
        }
        
        .mission-question {
            background-color: rgba(0, 0, 0, 0.2);
            padding: 1.5rem;
            border-radius: 8px;
            margin: 1.5rem 0;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .question-text {
            font-size: 1.1rem;
            margin-bottom: 1rem;
            color: var(--light);
        }
        
        .options-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 1rem;
            margin: 1.5rem 0;
        }
        
        .option-btn {
            background-color: rgba(0, 184, 255, 0.1);
            border: 1px solid rgba(0, 184, 255, 0.3);
            color: var(--light);
            padding: 1rem;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s;
            text-align: left;
        }
        
        .option-btn:hover {
            background-color: rgba(0, 184, 255, 0.2);
            transform: translateY(-2px);
        }
        
        .option-btn.selected {
            background-color: rgba(0, 255, 157, 0.2);
            border-color: rgba(0, 255, 157, 0.5);
            color: var(--primary);
        }
        
        .option-btn.correct {
            background-color: rgba(0, 255, 157, 0.3);
            border-color: var(--success);
            color: var(--success);
        }
        
        .option-btn.incorrect {
            background-color: rgba(255, 0, 60, 0.2);
            border-color: var(--danger);
            color: var(--danger);
        }
        
        .mission-controls {
            display: flex;
            gap: 1rem;
            margin-top: 2rem;
            padding-top: 1.5rem;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .btn {
            padding: 0.8rem 1.5rem;
            border: none;
            border-radius: 5px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .btn-primary {
            background: linear-gradient(to right, var(--primary), var(--secondary));
            color: var(--darker);
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 255, 157, 0.3);
        }
        
        .btn-secondary {
            background-color: rgba(255, 255, 255, 0.1);
            color: var(--light);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .btn-secondary:hover {
            background-color: rgba(255, 255, 255, 0.2);
        }
        
        .btn-danger {
            background-color: rgba(255, 0, 60, 0.2);
            color: var(--danger);
            border: 1px solid rgba(255, 0, 60, 0.3);
        }
        
        .btn-danger:hover {
            background-color: rgba(255, 0, 60, 0.3);
        }
        
        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none !important;
            box-shadow: none !important;
        }
        
        /* Game Controls */
        .game-controls {
            display: flex;
            gap: 1rem;
            margin-top: 1.5rem;
            flex-wrap: wrap;
        }
        
        .game-btn {
            flex: 1;
            min-width: 120px;
            padding: 0.8rem;
            background-color: rgba(0, 184, 255, 0.2);
            color: var(--secondary);
            border: 1px solid rgba(0, 184, 255, 0.3);
            border-radius: 5px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .game-btn:hover {
            background-color: rgba(0, 184, 255, 0.3);
        }
        
        .game-btn.primary {
            background-color: rgba(0, 255, 157, 0.2);
            color: var(--primary);
            border-color: rgba(0, 255, 157, 0.3);
        }
        
        .game-btn.primary:hover {
            background-color: rgba(0, 255, 157, 0.3);
        }
        
        /* Certificate Styles */
        .certificate-modal .modal-content {
            max-width: 800px;
        }
        
        .certificate {
            background: linear-gradient(135deg, #0a0e17 0%, #050811 100%);
            border: 3px solid var(--primary);
            border-radius: 15px;
            padding: 3rem;
            text-align: center;
            color: white;
            position: relative;
            overflow: hidden;
        }
        
        .certificate::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="100" height="100" viewBox="0 0 100 100"><rect width="100" height="100" fill="none" stroke="%2300ff9d" stroke-width="0.5" opacity="0.1"/></svg>');
            opacity: 0.1;
            z-index: 0;
        }
        
        .certificate-header {
            position: relative;
            z-index: 1;
            margin-bottom: 2rem;
        }
        
        .certificate-header h2 {
            font-size: 3rem;
            color: var(--primary);
            margin-bottom: 0.5rem;
            text-transform: uppercase;
            letter-spacing: 3px;
        }
        
        .certificate-header h3 {
            font-size: 1.5rem;
            color: var(--secondary);
            margin-bottom: 2rem;
        }
        
        .certificate-body {
            position: relative;
            z-index: 1;
            margin: 2rem 0;
            padding: 2rem;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
            border: 1px solid rgba(0, 255, 157, 0.2);
        }
        
        .certificate-body h4 {
            font-size: 2rem;
            color: var(--light);
            margin-bottom: 1rem;
        }
        
        .certificate-body p {
            font-size: 1.2rem;
            color: #a0aec0;
            margin-bottom: 0.5rem;
        }
        
        .certificate-footer {
            position: relative;
            z-index: 1;
            margin-top: 2rem;
            padding-top: 2rem;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .signature-area {
            display: flex;
            justify-content: space-between;
            margin-top: 2rem;
        }
        
        .signature {
            text-align: center;
        }
        
        .signature-line {
            width: 200px;
            height: 1px;
            background: white;
            margin: 0.5rem auto;
        }
        
        .certificate-seal {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 10rem;
            color: rgba(255, 215, 0, 0.1);
            z-index: 0;
        }
        
        /* Learning Hub */
        .hub-container {
            display: grid;
            grid-template-columns: 250px 1fr;
            gap: 2rem;
        }
        
        .hub-sidebar {
            background: rgba(10, 14, 23, 0.8);
            border-radius: 10px;
            padding: 1.5rem;
            border: 1px solid rgba(0, 255, 157, 0.1);
            height: fit-content;
        }
        
        .hub-category {
            margin-bottom: 1.5rem;
        }
        
        .hub-category-title {
            font-size: 1.2rem;
            margin-bottom: 1rem;
            color: var(--primary);
            padding-bottom: 0.5rem;
            border-bottom: 1px solid rgba(0, 255, 157, 0.2);
        }
        
        .hub-topic {
            padding: 0.8rem;
            border-radius: 5px;
            margin-bottom: 0.5rem;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .hub-topic:hover {
            background-color: rgba(0, 255, 157, 0.1);
            color: var(--primary);
        }
        
        .hub-topic.active {
            background-color: rgba(0, 255, 157, 0.15);
            color: var(--primary);
            font-weight: 600;
        }
        
        .hub-content {
            background: rgba(10, 14, 23, 0.8);
            border-radius: 10px;
            padding: 2rem;
            border: 1px solid rgba(0, 255, 157, 0.1);
        }
        
        .hub-content-title {
            font-size: 1.8rem;
            margin-bottom: 1.5rem;
            color: var(--light);
        }
        
        .hub-content-body {
            line-height: 1.6;
            color: #cbd5e0;
        }
        
        .hub-content-body h3 {
            margin: 1.5rem 0 0.8rem;
            color: var(--primary);
        }
        
        .hub-content-body p {
            margin-bottom: 1rem;
        }
        
        .hub-content-body ul, .hub-content-body ol {
            margin-left: 1.5rem;
            margin-bottom: 1rem;
        }
        
        .hub-content-body li {
            margin-bottom: 0.5rem;
        }
        
        /* Profile Page */
        .profile-container {
            display: grid;
            grid-template-columns: 300px 1fr;
            gap: 2rem;
        }
        
        .profile-sidebar {
            background: rgba(10, 14, 23, 0.8);
            border-radius: 10px;
            padding: 2rem;
            border: 1px solid rgba(0, 255, 157, 0.1);
            text-align: center;
        }
        
        .profile-avatar {
            width: 150px;
            height: 150px;
            border-radius: 50%;
            background: linear-gradient(to bottom right, var(--primary), var(--secondary));
            margin: 0 auto 1.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 3.5rem;
            color: var(--darker);
            cursor: pointer;
            position: relative;
            overflow: hidden;
        }
        
        .profile-avatar input {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            opacity: 0;
            cursor: pointer;
        }
        
        .profile-name {
            font-size: 1.8rem;
            margin-bottom: 0.5rem;
            color: var(--light);
            cursor: pointer;
            padding: 0.5rem;
            border-radius: 5px;
            transition: background-color 0.3s;
        }
        
        .profile-name:hover {
            background-color: rgba(255, 255, 255, 0.1);
        }
        
        .profile-name-input {
            background-color: transparent;
            border: 2px solid var(--primary);
            color: var(--light);
            font-size: 1.8rem;
            text-align: center;
            width: 100%;
            padding: 0.5rem;
            border-radius: 5px;
            outline: none;
        }
        
        .profile-title {
            color: var(--primary);
            font-weight: 600;
            margin-bottom: 1.5rem;
            padding: 0.5rem 1rem;
            background-color: rgba(0, 255, 157, 0.1);
            border-radius: 20px;
            display: inline-block;
        }
        
        .profile-stats {
            margin-top: 1.5rem;
        }
        
        .profile-stat {
            display: flex;
            justify-content: space-between;
            padding: 0.8rem 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        }
        
        .profile-stat:last-child {
            border-bottom: none;
        }
        
        .profile-content {
            background: rgba(10, 14, 23, 0.8);
            border-radius: 10px;
            padding: 2rem;
            border: 1px solid rgba(0, 255, 157, 0.1);
        }
        
        .progress-section {
            margin-bottom: 2rem;
        }
        
        .progress-bar {
            height: 10px;
            background-color: rgba(255, 255, 255, 0.1);
            border-radius: 5px;
            margin-top: 0.5rem;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(to right, var(--primary), var(--secondary));
            border-radius: 5px;
            width: 0%;
            transition: width 1s ease-in-out;
        }
        
        .badges-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            gap: 1.5rem;
            margin-top: 1.5rem;
        }
        
        .badge {
            background-color: rgba(0, 0, 0, 0.2);
            border-radius: 10px;
            padding: 1rem;
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.05);
            transition: all 0.3s;
            position: relative;
        }
        
        .badge.earned {
            border-color: rgba(255, 215, 0, 0.5);
            box-shadow: 0 0 15px rgba(255, 215, 0, 0.2);
        }
        
        .badge-icon {
            font-size: 2.5rem;
            margin-bottom: 0.5rem;
            color: #a0aec0;
        }
        
        .badge.earned .badge-icon {
            color: gold;
        }
        
        .badge-title {
            font-size: 0.9rem;
            color: var(--light);
        }
        
        .badge-description {
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.9);
            padding: 0.5rem;
            border-radius: 5px;
            font-size: 0.8rem;
            width: 200px;
            display: none;
            z-index: 10;
            border: 1px solid var(--primary);
        }
        
        .badge:hover .badge-description {
            display: block;
        }
        
        /* Scan Line Effect */
        .scan-line {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 2px;
            background: linear-gradient(to right, transparent, rgba(0, 255, 157, 0.5), transparent);
            animation: scanline 8s linear infinite;
            pointer-events: none;
            z-index: 999;
        }
        
        /* Notification */
        .notification {
            position: fixed;
            top: 100px;
            right: 20px;
            background: rgba(10, 14, 23, 0.95);
            border-left: 4px solid var(--primary);
            padding: 1rem;
            border-radius: 5px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            transform: translateX(400px);
            transition: transform 0.5s;
            z-index: 1000;
            max-width: 300px;
        }
        
        .notification.show {
            transform: translateX(0);
        }
        
        .notification-title {
            font-weight: 600;
            color: var(--primary);
            margin-bottom: 0.5rem;
        }
        
        .notification-message {
            color: #a0aec0;
            font-size: 0.9rem;
        }
        
        /* Responsive Design */
        @media (max-width: 1100px) {
            .hub-container, .profile-container {
                grid-template-columns: 1fr;
            }
            
            .nav-links {
                gap: 1rem;
            }
            
            .games-grid {
                grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            }
            
            .drag-drop-container {
                flex-direction: column;
            }
            
            .save-menu {
                margin-left: 0;
                margin-top: 0.5rem;
                justify-content: center;
            }
        }
        
        @media (max-width: 768px) {
            .navbar {
                flex-direction: column;
                gap: 1rem;
                padding: 1rem;
            }
            
            .nav-links {
                flex-wrap: wrap;
                justify-content: center;
            }
            
            .main-content {
                padding: 1rem;
            }
            
            .games-grid {
                grid-template-columns: 1fr;
            }
            
            .stats-grid, .missions-grid {
                grid-template-columns: 1fr;
            }
            
            .options-grid {
                grid-template-columns: 1fr;
            }
            
            .game-controls {
                flex-direction: column;
            }
            
            .game-btn {
                min-width: 100%;
            }
            
            .certificate-body h4 {
                font-size: 1.5rem;
            }
            
            .signature-area {
                flex-direction: column;
                gap: 1rem;
            }
            
            .hash-pairs {
                grid-template-columns: 1fr;
            }
            
            .network-map {
                grid-template-columns: 1fr;
            }
            
            .user-profile {
                flex-direction: column;
                gap: 0.5rem;
            }
            
            .save-menu {
                order: -1;
                width: 100%;
                justify-content: center;
            }
        }
    </style>
</head>
<body>
    <!-- Scan Line Effect -->
    <div class="scan-line"></div>
    
    <!-- Notification -->
    <div class="notification" id="notification">
        <div class="notification-title" id="notification-title">Welcome!</div>
        <div class="notification-message" id="notification-message">Complete your first mission to earn XP!</div>
    </div>
    
    <!-- Welcome Modal -->
    <div class="modal welcome-modal" id="welcome-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Welcome to CyberGuard Quest!</h2>
            </div>
            <div class="modal-body">
                <p>Welcome, new agent! Before you begin your cybersecurity training, we need to set up your profile.</p>
                
                <form class="welcome-form" id="welcome-form">
                    <div class="form-group">
                        <label class="form-label" for="agent-name">Your Agent Name</label>
                        <input type="text" id="agent-name-input" class="form-input" placeholder="Enter your agent name" required>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Choose Your Avatar</label>
                        <div class="avatar-options">
                            <div class="avatar-option selected" data-avatar="1">
                                <i class="fas fa-user-secret"></i>
                            </div>
                            <div class="avatar-option" data-avatar="2">
                                <i class="fas fa-user-ninja"></i>
                            </div>
                            <div class="avatar-option" data-avatar="3">
                                <i class="fas fa-user-shield"></i>
                            </div>
                            <div class="avatar-option" data-avatar="4">
                                <i class="fas fa-robot"></i>
                            </div>
                            <div class="avatar-option" data-avatar="5">
                                <i class="fas fa-hat-wizard"></i>
                            </div>
                            <div class="avatar-option" data-avatar="6">
                                <i class="fas fa-mask"></i>
                            </div>
                        </div>
                    </div>
                    
                    <div class="mission-controls">
                        <button type="submit" class="btn btn-primary">Start Training</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
    
    <!-- Mission Modal -->
    <div class="modal" id="mission-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title" id="mission-modal-title">Mission: Phishing Detection</h2>
                <button class="modal-close" id="mission-close">&times;</button>
            </div>
            <div class="modal-body" id="mission-modal-body">
                <!-- Mission content will be loaded here -->
            </div>
        </div>
    </div>
    
    <!-- Game Modal -->
    <div class="modal game-modal" id="game-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title" id="game-modal-title">Mini-Game</h2>
                <button class="modal-close" id="game-close">&times;</button>
            </div>
            <div class="modal-body" id="game-modal-body">
                <!-- Game content will be loaded here -->
            </div>
        </div>
    </div>
    
    <!-- Certificate Modal -->
    <div class="modal certificate-modal" id="certificate-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Cybersecurity Expert Certification</h2>
                <button class="modal-close" id="certificate-close">&times;</button>
            </div>
            <div class="modal-body">
                <div class="certificate" id="certificate">
                    <div class="certificate-seal">
                        <i class="fas fa-shield-alt"></i>
                    </div>
                    <div class="certificate-header">
                        <h2>CyberGuard Organization</h2>
                        <h3>Presents This Certificate To</h3>
                    </div>
                    
                    <div class="certificate-body">
                        <h4 id="certificate-name">Agent Name</h4>
                        <p>For successfully completing the Cybersecurity Training Program</p>
                        <p>and demonstrating exceptional skills in threat detection,</p>
                        <p>network security, and cyber defense strategies.</p>
                        
                        <div style="margin-top: 2rem;">
                            <p><strong>Date of Issue:</strong> <span id="certificate-date">Today</span></p>
                            <p><strong>Certificate ID:</strong> <span id="certificate-id">CG-2025-001</span></p>
                        </div>
                    </div>
                    
                    <div class="certificate-footer">
                        <div class="signature-area">
                            <div class="signature">
                                <p>Director</p>
                                <div class="signature-line"></div>
                                <p><strong>Sirojiddinov Khudoyor Davronovich</strong></p>
                                <p>Director, CyberGuard Organization</p>
                            </div>
                            
                            <div class="signature">
                                <p>Training Director</p>
                                <div class="signature-line"></div>
                                <p><strong>CyberGuard Training Division</strong></p>
                                <p>CyberGuard Organization</p>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="mission-controls" style="justify-content: center; margin-top: 2rem;">
                    <button class="btn btn-primary" id="download-certificate-btn">
                        <i class="fas fa-download"></i> Download as PDF
                    </button>
                    <button class="btn btn-secondary" id="close-certificate-btn">Close</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Navigation Bar -->
    <nav class="navbar" style="display: none;" id="navbar">
        <div class="logo">
            <i class="fas fa-shield-alt logo-icon"></i>
            <span class="logo-text">CyberGuard Quest</span>
        </div>
        
        <div class="nav-links">
            <a href="#" class="nav-link active" data-page="dashboard">
                <i class="fas fa-home"></i> Dashboard
            </a>
            <a href="#" class="nav-link" data-page="missions">
                <i class="fas fa-tasks"></i> Missions
            </a>
            <a href="#" class="nav-link" data-page="games">
                <i class="fas fa-gamepad"></i> Mini-Games
            </a>
            <a href="#" class="nav-link" data-page="hub">
                <i class="fas fa-book-open"></i> Learning Hub
            </a>
            <a href="#" class="nav-link" data-page="profile">
                <i class="fas fa-user"></i> Profile
            </a>
        </div>
        
        <div class="user-profile">
            <div class="xp-indicator">
                <i class="fas fa-star xp-icon"></i>
                <span id="xp-count">0</span> XP
            </div>
            <div class="level-badge" id="level-badge">Level 1</div>
        </div>
        
        <!-- Save Menu Buttons -->
        <div class="save-menu">
            <button class="btn btn-secondary" id="save-game-btn" title="Save Progress">
                <i class="fas fa-save"></i> Save
            </button>
            <button class="btn btn-secondary" id="load-game-btn" title="Load Progress">
                <i class="fas fa-folder-open"></i> Load
            </button>
            <button class="btn btn-danger" id="reset-game-btn" title="Reset Progress">
                <i class="fas fa-trash-alt"></i> Reset
            </button>
        </div>
    </nav>
    
    <!-- Main Content -->
    <div class="main-content" style="display: none;" id="main-content">
        <!-- Dashboard Page -->
        <div class="page active" id="dashboard">
            <div class="dashboard-header">
                <h1>Welcome, Agent <span id="agent-name-display">Agent</span>!</h1>
                <p>Your mission: Protect the digital world from cyber threats. Complete missions, play mini-games, and level up your cybersecurity skills.</p>
            </div>
            
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-title">Completed Missions</div>
                    <div class="stat-value" id="completed-missions">0/20</div>
                </div>
                <div class="stat-card">
                    <div class="stat-title">Total XP</div>
                    <div class="stat-value" id="total-xp">0</div>
                </div>
                <div class="stat-card">
                    <div class="stat-title">Current Rank</div>
                    <div class="stat-value" id="current-rank">Cyber Novice</div>
                </div>
                <div class="stat-card">
                    <div class="stat-title">Badges Earned</div>
                    <div class="stat-value" id="badges-earned">0/25</div>
                </div>
            </div>
            
            <div class="missions-section">
                <h2 class="section-title"><i class="fas fa-rocket"></i> Active Missions</h2>
                <div class="missions-grid" id="dashboard-missions">
                    <!-- Mission cards will be loaded here -->
                </div>
            </div>
            
            <div class="footer">
                <p>Created by <strong>Sirojiddinov Khudoyor Davronovich</strong> for educational purposes</p>
                <p>CyberGuard Organization © 2025</p>
            </div>
        </div>
        
        <!-- Missions Page -->
        <div class="page" id="missions">
            <div class="dashboard-header">
                <h1>Case Files</h1>
                <p>Complete missions to level up your cybersecurity skills and progress through the ranks.</p>
            </div>
            
            <div class="missions-grid" id="missions-grid">
                <!-- Mission cards will be loaded here -->
            </div>
            
            <div class="footer">
                <p>Created by <strong>Sirojiddinov Khudoyor Davronovich</strong> for educational purposes</p>
                <p>CyberGuard Organization © 2025</p>
            </div>
        </div>
        
        <!-- Mini-Games Page -->
        <div class="page" id="games">
            <div class="dashboard-header">
                <h1>Training Simulations</h1>
                <p>Practice your cybersecurity skills with these interactive mini-games and simulations.</p>
            </div>
            
            <div class="games-grid">
                <!-- Phishing Hunter Game -->
                <div class="game-card">
                    <div class="game-header">
                        <i class="fas fa-fish game-icon"></i>
                        <div>
                            <h3 class="game-title">Phishing Hunter</h3>
                            <div class="mission-tags">
                                <span class="mission-tag">Email Security</span>
                                <span class="mission-tag">Social Engineering</span>
                            </div>
                        </div>
                    </div>
                    <p class="game-desc">Identify which emails are legitimate and which are phishing attempts. Look for suspicious senders, URLs, and requests.</p>
                    
                    <div class="mission-controls">
                        <button class="btn btn-primary start-game-btn" data-game="phishing">
                            <i class="fas fa-play"></i> Start Game
                        </button>
                    </div>
                </div>
                
                <!-- Password Cracker Game -->
                <div class="game-card">
                    <div class="game-header">
                        <i class="fas fa-key game-icon"></i>
                        <div>
                            <h3 class="game-title">Password Cracker</h3>
                            <div class="mission-tags">
                                <span class="mission-tag">Password Security</span>
                                <span class="mission-tag">Brute Force</span>
                            </div>
                        </div>
                    </div>
                    <p class="game-desc">Identify the weakest password from the options. Learn what makes passwords strong or vulnerable to attacks.</p>
                    
                    <div class="mission-controls">
                        <button class="btn btn-primary start-game-btn" data-game="password">
                            <i class="fas fa-play"></i> Start Game
                        </button>
                    </div>
                </div>
                
                <!-- URL Decoder Game -->
                <div class="game-card">
                    <div class="game-header">
                        <i class="fas fa-link game-icon"></i>
                        <div>
                            <h3 class="game-title">URL Decoder</h3>
                            <div class="mission-tags">
                                <span class="mission-tag">Web Security</span>
                                <span class="mission-tag">Malicious URLs</span>
                            </div>
                        </div>
                    </div>
                    <p class="game-desc">Analyze URLs to identify which ones are malicious and which are safe. Look for suspicious patterns and domains.</p>
                    
                    <div class="mission-controls">
                        <button class="btn btn-primary start-game-btn" data-game="url">
                            <i class="fas fa-play"></i> Start Game
                        </button>
                    </div>
                </div>
                
                <!-- Firewall Builder Game -->
                <div class="game-card">
                    <div class="game-header">
                        <i class="fas fa-fire game-icon"></i>
                        <div>
                            <h3 class="game-title">Firewall Builder</h3>
                            <div class="mission-tags">
                                <span class="mission-tag">Network Security</span>
                                <span class="mission-tag">Firewalls</span>
                            </div>
                        </div>
                    </div>
                    <p class="game-desc">Drag and drop firewall rules in the correct order to block attacks while allowing legitimate traffic.</p>
                    
                    <div class="mission-controls">
                        <button class="btn btn-primary start-game-btn" data-game="firewall">
                            <i class="fas fa-play"></i> Start Game
                        </button>
                    </div>
                </div>
                
                <!-- Hash Match Game -->
                <div class="game-card">
                    <div class="game-header">
                        <i class="fas fa-fingerprint game-icon"></i>
                        <div>
                            <h3 class="game-title">Hash Match</h3>
                            <div class="mission-tags">
                                <span class="mission-tag">Cryptography</span>
                                <span class="mission-tag">Data Integrity</span>
                            </div>
                        </div>
                    </div>
                    <p class="game-desc">Match plain text with their correct hash values. Learn about cryptographic hashing and data integrity.</p>
                    
                    <div class="mission-controls">
                        <button class="btn btn-primary start-game-btn" data-game="hash">
                            <i class="fas fa-play"></i> Start Game
                        </button>
                    </div>
                </div>
                
                <!-- Network Scanner Game -->
                <div class="game-card">
                    <div class="game-header">
                        <i class="fas fa-network-wired game-icon"></i>
                        <div>
                            <h3 class="game-title">Network Scanner</h3>
                            <div class="mission-tags">
                                <span class="mission-tag">Networking</span>
                                <span class="mission-tag">Vulnerability</span>
                            </div>
                        </div>
                    </div>
                    <p class="game-desc">Scan the network to identify vulnerable devices. Learn about network scanning and security assessment.</p>
                    
                    <div class="mission-controls">
                        <button class="btn btn-primary start-game-btn" data-game="network">
                            <i class="fas fa-play"></i> Start Game
                        </button>
                    </div>
                </div>
                
                <!-- Encryption Challenge Game -->
                <div class="game-card">
                    <div class="game-header">
                        <i class="fas fa-lock game-icon"></i>
                        <div>
                            <h3 class="game-title">Encryption Challenge</h3>
                            <div class="mission-tags">
                                <span class="mission-tag">Encryption</span>
                                <span class="mission-tag">Cryptography</span>
                            </div>
                        </div>
                    </div>
                    <p class="game-desc">Decrypt messages using different encryption algorithms. Test your cryptography knowledge.</p>
                    
                    <div class="mission-controls">
                        <button class="btn btn-primary start-game-btn" data-game="encryption">
                            <i class="fas fa-play"></i> Start Game
                        </button>
                    </div>
                </div>
                
                <!-- Social Engineering Quiz -->
                <div class="game-card">
                    <div class="game-header">
                        <i class="fas fa-user-secret game-icon"></i>
                        <div>
                            <h3 class="game-title">Social Engineering Quiz</h3>
                            <div class="mission-tags">
                                <span class="mission-tag">Social Engineering</span>
                                <span class="mission-tag">Psychology</span>
                            </div>
                        </div>
                    </div>
                    <p class="game-desc">Identify social engineering tactics and learn how to protect against psychological manipulation.</p>
                    
                    <div class="mission-controls">
                        <button class="btn btn-primary start-game-btn" data-game="social">
                            <i class="fas fa-play"></i> Start Game
                        </button>
                    </div>
                </div>
                
                <!-- Incident Response Simulator -->
                <div class="game-card">
                    <div class="game-header">
                        <i class="fas fa-exclamation-triangle game-icon"></i>
                        <div>
                            <h3 class="game-title">Incident Response</h3>
                            <div class="mission-tags">
                                <span class="mission-tag">Incident Response</span>
                                <span class="mission-tag">Emergency</span>
                            </div>
                        </div>
                    </div>
                    <p class="game-desc">Respond to simulated cybersecurity incidents in the correct order to minimize damage.</p>
                    
                    <div class="mission-controls">
                        <button class="btn btn-primary start-game-btn" data-game="incident">
                            <i class="fas fa-play"></i> Start Game
                        </button>
                    </div>
                </div>
                
                <!-- Digital Forensics Puzzle -->
                <div class="game-card">
                    <div class="game-header">
                        <i class="fas fa-search game-icon"></i>
                        <div>
                            <h3 class="game-title">Digital Forensics</h3>
                            <div class="mission-tags">
                                <span class="mission-tag">Forensics</span>
                                <span class="mission-tag">Investigation</span>
                            </div>
                        </div>
                    </div>
                    <p class="game-desc">Solve digital forensics puzzles by analyzing evidence and connecting the dots in cyber investigations.</p>
                    
                    <div class="mission-controls">
                        <button class="btn btn-primary start-game-btn" data-game="forensics">
                            <i class="fas fa-play"></i> Start Game
                        </button>
                    </div>
                </div>
            </div>
            
            <div class="footer">
                <p>Created by <strong>Sirojiddinov Khudoyor Davronovich</strong> for educational purposes</p>
                <p>CyberGuard Organization © 2025</p>
            </div>
        </div>
        
        <!-- Learning Hub Page -->
        <div class="page" id="hub">
            <div class="dashboard-header">
                <h1>Cyber Security Learning Hub</h1>
                <p>Learn cybersecurity concepts, techniques, and best practices through interactive lessons and cheat sheets.</p>
            </div>
            
            <div class="hub-container">
                <div class="hub-sidebar">
                    <div class="hub-category">
                        <h3 class="hub-category-title">Core Concepts</h3>
                        <div class="hub-topic active" data-topic="phishing">Phishing Attacks</div>
                        <div class="hub-topic" data-topic="passwords">Password Security</div>
                        <div class="hub-topic" data-topic="malware">Malware Types</div>
                        <div class="hub-topic" data-topic="encryption">Encryption Basics</div>
                    </div>
                    
                    <div class="hub-category">
                        <h3 class="hub-category-title">Defense Techniques</h3>
                        <div class="hub-topic" data-topic="firewalls">Firewalls</div>
                        <div class="hub-topic" data-topic="2fa">Two-Factor Authentication</div>
                        <div class="hub-topic" data-topic="backups">Data Backups</div>
                        <div class="hub-topic" data-topic="networks">Network Security</div>
                    </div>
                    
                    <div class="hub-category">
                        <h3 class="hub-category-title">Advanced Topics</h3>
                        <div class="hub-topic" data-topic="social-engineering">Social Engineering</div>
                        <div class="hub-topic" data-topic="incident-response">Incident Response</div>
                        <div class="hub-topic" data-topic="forensics">Digital Forensics</div>
                        <div class="hub-topic" data-topic="compliance">Security Compliance</div>
                    </div>
                </div>
                
                <div class="hub-content">
                    <h2 class="hub-content-title" id="hub-title">Phishing Attacks</h2>
                    <div class="hub-content-body" id="hub-content">
                        <!-- Content will be loaded here -->
                    </div>
                </div>
            </div>
            
            <div class="footer">
                <p>Created by <strong>Sirojiddinov Khudoyor Davronovich</strong> for educational purposes</p>
                <p>CyberGuard Organization © 2025</p>
            </div>
        </div>
        
        <!-- Profile Page -->
        <div class="page" id="profile">
            <div class="dashboard-header">
                <h1>Agent Profile</h1>
                <p>Track your progress, achievements, and rank in the CyberGuard Agency.</p>
            </div>
            
            <div class="profile-container">
                <div class="profile-sidebar">
                    <div class="profile-avatar" id="profile-avatar">
                        <i class="fas fa-user-secret" id="avatar-icon"></i>
                        <input type="file" id="avatar-upload" accept="image/*" style="display: none;">
                    </div>
                    <h2 class="profile-name" id="profile-name-display">Agent</h2>
                    <div class="profile-title" id="profile-title">Cyber Novice</div>
                    
                    <div class="profile-stats">
                        <div class="profile-stat">
                            <span>Level</span>
                            <span id="profile-level">1</span>
                        </div>
                        <div class="profile-stat">
                            <span>Total XP</span>
                            <span id="profile-xp">0</span>
                        </div>
                        <div class="profile-stat">
                            <span>Missions</span>
                            <span id="profile-missions">0/20</span>
                        </div>
                        <div class="profile-stat">
                            <span>Badges</span>
                            <span id="profile-badges">0/25</span>
                        </div>
                        <div class="profile-stat">
                            <span>Games Played</span>
                            <span id="profile-games">0</span>
                        </div>
                    </div>
                    
                    <div class="mission-controls" style="margin-top: 1.5rem;">
                        <button class="btn btn-primary" id="view-certificate-btn" disabled>
                            <i class="fas fa-certificate"></i> View Certificate
                        </button>
                    </div>
                </div>
                
                <div class="profile-content">
                    <div class="progress-section">
                        <h3 class="section-title"><i class="fas fa-chart-line"></i> Progress to Next Level</h3>
                        <div><span id="current-xp">0</span> / <span id="next-level-xp">250</span> XP</div>
                        <div class="progress-bar">
                            <div class="progress-fill" id="level-progress" style="width: 0%"></div>
                        </div>
                    </div>
                    
                    <div class="progress-section">
                        <h3 class="section-title"><i class="fas fa-medal"></i> Rank Progression</h3>
                        <div>Next Rank: <span id="next-rank-name">Security Trainee</span> (<span id="next-rank-xp">500</span> XP)</div>
                        <div class="progress-bar">
                            <div class="progress-fill" id="rank-progress" style="width: 0%"></div>
                        </div>
                        
                        <div class="ranks-list" style="margin-top: 1rem;">
                            <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                                <span>Cyber Novice (0 XP)</span>
                                <span><i class="fas fa-check" style="color: var(--success);"></i></span>
                            </div>
                            <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                                <span>Security Trainee (500 XP)</span>
                                <span><i class="fas fa-arrow-right" style="color: var(--warning);"></i></span>
                            </div>
                            <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                                <span>Cyber Analyst (1,500 XP)</span>
                                <span><i class="fas fa-lock" style="color: #a0aec0;"></i></span>
                            </div>
                            <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                                <span>Security Specialist (3,500 XP)</span>
                                <span><i class="fas fa-lock" style="color: #a0aec0;"></i></span>
                            </div>
                            <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                                <span>Threat Hunter (6,000 XP)</span>
                                <span><i class="fas fa-lock" style="color: #a0aec0;"></i></span>
                            </div>
                            <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                                <span>Cyber Defender (10,000 XP)</span>
                                <span><i class="fas fa-lock" style="color: #a0aec0;"></i></span>
                            </div>
                            <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                                <span>Security Architect (15,000 XP)</span>
                                <span><i class="fas fa-lock" style="color: #a0aec0;"></i></span>
                            </div>
                            <div style="display: flex; justify-content: space-between;">
                                <span>Cybersecurity Expert (25,000 XP)</span>
                                <span><i class="fas fa-lock" style="color: #a0aec0;"></i></span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="progress-section">
                        <h3 class="section-title"><i class="fas fa-award"></i> Badges Earned</h3>
                        <div class="badges-grid" id="badges-grid">
                            <!-- Badges will be loaded here -->
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="footer">
                <p>Created by <strong>Sirojiddinov Khudoyor Davronovich</strong> for educational purposes</p>
                <p>CyberGuard Organization © 2025</p>
            </div>
        </div>
    </div>

    <script>
        // Learning Content for Learning Hub - COMPLETELY FILLED
        const learningContent = {
            "phishing": {
                title: "Phishing Attacks",
                content: `
                    <h3>What is Phishing?</h3>
                    <p>Phishing is a type of social engineering attack where attackers impersonate legitimate organizations to steal sensitive information like login credentials, credit card numbers, or personal data.</p>
                    
                    <h3>Common Types of Phishing:</h3>
                    <ul>
                        <li><strong>Email Phishing:</strong> Fraudulent emails that appear to come from legitimate sources</li>
                        <li><strong>Spear Phishing:</strong> Targeted attacks aimed at specific individuals or organizations</li>
                        <li><strong>Whaling:</strong> Phishing attacks targeting high-profile executives</li>
                        <li><strong>Smishing:</strong> Phishing via SMS/text messages</li>
                        <li><strong>Vishing:</strong> Phishing via voice calls</li>
                    </ul>
                    
                    <h3>How to Identify Phishing Attempts:</h3>
                    <ol>
                        <li>Check the sender's email address carefully</li>
                        <li>Look for spelling and grammar mistakes</li>
                        <li>Be suspicious of urgent or threatening language</li>
                        <li>Hover over links to see the actual URL</li>
                        <li>Verify requests for sensitive information through official channels</li>
                    </ol>
                    
                    <h3>Best Practices:</h3>
                    <ul>
                        <li>Never click on suspicious links</li>
                        <li>Use two-factor authentication</li>
                        <li>Keep software and antivirus updated</li>
                        <li>Educate employees about phishing risks</li>
                        <li>Report suspicious emails to your IT department</li>
                    </ul>
                `
            },
            "passwords": {
                title: "Password Security",
                content: `
                    <h3>Importance of Strong Passwords</h3>
                    <p>Passwords are the first line of defense against unauthorized access to your accounts and sensitive information.</p>
                    
                    <h3>Creating Strong Passwords:</h3>
                    <ul>
                        <li>Use at least 12 characters</li>
                        <li>Combine uppercase, lowercase, numbers, and symbols</li>
                        <li>Avoid dictionary words and personal information</li>
                        <li>Consider using passphrases: "CorrectHorseBatteryStaple"</li>
                    </ul>
                    
                    <h3>Password Management:</h3>
                    <ol>
                        <li>Use a different password for each account</li>
                        <li>Consider using a password manager</li>
                        <li>Enable two-factor authentication whenever possible</li>
                        <li>Change passwords periodically</li>
                        <li>Never share passwords via email or text</li>
                    </ol>
                    
                    <h3>Common Password Mistakes:</h3>
                    <ul>
                        <li>Using "password" or "123456"</li>
                        <li>Reusing passwords across multiple sites</li>
                        <li>Writing passwords on sticky notes</li>
                        <li>Using personal information (birthdates, pet names)</li>
                        <li>Not updating default passwords</li>
                    </ul>
                `
            },
            "malware": {
                title: "Malware Types",
                content: `
                    <h3>What is Malware?</h3>
                    <p>Malware (malicious software) is any software intentionally designed to cause damage to computers, servers, or networks.</p>
                    
                    <h3>Common Types of Malware:</h3>
                    <ul>
                        <li><strong>Viruses:</strong> Self-replicating programs that attach to clean files</li>
                        <li><strong>Worms:</strong> Standalone malware that spreads through networks</li>
                        <li><strong>Trojans:</strong> Disguised as legitimate software</li>
                        <li><strong>Ransomware:</strong> Encrypts files and demands payment</li>
                        <li><strong>Spyware:</strong> Secretly monitors user activity</li>
                        <li><strong>Adware:</strong> Displays unwanted advertisements</li>
                        <li><strong>Rootkits:</strong> Hides deep within operating systems</li>
                        <li><strong>Keyloggers:</strong> Records keystrokes to steal credentials</li>
                    </ul>
                    
                    <h3>How Malware Spreads:</h3>
                    <ol>
                        <li>Email attachments and links</li>
                        <li>Infected websites and downloads</li>
                        <li>Removable media (USB drives)</li>
                        <li>Software vulnerabilities</li>
                        <li>Network propagation</li>
                    </ol>
                    
                    <h3>Protection Strategies:</h3>
                    <ul>
                        <li>Install and regularly update antivirus software</li>
                        <li>Keep operating systems and applications patched</li>
                        <li>Be cautious with email attachments and links</li>
                        <li>Use firewalls and network security tools</li>
                        <li>Regularly back up important data</li>
                        <li>Educate users about safe browsing habits</li>
                    </ul>
                `
            },
            "encryption": {
                title: "Encryption Basics",
                content: `
                    <h3>What is Encryption?</h3>
                    <p>Encryption is the process of converting plain text into coded text (ciphertext) to prevent unauthorized access. Only authorized parties with the decryption key can read the original message.</p>
                    
                    <h3>Types of Encryption:</h3>
                    <ul>
                        <li><strong>Symmetric Encryption:</strong> Uses the same key for encryption and decryption (e.g., AES, DES)</li>
                        <li><strong>Asymmetric Encryption:</strong> Uses public and private key pairs (e.g., RSA, ECC)</li>
                        <li><strong>Hashing:</strong> One-way encryption that cannot be reversed (e.g., SHA-256, MD5)</li>
                    </ul>
                    
                    <h3>Common Encryption Algorithms:</h3>
                    <ol>
                        <li><strong>AES</strong> (Advanced Encryption Standard) - Most widely used symmetric encryption</li>
                        <li><strong>RSA</strong> (Rivest-Shamir-Adleman) - Popular asymmetric encryption</li>
                        <li><strong>ECC</strong> (Elliptic Curve Cryptography) - Efficient asymmetric encryption</li>
                        <li><strong>SHA-256</strong> - Secure hashing algorithm</li>
                        <li><strong>PGP/GPG</strong> - Email encryption standard</li>
                    </ol>
                    
                    <h3>When to Use Encryption:</h3>
                    <ul>
                        <li>Storing sensitive data (databases, files)</li>
                        <li>Transmitting data over networks (HTTPS, VPNs)</li>
                        <li>Protecting passwords and credentials</li>
                        <li>Securing email communications</li>
                        <li>Protecting mobile devices and applications</li>
                    </ul>
                `
            },
            "firewalls": {
                title: "Firewalls",
                content: `
                    <h3>What is a Firewall?</h3>
                    <p>A firewall is a network security device that monitors and controls incoming and outgoing network traffic based on predetermined security rules. It acts as a barrier between trusted internal networks and untrusted external networks.</p>
                    
                    <h3>Types of Firewalls:</h3>
                    <ul>
                        <li><strong>Packet-filtering Firewalls:</strong> Inspect packets and allow or block based on rules (IP addresses, ports)</li>
                        <li><strong>Stateful Inspection Firewalls:</strong> Track the state of network connections and make decisions based on context</li>
                        <li><strong>Proxy Firewalls:</strong> Act as intermediaries between users and the internet</li>
                        <li><strong>Next-Generation Firewalls (NGFW):</strong> Include additional features like intrusion prevention, application awareness</li>
                        <li><strong>Web Application Firewalls (WAF):</strong> Specifically protect web applications</li>
                    </ul>
                    
                    <h3>Firewall Rules and Policies:</h3>
                    <ol>
                        <li>Default deny policy (block all, allow specific)</li>
                        <li>Allow specific ports and protocols</li>
                        <li>Block known malicious IP addresses</li>
                        <li>Restrict access to sensitive services</li>
                        <li>Monitor and log suspicious traffic</li>
                        <li>Implement geographic restrictions when necessary</li>
                    </ol>
                    
                    <h3>Best Practices:</h3>
                    <ul>
                        <li>Place firewalls at network boundaries</li>
                        <li>Regularly update firewall rules</li>
                        <li>Monitor firewall logs for anomalies</li>
                        <li>Use multiple firewall layers (defense in depth)</li>
                        <li>Regularly test firewall configurations</li>
                    </ul>
                `
            },
            "2fa": {
                title: "Two-Factor Authentication",
                content: `
                    <h3>What is Two-Factor Authentication (2FA)?</h3>
                    <p>2FA adds an extra layer of security by requiring two different types of verification before granting access. It combines something you know (password) with something you have (device) or something you are (biometric).</p>
                    
                    <h3>Common 2FA Methods:</h3>
                    <ul>
                        <li><strong>SMS Codes:</strong> One-time codes sent via text message</li>
                        <li><strong>Authenticator Apps:</strong> Time-based codes generated by apps like Google Authenticator or Authy</li>
                        <li><strong>Hardware Tokens:</strong> Physical devices that generate codes (e.g., YubiKey)</li>
                        <li><strong>Biometric Verification:</strong> Fingerprint, facial recognition, or iris scanning</li>
                        <li><strong>Email Verification Codes:</strong> Codes sent to registered email addresses</li>
                        <li><strong>Push Notifications:</strong> Approval requests sent to mobile devices</li>
                    </ul>
                    
                    <h3>Benefits of 2FA:</h3>
                    <ol>
                        <li>Significantly reduces account takeover risk</li>
                        <li>Protects against credential stuffing attacks</li>
                        <li>Mitigates password reuse vulnerabilities</li>
                        <li>Provides alerting for unauthorized access attempts</li>
                        <li>Compliance with security standards and regulations</li>
                    </ol>
                    
                    <h3>Implementation Guidelines:</h3>
                    <ul>
                        <li>Enable 2FA for all critical accounts (email, banking, social media)</li>
                        <li>Use authenticator apps instead of SMS when possible</li>
                        <li>Keep backup codes in a secure location</li>
                        <li>Register multiple authentication methods</li>
                        <li>Regularly review and update 2FA settings</li>
                    </ul>
                `
            },
            "backups": {
                title: "Data Backups",
                content: `
                    <h3>Importance of Data Backups</h3>
                    <p>Data backups are copies of important information stored separately from the original data. They are essential for recovery from data loss due to hardware failure, cyber attacks, human error, or natural disasters.</p>
                    
                    <h3>Backup Strategies (3-2-1 Rule):</h3>
                    <ul>
                        <li><strong>3 Copies:</strong> Maintain at least three copies of your data</li>
                        <li><strong>2 Different Media:</strong> Store backups on at least two different types of media</li>
                        <li><strong>1 Offsite Backup:</strong> Keep at least one backup copy offsite</li>
                    </ul>
                    
                    <h3>Types of Backups:</h3>
                    <ol>
                        <li><strong>Full Backup:</strong> Complete copy of all selected data</li>
                        <li><strong>Incremental Backup:</strong> Only backs up changes since last backup</li>
                        <li><strong>Differential Backup:</strong> Backs up changes since last full backup</li>
                        <li><strong>Mirror Backup:</strong> Exact replica of source data</li>
                        <li><strong>Cloud Backup:</strong> Stored on remote servers via internet</li>
                    </ol>
                    
                    <h3>Backup Best Practices:</h3>
                    <ul>
                        <li>Schedule regular automated backups</li>
                        <li>Test backup restoration periodically</li>
                        <li>Encrypt sensitive backup data</li>
                        <li>Store backups in geographically separate locations</li>
                        <li>Maintain multiple backup generations</li>
                        <li>Document backup and recovery procedures</li>
                    </ul>
                    
                    <h3>Recovery Planning:</h3>
                    <ul>
                        <li>Define Recovery Time Objective (RTO) - maximum acceptable downtime</li>
                        <li>Define Recovery Point Objective (RPO) - maximum acceptable data loss</li>
                        <li>Create detailed recovery documentation</li>
                        <li>Train staff on recovery procedures</li>
                        <li>Regularly test disaster recovery plans</li>
                    </ul>
                `
            },
            "networks": {
                title: "Network Security",
                content: `
                    <h3>Network Security Fundamentals</h3>
                    <p>Network security involves protecting computer networks and their data from unauthorized access, misuse, or theft through various technologies, processes, and policies.</p>
                    
                    <h3>Key Network Security Components:</h3>
                    <ul>
                        <li><strong>Firewalls:</strong> Control incoming and outgoing network traffic</li>
                        <li><strong>Intrusion Detection/Prevention Systems (IDS/IPS):</strong> Monitor and block suspicious activities</li>
                        <li><strong>Virtual Private Networks (VPNs):</strong> Secure remote access to networks</li>
                        <li><strong>Network Segmentation:</strong> Divide networks into smaller, isolated segments</li>
                        <li><strong>Access Control Lists (ACLs):</strong> Define who can access network resources</li>
                        <li><strong>Network Monitoring:</strong> Continuous observation of network traffic and devices</li>
                    </ul>
                    
                    <h3>Common Network Threats:</h3>
                    <ol>
                        <li>Denial of Service (DoS) attacks</li>
                        <li>Man-in-the-Middle (MitM) attacks</li>
                        <li>Packet sniffing and eavesdropping</li>
                        <li>Port scanning and network reconnaissance</li>
                        <li>DNS spoofing and poisoning</li>
                        <li>Wireless network attacks</li>
                    </ol>
                    
                    <h3>Network Security Best Practices:</h3>
                    <ul>
                        <li>Implement strong network segmentation</li>
                        <li>Use encryption for sensitive data transmission</li>
                        <li>Regularly update network device firmware</li>
                        <li>Disable unnecessary services and ports</li>
                        <li>Monitor network traffic for anomalies</li>
                        <li>Conduct regular network vulnerability assessments</li>
                        <li>Implement network access control (NAC) solutions</li>
                    </ul>
                `
            },
            "social-engineering": {
                title: "Social Engineering",
                content: `
                    <h3>What is Social Engineering?</h3>
                    <p>Social engineering manipulates people into revealing confidential information or performing actions that compromise security. It exploits human psychology rather than technical vulnerabilities.</p>
                    
                    <h3>Common Social Engineering Techniques:</h3>
                    <ul>
                        <li><strong>Phishing:</strong> Fraudulent emails pretending to be from legitimate sources</li>
                        <li><strong>Pretexting:</strong> Creating false scenarios to obtain information</li>
                        <li><strong>Baiting:</strong> Offering something enticing to lure victims</li>
                        <li><strong>Quid pro quo:</strong> Offering a service in exchange for information</li>
                        <li><strong>Tailgating/Piggybacking:</strong> Following authorized personnel into restricted areas</li>
                        <li><strong>Impersonation:</strong> Pretending to be someone else to gain trust</li>
                    </ul>
                    
                    <h3>Psychological Principles Exploited:</h3>
                    <ol>
                        <li><strong>Authority:</strong> People tend to obey authority figures</li>
                        <li><strong>Urgency:</strong> Creating time pressure to bypass rational thinking</li>
                        <li><strong>Reciprocity:</strong> Feeling obligated to return favors</li>
                        <li><strong>Social Proof:</strong> Following what others are doing</li>
                        <li><strong>Likability:</strong> Trusting people we like or find similar to ourselves</li>
                        <li><strong>Scarcity:</strong> Perceiving limited availability as more valuable</li>
                    </ol>
                    
                    <h3>Defense Strategies:</h3>
                    <ul>
                        <li>Security awareness training for all employees</li>
                        <li>Implement verification procedures for sensitive requests</li>
                        <li>Establish clear security policies and reporting procedures</li>
                        <li>Use technical controls to limit information exposure</li>
                        <li>Conduct regular social engineering tests and simulations</li>
                        <li>Create a culture of security mindfulness</li>
                    </ul>
                `
            },
            "incident-response": {
                title: "Incident Response",
                content: `
                    <h3>What is Incident Response?</h3>
                    <p>Incident response is an organized approach to addressing and managing the aftermath of a security breach or cyber attack. The goal is to handle the situation in a way that limits damage and reduces recovery time and costs.</p>
                    
                    <h3>Incident Response Lifecycle (NIST Framework):</h3>
                    <ol>
                        <li><strong>Preparation:</strong> Develop policies, plans, procedures, and teams</li>
                        <li><strong>Detection & Analysis:</strong> Identify and assess security incidents</li>
                        <li><strong>Containment:</strong> Limit the scope and impact of the incident</li>
                        <li><strong>Eradication:</strong> Remove the cause of the incident</li>
                        <li><strong>Recovery:</strong> Restore systems and operations</li>
                        <li><strong>Lessons Learned:</strong> Document and improve based on the incident</li>
                    </ol>
                    
                    <h3>Incident Response Team Roles:</h3>
                    <ul>
                        <li><strong>Incident Response Manager:</strong> Overall coordination and decision-making</li>
                        <li><strong>Security Analysts:</strong> Technical investigation and analysis</li>
                        <li><strong>Forensics Specialists:</strong> Evidence collection and preservation</li>
                        <li><strong>Legal Advisor:</strong> Compliance and legal considerations</li>
                        <li><strong>Communications Officer:</strong> Internal and external communications</li>
                        <li><strong>IT Operations:</strong> System restoration and remediation</li>
                    </ul>
                    
                    <h3>Common Incident Types:</h3>
                    <ul>
                        <li>Malware infections and ransomware attacks</li>
                        <li>Denial of Service (DoS) attacks</li>
                        <li>Unauthorized access and data breaches</li>
                        <li>Phishing and social engineering attacks</li>
                        <li>Insider threats and privilege misuse</li>
                        <li>Physical security breaches</li>
                    </ul>
                    
                    <h3>Best Practices:</h3>
                    <ul>
                        <li>Develop and maintain an incident response plan</li>
                        <li>Conduct regular tabletop exercises and drills</li>
                        <li>Establish clear communication protocols</li>
                        <li>Maintain evidence preservation procedures</li>
                        <li>Document all incidents and responses thoroughly</li>
                        <li>Continuously update plans based on lessons learned</li>
                    </ul>
                `
            },
            "forensics": {
                title: "Digital Forensics",
                content: `
                    <h3>What is Digital Forensics?</h3>
                    <p>Digital forensics is the process of identifying, preserving, analyzing, and presenting digital evidence in a manner that is legally admissible. It involves investigating digital devices and data to reconstruct events or actions.</p>
                    
                    <h3>Digital Forensics Process:</h3>
                    <ol>
                        <li><strong>Identification:</strong> Recognize and define the scope of the investigation</li>
                        <li><strong>Preservation:</strong> Secure and isolate the digital evidence</li>
                        <li><strong>Collection:</strong> Acquire data using forensically sound methods</li>
                        <li><strong>Examination:</strong> Systematically search and analyze the evidence</li>
                        <li><strong>Analysis:</strong> Interpret the findings and draw conclusions</li>
                        <li><strong>Presentation:</strong> Document and present findings in a clear manner</li>
                    </ol>
                    
                    <h3>Types of Digital Evidence:</h3>
                    <ul>
                        <li><strong>Computer Forensics:</strong> Desktops, laptops, servers</li>
                        <li><strong>Mobile Device Forensics:</strong> Smartphones, tablets, wearables</li>
                        <li><strong>Network Forensics:</strong> Network traffic and logs</li>
                        <li><strong>Memory Forensics:</strong> RAM and volatile memory</li>
                        <li><strong>Cloud Forensics:</strong> Data stored in cloud services</li>
                        <li><strong>Database Forensics:</strong> Database systems and transactions</li>
                    </ul>
                    
                    <h3>Forensic Tools and Techniques:</h3>
                    <ul>
                        <li><strong>Imaging Tools:</strong> Create bit-for-bit copies of storage media</li>
                        <li><strong>Analysis Software:</strong> Examine file systems, registry, logs</li>
                        <li><strong>Network Analyzers:</strong> Capture and analyze network traffic</li>
                        <li><strong>Memory Dump Tools:</strong> Extract and analyze RAM contents</li>
                        <li><strong>Hash Algorithms:</strong> Verify data integrity (MD5, SHA-256)</li>
                        <li><strong>Timeline Analysis:</strong> Reconstruct sequences of events</li>
                    </ul>
                    
                    <h3>Legal Considerations:</h3>
                    <ul>
                        <li>Maintain chain of custody documentation</li>
                        <li>Follow admissible evidence procedures</li>
                        <li>Respect privacy laws and regulations</li>
                        <li>Work within legal authority and warrants</li>
                        <li>Prepare expert testimony when required</li>
                        <li>Document all actions and findings thoroughly</li>
                    </ul>
                `
            },
            "compliance": {
                title: "Security Compliance",
                content: `
                    <h3>What is Security Compliance?</h3>
                    <p>Security compliance involves adhering to established standards, regulations, and laws designed to protect information and information systems. It ensures organizations meet legal, regulatory, and contractual requirements.</p>
                    
                    <h3>Major Compliance Frameworks:</h3>
                    <ul>
                        <li><strong>GDPR (General Data Protection Regulation):</strong> European data privacy regulation</li>
                        <li><strong>HIPAA (Health Insurance Portability and Accountability Act):</strong> US healthcare data protection</li>
                        <li><strong>PCI DSS (Payment Card Industry Data Security Standard):</strong> Credit card data security</li>
                        <li><strong>ISO 27001:</strong> International information security management standard</li>
                        <li><strong>SOX (Sarbanes-Oxley Act):</strong> US financial reporting and disclosure</li>
                        <li><strong>NIST Cybersecurity Framework:</strong> US government cybersecurity guidelines</li>
                        <li><strong>FISMA (Federal Information Security Management Act):</strong> US federal agency security</li>
                    </ul>
                    
                    <h3>Compliance Management Process:</h3>
                    <ol>
                        <li><strong>Assessment:</strong> Identify applicable requirements and current state</li>
                        <li><strong>Planning:</strong> Develop compliance strategy and roadmap</li>
                        <li><strong>Implementation:</strong> Deploy controls and processes to meet requirements</li>
                        <li><strong>Monitoring:</strong> Continuous assessment of compliance status</li>
                        <li><strong>Reporting:</strong> Document and report compliance achievements</li>
                        <li><strong>Improvement:</strong> Continuously enhance compliance posture</li>
                    </ol>
                    
                    <h3>Key Compliance Components:</h3>
                    <ul>
                        <li><strong>Risk Assessment:</strong> Identify and evaluate security risks</li>
                        <li><strong>Security Policies:</strong> Documented rules and procedures</li>
                        <li><strong>Access Controls:</strong> Manage who can access what information</li>
                        <li><strong>Audit Trails:</strong> Record of system activities and changes</li>
                        <li><strong>Incident Response:</strong> Plans for handling security incidents</li>
                        <li><strong>Training & Awareness:</strong> Educate employees on security requirements</li>
                        <li><strong>Vendor Management:</strong> Ensure third-party compliance</li>
                    </ul>
                    
                    <h3>Benefits of Compliance:</h3>
                    <ul>
                        <li>Reduced legal and regulatory risks</li>
                        <li>Enhanced customer trust and reputation</li>
                        <li>Improved security posture and risk management</li>
                        <li>Competitive advantage in regulated industries</li>
                        <li>Structured approach to security management</li>
                        <li>Better alignment of security with business objectives</li>
                    </ul>
                `
            }
        };

        // Game Data - 20 Missions with COMPLETE CONTENT
        const missions = [
            {
                id: 1,
                title: "Phishing Detection",
                description: "Identify and report phishing attempts in simulated email scenarios.",
                icon: "fas fa-fish",
                xp: 150,
                tags: ["Email Security", "Social Engineering"],
                completed: false,
                active: true,
                locked: false,
                tasks: [
                    "Complete the phishing detection tutorial",
                    "Identify 3 phishing emails correctly",
                    "Understand common phishing techniques"
                ],
                questions: [
                    {
                        question: "Which of these is a common sign of a phishing email?",
                        options: [
                            "Personalized greeting with your full name",
                            "Urgent request for personal information",
                            "Links to official company websites",
                            "Professional email signature"
                        ],
                        correct: 1,
                        explanation: "Phishing emails often create a sense of urgency to trick you into acting quickly without thinking."
                    },
                    {
                        question: "What should you do if you receive a suspicious email from your bank?",
                        options: [
                            "Click the link and log in to check",
                            "Call the bank using the number from their official website",
                            "Reply to the email asking for verification",
                            "Forward it to all your contacts to warn them"
                        ],
                        correct: 1,
                        explanation: "Always contact the organization directly using official contact information, not information from the suspicious email."
                    },
                    {
                        question: "Which email is most likely a phishing attempt?",
                        options: [
                            "An email from 'security@yourbank.com' asking you to update your security settings",
                            "An email from 'support@paypai.com' saying your account is locked",
                            "A monthly newsletter from a company you subscribed to",
                            "A receipt for a purchase you actually made"
                        ],
                        correct: 1,
                        explanation: "'paypai.com' is a misspelling of 'paypal.com' - a common phishing technique called typosquatting."
                    }
                ]
            },
            {
                id: 2,
                title: "Password Security",
                description: "Learn about password strength and crack weak passwords in a simulation.",
                icon: "fas fa-key",
                xp: 200,
                tags: ["Authentication", "Passwords"],
                completed: false,
                active: false,
                locked: true,
                tasks: [
                    "Learn about password entropy",
                    "Identify weak passwords",
                    "Create a strong password"
                ],
                questions: [
                    {
                        question: "What is the minimum recommended length for a strong password?",
                        options: [
                            "8 characters",
                            "12 characters",
                            "6 characters",
                            "16 characters"
                        ],
                        correct: 1,
                        explanation: "Most security experts recommend at least 12 characters for strong passwords."
                    },
                    {
                        question: "Which of these is the strongest password?",
                        options: [
                            "password123",
                            "P@ssw0rd!",
                            "CorrectHorseBatteryStaple",
                            "12345678"
                        ],
                        correct: 2,
                        explanation: "Passphrases with multiple random words are stronger than complex short passwords."
                    },
                    {
                        question: "What should you avoid when creating passwords?",
                        options: [
                            "Using special characters",
                            "Reusing passwords across different sites",
                            "Making passwords longer than 8 characters",
                            "Using a password manager"
                        ],
                        correct: 1,
                        explanation: "Password reuse is extremely dangerous - if one site is breached, all your accounts with the same password are compromised."
                    }
                ]
            },
            {
                id: 3,
                title: "URL Analysis",
                description: "Analyze URLs to identify malicious patterns and suspicious domains.",
                icon: "fas fa-link",
                xp: 175,
                tags: ["Web Security", "Malicious Links"],
                completed: false,
                active: false,
                locked: true,
                tasks: [
                    "Learn about URL structure analysis",
                    "Identify 3 malicious URL patterns",
                    "Understand domain reputation checks"
                ],
                questions: [
                    {
                        question: "Which URL is most likely malicious?",
                        options: [
                            "https://www.amazon.com/gp/product/B08N5WRWNW",
                            "http://secure-login-bank.com/verify",
                            "https://github.com/security/advisories",
                            "https://www.paypal.com/signin"
                        ],
                        correct: 1,
                        explanation: "The URL uses 'http' instead of 'https' and has a suspicious domain name trying to mimic a banking site."
                    },
                    {
                        question: "What does a padlock icon in the browser address bar indicate?",
                        options: [
                            "The website has paid for security",
                            "The connection is encrypted with SSL/TLS",
                            "The website is government-approved",
                            "The website has no viruses"
                        ],
                        correct: 1,
                        explanation: "The padlock indicates an encrypted HTTPS connection, but doesn't guarantee the site is legitimate."
                    },
                    {
                        question: "What is 'typosquatting' in URLs?",
                        options: [
                            "Using long, complex URLs",
                            "Registering domains with common typos",
                            "Encrypting URL parameters",
                            "Using subdomains for organization"
                        ],
                        correct: 1,
                        explanation: "Typosquatting involves registering domains with common misspellings of popular websites to trick users."
                    }
                ]
            },
            {
                id: 4,
                title: "Malware Detection",
                description: "Use system tools to identify and remove simulated malware processes.",
                icon: "fas fa-bug",
                xp: 250,
                tags: ["Malware", "System Security"],
                completed: false,
                active: false,
                locked: true,
                tasks: [
                    "Identify suspicious processes",
                    "Learn about malware behavior patterns",
                    "Practice malware removal steps"
                ],
                questions: [
                    {
                        question: "Which behavior is NOT typical of malware?",
                        options: [
                            "High CPU usage with unknown processes",
                            "Unauthorized network connections",
                            "Legitimate software updates from official sources",
                            "Files appearing in system folders without installation"
                        ],
                        correct: 2,
                        explanation: "Legitimate updates from official sources are normal, while the other options are common malware indicators."
                    },
                    {
                        question: "What is the primary purpose of ransomware?",
                        options: [
                            "Steal personal information",
                            "Encrypt files and demand payment",
                            "Create backdoors for future access",
                            "Use system resources for cryptocurrency mining"
                        ],
                        correct: 1,
                        explanation: "Ransomware encrypts files and demands payment (ransom) for decryption keys."
                    },
                    {
                        question: "How does a Trojan differ from a virus?",
                        options: [
                            "Trojans are faster",
                            "Trojans disguise themselves as legitimate software",
                            "Trojans only affect Windows systems",
                            "Trojans don't need user interaction"
                        ],
                        correct: 1,
                        explanation: "Trojans masquerade as legitimate software to trick users into installing them."
                    }
                ]
            },
            {
                id: 5,
                title: "Firewall Configuration",
                description: "Configure firewall rules to block unauthorized access attempts.",
                icon: "fas fa-fire",
                xp: 300,
                tags: ["Network Security", "Firewalls"],
                completed: false,
                active: false,
                locked: true,
                tasks: [
                    "Learn default deny policy",
                    "Configure port-based rules",
                    "Create IP whitelist rules"
                ],
                questions: [
                    {
                        question: "What is the principle of 'default deny' in firewall configuration?",
                        options: [
                            "Allow all traffic by default",
                            "Block all traffic and only allow specific rules",
                            "Allow traffic from trusted countries only",
                            "Block only known malicious IPs"
                        ],
                        correct: 1,
                        explanation: "Default deny means blocking all traffic by default and only allowing what is explicitly permitted."
                    },
                    {
                        question: "Which port should generally be blocked from external access?",
                        options: [
                            "Port 80 (HTTP)",
                            "Port 443 (HTTPS)",
                            "Port 22 (SSH)",
                            "Port 53 (DNS)"
                        ],
                        correct: 2,
                        explanation: "SSH (port 22) should be blocked from external access or restricted to specific IPs as it provides remote system access."
                    },
                    {
                        question: "What is a stateful firewall?",
                        options: [
                            "A firewall that only blocks traffic",
                            "A firewall that tracks connection states",
                            "A firewall that only works with HTTP",
                            "A firewall that uses AI for decisions"
                        ],
                        correct: 1,
                        explanation: "Stateful firewalls track the state of network connections and make decisions based on the context of the traffic."
                    }
                ]
            },
            {
                id: 6,
                title: "Digital Forensics",
                description: "Analyze log files to track an attacker's movements through a system.",
                icon: "fas fa-search",
                xp: 350,
                tags: ["Forensics", "Log Analysis"],
                completed: false,
                active: false,
                locked: true,
                tasks: [
                    "Analyze system log files",
                    "Identify intrusion patterns",
                    "Trace attacker activities"
                ],
                questions: [
                    {
                        question: "What is the purpose of a chain of custody in digital forensics?",
                        options: [
                            "To encrypt evidence",
                            "To document who handled evidence and when",
                            "To speed up analysis",
                            "To share evidence with multiple teams"
                        ],
                        correct: 1,
                        explanation: "Chain of custody documents the chronological history of evidence handling to ensure its integrity in legal proceedings."
                    },
                    {
                        question: "Which log file would you check for failed login attempts?",
                        options: [
                            "System.log",
                            "Security.log or auth.log",
                            "Application.log",
                            "Network.log"
                        ],
                        correct: 1,
                        explanation: "Security logs (auth.log on Linux, Security.evtx on Windows) record authentication events including failed logins."
                    },
                    {
                        question: "What does a hash value help verify in forensics?",
                        options: [
                            "File content integrity",
                            "File creation date",
                            "File ownership",
                            "File compression"
                        ],
                        correct: 0,
                        explanation: "Hash values (like MD5 or SHA-256) verify that evidence hasn't been altered since collection."
                    }
                ]
            },
            {
                id: 7,
                title: "Network Scanning",
                description: "Use scanning tools to identify open ports and vulnerable services.",
                icon: "fas fa-network-wired",
                xp: 400,
                tags: ["Networking", "Penetration Testing"],
                completed: false,
                active: false,
                locked: true,
                tasks: [
                    "Learn port scanning techniques",
                    "Identify vulnerable services",
                    "Practice ethical scanning"
                ],
                questions: [
                    {
                        question: "What is the difference between a port scan and a vulnerability scan?",
                        options: [
                            "Port scans check for open ports, vulnerability scans check for weaknesses",
                            "Port scans are illegal, vulnerability scans are legal",
                            "Port scans are faster",
                            "They are the same thing"
                        ],
                        correct: 0,
                        explanation: "Port scans identify open ports and services, while vulnerability scans check those services for known security weaknesses."
                    },
                    {
                        question: "Why is it important to get permission before scanning a network?",
                        options: [
                            "Scanning uses too much bandwidth",
                            "Unauthorized scanning may be illegal",
                            "Scans are always destructive",
                            "Scans require special hardware"
                        ],
                        correct: 1,
                        explanation: "Unauthorized scanning may violate computer fraud laws and organizational policies."
                    },
                    {
                        question: "Which tool is commonly used for network scanning?",
                        options: [
                            "Wireshark",
                            "Nmap",
                            "Metasploit",
                            "Burp Suite"
                        ],
                        correct: 1,
                        explanation: "Nmap (Network Mapper) is a popular open-source tool for network discovery and security auditing."
                    }
                ]
            },
            {
                id: 8,
                title: "Social Engineering Defense",
                description: "Recognize and defend against social engineering tactics.",
                icon: "fas fa-user-secret",
                xp: 275,
                tags: ["Social Engineering", "Human Factors"],
                completed: false,
                active: false,
                locked: true,
                tasks: [
                    "Identify social engineering tactics",
                    "Practice verification procedures",
                    "Learn psychological manipulation signs"
                ],
                questions: [
                    {
                        question: "What is 'pretexting' in social engineering?",
                        options: [
                            "Creating a fake scenario to obtain information",
                            "Sending mass phishing emails",
                            "Using fear to manipulate people",
                            "Physically following someone"
                        ],
                        correct: 0,
                        explanation: "Pretexting involves creating a fabricated scenario to obtain information under false pretenses."
                    },
                    {
                        question: "Which psychological principle do social engineers often exploit?",
                        options: [
                            "Authority - people tend to obey authority figures",
                            "Color psychology",
                            "Mathematical reasoning",
                            "Musical preferences"
                        ],
                        correct: 0,
                        explanation: "Social engineers often impersonate authority figures because people tend to comply with perceived authority."
                    },
                    {
                        question: "What is the best defense against social engineering?",
                        options: [
                            "Strong passwords",
                            "Security awareness training",
                            "Firewalls",
                            "Antivirus software"
                        ],
                        correct: 1,
                        explanation: "Educated, aware users are the best defense since social engineering targets human psychology, not technical vulnerabilities."
                    }
                ]
            },
            {
                id: 9,
                title: "Encryption Mastery",
                description: "Learn about encryption algorithms and how to properly encrypt sensitive data.",
                icon: "fas fa-lock",
                xp: 325,
                tags: ["Encryption", "Cryptography"],
                completed: false,
                active: false,
                locked: true,
                tasks: [
                    "Understand symmetric vs asymmetric encryption",
                    "Learn about hash functions",
                    "Practice data encryption"
                ],
                questions: [
                    {
                        question: "What is the main difference between symmetric and asymmetric encryption?",
                        options: [
                            "Symmetric is faster",
                            "Symmetric uses one key, asymmetric uses key pairs",
                            "Asymmetric is older",
                            "Symmetric is only for emails"
                        ],
                        correct: 1,
                        explanation: "Symmetric encryption uses the same key for encryption and decryption, while asymmetric uses public/private key pairs."
                    },
                    {
                        question: "Which encryption algorithm is currently considered most secure for general use?",
                        options: [
                            "DES",
                            "AES-256",
                            "RC4",
                            "Blowfish"
                        ],
                        correct: 1,
                        explanation: "AES-256 (Advanced Encryption Standard with 256-bit keys) is currently considered very secure for general use."
                    },
                    {
                        question: "What does SSL/TLS provide for web communications?",
                        options: [
                            "Faster page loading",
                            "Encryption and authentication",
                            "Malware scanning",
                            "Content compression"
                        ],
                        correct: 1,
                        explanation: "SSL/TLS provides encryption for data in transit and authentication of servers to clients."
                    }
                ]
            },
            {
                id: 10,
                title: "Incident Response",
                description: "Respond to simulated security incidents following proper protocols.",
                icon: "fas fa-exclamation-triangle",
                xp: 450,
                tags: ["Incident Response", "Emergency"],
                completed: false,
                active: false,
                locked: true,
                tasks: [
                    "Follow incident response lifecycle",
                    "Practice containment procedures",
                    "Document incident findings"
                ],
                questions: [
                    {
                        question: "What is the first step in the incident response process?",
                        options: [
                            "Containment",
                            "Preparation",
                            "Eradication",
                            "Recovery"
                        ],
                        correct: 1,
                        explanation: "Preparation comes first - developing plans, procedures, and teams before incidents occur."
                    },
                    {
                        question: "During incident containment, what should be prioritized?",
                        options: [
                            "Preserving evidence",
                            "Stopping the spread and minimizing damage",
                            "Notifying the public",
                            "Punishing the responsible party"
                        ],
                        correct: 1,
                        explanation: "Containment focuses on limiting the scope and impact of the incident to prevent further damage."
                    },
                    {
                        question: "Why is documentation important in incident response?",
                        options: [
                            "It looks professional",
                            "For legal compliance and lessons learned",
                            "To share on social media",
                            "To bill clients"
                        ],
                        correct: 1,
                        explanation: "Documentation is crucial for legal compliance, insurance claims, and improving future response through lessons learned."
                    }
                ]
            },
            {
                id: 11,
                title: "Data Backup Strategies",
                description: "Learn and implement effective data backup and recovery plans.",
                icon: "fas fa-hdd",
                xp: 275,
                tags: ["Backup", "Recovery"],
                completed: false,
                active: false,
                locked: true,
                tasks: [
                    "Understand 3-2-1 backup rule",
                    "Compare backup types",
                    "Create recovery procedures"
                ],
                questions: [
                    {
                        question: "What is the 3-2-1 backup rule?",
                        options: [
                            "3 backups, 2 different media, 1 offsite",
                            "3 days retention, 2 locations, 1 verification",
                            "3 copies, 2 administrators, 1 test",
                            "3 types of backups, 2 encryption methods, 1 cloud"
                        ],
                        correct: 0,
                        explanation: "3-2-1 means: 3 copies of data, on 2 different media types, with 1 copy stored offsite."
                    },
                    {
                        question: "What is the difference between incremental and differential backups?",
                        options: [
                            "Incremental is faster",
                            "Incremental backs up changes since last backup, differential since last full backup",
                            "Differential uses less storage",
                            "They are the same"
                        ],
                        correct: 1,
                        explanation: "Incremental backs up changes since the last backup of any type, while differential backs up changes since the last full backup."
                    },
                    {
                        question: "Why should you test backup restoration regularly?",
                        options: [
                            "To use storage space",
                            "To ensure backups actually work when needed",
                            "To practice IT skills",
                            "To comply with regulations only"
                        ],
                        correct: 1,
                        explanation: "Regular testing ensures that backups are valid and can be restored successfully during an actual emergency."
                    }
                ]
            },
            {
                id: 12,
                title: "Web Application Security",
                description: "Identify and fix common web application vulnerabilities.",
                icon: "fas fa-globe",
                xp: 400,
                tags: ["Web Security", "Applications"],
                completed: false,
                active: false,
                locked: true,
                tasks: [
                    "Learn about OWASP Top 10",
                    "Identify SQL injection risks",
                    "Practice input validation"
                ],
                questions: [
                    {
                        question: "What is SQL injection?",
                        options: [
                            "Injecting SQL database into applications",
                            "Injecting malicious SQL code through user input",
                            "Backing up SQL databases",
                            "Optimizing SQL queries"
                        ],
                        correct: 1,
                        explanation: "SQL injection involves inserting malicious SQL code through user inputs to manipulate databases."
                    },
                    {
                        question: "What does XSS stand for and what is it?",
                        options: [
                            "XML Style Sheets - formatting web pages",
                            "Cross-Site Scripting - injecting malicious scripts",
                            "Extra Secure Session - enhanced security",
                            "Extended Security System - comprehensive protection"
                        ],
                        correct: 1,
                        explanation: "Cross-Site Scripting (XSS) allows attackers to inject malicious scripts into web pages viewed by other users."
                    },
                    {
                        question: "How can you prevent many web application vulnerabilities?",
                        options: [
                            "Use longer passwords",
                            "Implement proper input validation and output encoding",
                            "Disable JavaScript",
                            "Use only GET requests"
                        ],
                        correct: 1,
                        explanation: "Proper input validation and output encoding are fundamental to preventing many web application vulnerabilities."
                    }
                ]
            },
            {
                id: 13,
                title: "Mobile Security",
                description: "Secure mobile devices and applications against common threats.",
                icon: "fas fa-mobile-alt",
                xp: 300,
                tags: ["Mobile", "Security"],
                completed: false,
                active: false,
                locked: true,
                tasks: [
                    "Learn mobile device management",
                    "Understand app permission risks",
                    "Practice secure mobile browsing"
                ],
                questions: [
                    {
                        question: "What is a common risk with public Wi-Fi networks?",
                        options: [
                            "Man-in-the-middle attacks",
                            "Automatic software updates",
                            "Better connection speed",
                            "Free internet access"
                        ],
                        correct: 0,
                        explanation: "Public Wi-Fi is vulnerable to man-in-the-middle attacks where attackers intercept communications."
                    },
                    {
                        question: "Why should you review app permissions carefully?",
                        options: [
                            "To save storage space",
                            "To prevent apps from accessing unnecessary data",
                            "To make apps run faster",
                            "To get more features"
                        ],
                        correct: 1,
                        explanation: "Apps should only have permissions necessary for their function to limit data exposure."
                    },
                    {
                        question: "What is mobile device management (MDM)?",
                        options: [
                            "Managing mobile device inventory",
                            "Software to secure, monitor, and manage mobile devices",
                            "Selling mobile devices",
                            "Repairing mobile devices"
                        ],
                        correct: 1,
                        explanation: "MDM solutions help organizations secure, monitor, and manage mobile devices used by employees."
                    }
                ]
            },
            {
                id: 14,
                title: "Cloud Security",
                description: "Understand security considerations for cloud-based systems.",
                icon: "fas fa-cloud",
                xp: 350,
                tags: ["Cloud", "Security"],
                completed: false,
                active: false,
                locked: true,
                tasks: [
                    "Learn shared responsibility model",
                    "Understand cloud configuration risks",
                    "Practice cloud access controls"
                ],
                questions: [
                    {
                        question: "What is the shared responsibility model in cloud security?",
                        options: [
                            "Customers and providers share costs",
                            "Security responsibility is divided between cloud provider and customer",
                            "Multiple teams share security duties",
                            "Responsibility changes daily"
                        ],
                        correct: 1,
                        explanation: "Cloud providers secure the infrastructure, while customers secure their data, applications, and configurations."
                    },
                    {
                        question: "What is a common cloud security misconfiguration?",
                        options: [
                            "Using strong passwords",
                            "Publicly accessible storage buckets",
                            "Regular backups",
                            "Multi-factor authentication"
                        ],
                        correct: 1,
                        explanation: "Misconfigured storage buckets that are publicly accessible are a common cause of cloud data breaches."
                    },
                    {
                        question: "Why is identity and access management crucial in the cloud?",
                        options: [
                            "Cloud resources are accessible from anywhere",
                            "Cloud is inherently insecure",
                            "Cloud providers require it",
                            "It's cheaper than other security"
                        ],
                        correct: 0,
                        explanation: "With cloud resources accessible from anywhere, proper identity and access controls are essential to prevent unauthorized access."
                    }
                ]
            },
            {
                id: 15,
                title: "IoT Security",
                description: "Secure Internet of Things devices against vulnerabilities.",
                icon: "fas fa-wifi",
                xp: 325,
                tags: ["IoT", "Devices"],
                completed: false,
                active: false,
                locked: true,
                tasks: [
                    "Identify IoT security challenges",
                    "Learn device hardening techniques",
                    "Practice network segmentation"
                ],
                questions: [
                    {
                        question: "Why are IoT devices often insecure?",
                        options: [
                            "Manufacturers prioritize cost and convenience over security",
                            "IoT stands for 'Insecure Objects Technology'",
                            "They use outdated encryption",
                            "They can't receive updates"
                        ],
                        correct: 0,
                        explanation: "Many IoT manufacturers prioritize time-to-market and cost over security implementation."
                    },
                    {
                        question: "What is a botnet in the context of IoT?",
                        options: [
                            "A network of secure IoT devices",
                            "A network of compromised IoT devices controlled by attackers",
                            "A type of IoT wireless protocol",
                            "An IoT management tool"
                        ],
                        correct: 1,
                        explanation: "Botnets are networks of compromised devices (including IoT) used for coordinated attacks like DDoS."
                    },
                    {
                        question: "How can you improve IoT security at home?",
                        options: [
                            "Place IoT devices on a separate network",
                            "Use default passwords for convenience",
                            "Disable all security features for speed",
                            "Connect all devices to one network"
                        ],
                        correct: 0,
                        explanation: "Network segmentation (placing IoT devices on a separate network) limits potential damage if they're compromised."
                    }
                ]
            },
            {
                id: 16,
                title: "Compliance & Regulations",
                description: "Learn about cybersecurity compliance standards and regulations.",
                icon: "fas fa-gavel",
                xp: 275,
                tags: ["Compliance", "Regulations"],
                completed: false,
                active: false,
                locked: true,
                tasks: [
                    "Understand major compliance frameworks",
                    "Learn data protection requirements",
                    "Practice compliance documentation"
                ],
                questions: [
                    {
                        question: "What does GDPR stand for and what does it regulate?",
                        options: [
                            "General Data Protection Regulation - EU data privacy",
                            "Global Digital Protection Rules - internet security",
                            "Government Data Privacy Requirements - US data",
                            "General Device Protection Rules - IoT security"
                        ],
                        correct: 0,
                        explanation: "GDPR (General Data Protection Regulation) is the EU's data privacy and security law."
                    },
                    {
                        question: "What is the purpose of PCI DSS?",
                        options: [
                            "Protect payment card data",
                            "Secure government systems",
                            "Regulate social media",
                            "Standardize encryption"
                        ],
                        correct: 0,
                        explanation: "PCI DSS (Payment Card Industry Data Security Standard) protects credit card information."
                    },
                    {
                        question: "Why is compliance important beyond avoiding fines?",
                        options: [
                            "It's not important beyond fines",
                            "It builds customer trust and improves security",
                            "It increases profits directly",
                            "It reduces IT workload"
                        ],
                        correct: 1,
                        explanation: "Compliance builds customer trust, improves security posture, and can provide competitive advantage."
                    }
                ]
            },
            {
                id: 17,
                title: "Threat Intelligence",
                description: "Collect and analyze threat intelligence to predict attacks.",
                icon: "fas fa-brain",
                xp: 400,
                tags: ["Threats", "Intelligence"],
                completed: false,
                active: false,
                locked: true,
                tasks: [
                    "Learn threat intelligence lifecycle",
                    "Practice indicator analysis",
                    "Understand threat actor profiling"
                ],
                questions: [
                    {
                        question: "What are Indicators of Compromise (IOCs)?",
                        options: [
                            "Evidence that a security breach may have occurred",
                            "Indicators that systems are secure",
                            "Metrics for system performance",
                            "Employee satisfaction indicators"
                        ],
                        correct: 0,
                        explanation: "IOCs are pieces of forensic data that indicate potentially malicious activity on a system or network."
                    },
                    {
                        question: "What is the difference between tactical and strategic threat intelligence?",
                        options: [
                            "Tactical is for immediate defense, strategic for long-term planning",
                            "Tactical uses more colors in reports",
                            "Strategic is only for government",
                            "Tactical is free, strategic costs money"
                        ],
                        correct: 0,
                        explanation: "Tactical intelligence helps with immediate defense, while strategic intelligence informs long-term security planning."
                    },
                    {
                        question: "Why is sharing threat intelligence beneficial?",
                        options: [
                            "It helps the entire security community defend better",
                            "It's required by law",
                            "It makes organizations look good",
                            "It's only beneficial to government"
                        ],
                        correct: 0,
                        explanation: "Shared intelligence helps the entire community defend against common threats more effectively."
                    }
                ]
            },
            {
                id: 18,
                title: "Security Operations Center",
                description: "Manage and operate a simulated Security Operations Center.",
                icon: "fas fa-tv",
                xp: 500,
                tags: ["SOC", "Operations"],
                completed: false,
                active: false,
                locked: true,
                tasks: [
                    "Monitor security events",
                    "Analyze SIEM alerts",
                    "Coordinate incident response"
                ],
                questions: [
                    {
                        question: "What is a SIEM system?",
                        options: [
                            "Security Information and Event Management - collects and analyzes log data",
                            "Secure Internet Email Management - email security",
                            "System Integrity Enforcement Mechanism - integrity checking",
                            "Security Incident Evaluation Method - incident analysis"
                        ],
                        correct: 0,
                        explanation: "SIEM (Security Information and Event Management) collects, analyzes, and reports on security log data."
                    },
                    {
                        question: "What is the role of a SOC analyst?",
                        options: [
                            "Install security software",
                            "Monitor, detect, and respond to security incidents",
                            "Write security policies",
                            "Train employees"
                        ],
                        correct: 1,
                        explanation: "SOC analysts monitor security systems, detect threats, and initiate incident response."
                    },
                    {
                        question: "Why is alert tuning important in a SOC?",
                        options: [
                            "To reduce false positives and focus on real threats",
                            "To make alerts sound different",
                            "To comply with regulations",
                            "To test alert systems"
                        ],
                        correct: 0,
                        explanation: "Alert tuning reduces false positives so analysts can focus on genuine threats."
                    }
                ]
            },
            {
                id: 19,
                title: "Advanced Penetration Testing",
                description: "Conduct advanced penetration tests on simulated systems.",
                icon: "fas fa-shield-alt",
                xp: 600,
                tags: ["Penetration Testing", "Advanced"],
                completed: false,
                active: false,
                locked: true,
                tasks: [
                    "Perform vulnerability assessment",
                    "Execute controlled exploitation",
                    "Document findings ethically"
                ],
                questions: [
                    {
                        question: "What is the difference between penetration testing and vulnerability assessment?",
                        options: [
                            "Penetration testing exploits vulnerabilities, assessment only identifies them",
                            "Penetration testing is illegal",
                            "Assessment is more comprehensive",
                            "They are the same"
                        ],
                        correct: 0,
                        explanation: "Vulnerability assessment identifies weaknesses, while penetration testing attempts to exploit them to assess impact."
                    },
                    {
                        question: "Why is a scope document important in penetration testing?",
                        options: [
                            "It defines what systems can be tested and rules of engagement",
                            "It estimates costs",
                            "It lists team members",
                            "It's required for certification"
                        ],
                        correct: 0,
                        explanation: "The scope document defines authorized targets, methods, and limitations to ensure testing stays within legal/ethical bounds."
                    },
                    {
                        question: "What should be included in a penetration test report?",
                        options: [
                            "Only successful exploits",
                            "Findings, risk ratings, and remediation recommendations",
                            "All technical details without context",
                            "Only executive summary"
                        ],
                        correct: 1,
                        explanation: "Reports should include findings with risk ratings and actionable remediation recommendations."
                    }
                ]
            },
            {
                id: 20,
                title: "Cybersecurity Capstone",
                description: "Complete a comprehensive cybersecurity challenge integrating all skills learned.",
                icon: "fas fa-trophy",
                xp: 1000,
                tags: ["Capstone", "Final"],
                completed: false,
                active: false,
                locked: true,
                tasks: [
                    "Integrate multiple cybersecurity skills",
                    "Solve complex security scenarios",
                    "Demonstrate comprehensive understanding"
                ],
                questions: [
                    {
                        question: "What is defense in depth?",
                        options: [
                            "Using multiple layers of security controls",
                            "Having very deep firewalls",
                            "Hiding security systems deeply",
                            "Using complex passwords only"
                        ],
                        correct: 0,
                        explanation: "Defense in depth uses multiple, layered security controls so if one fails, others provide protection."
                    },
                    {
                        question: "Why is continuous monitoring important in cybersecurity?",
                        options: [
                            "Threats evolve constantly",
                            "It's required by law",
                            "It reduces costs",
                            "It makes systems faster"
                        ],
                        correct: 0,
                        explanation: "Continuous monitoring is essential because threats and vulnerabilities constantly evolve."
                    },
                    {
                        question: "What is the most important factor in cybersecurity success?",
                        options: [
                            "Expensive tools",
                            "People and processes supported by technology",
                            "Government regulations",
                            "Complex algorithms"
                        ],
                        correct: 1,
                        explanation: "While technology is important, well-trained people and effective processes are most critical for cybersecurity success."
                    }
                ]
            }
        ];

        // Badges data - 25 badges with specific requirements
        const badges = [
            { 
                id: 1, 
                name: "First Mission", 
                icon: "fas fa-flag",
                description: "Complete your first cybersecurity mission",
                earned: false 
            },
            { 
                id: 2, 
                name: "Phishing Hunter", 
                icon: "fas fa-fish",
                description: "Perfect score in Phishing Hunter game (4/4)",
                earned: false 
            },
            { 
                id: 3, 
                name: "Password Master", 
                icon: "fas fa-key",
                description: "Perfect score in Password Cracker game (5/5)",
                earned: false 
            },
            { 
                id: 4, 
                name: "URL Analyst", 
                icon: "fas fa-link",
                description: "Perfect score in URL Decoder game (5/5)",
                earned: false 
            },
            { 
                id: 5, 
                name: "Firewall Expert", 
                icon: "fas fa-fire",
                description: "Perfect score in Firewall Builder game",
                earned: false 
            },
            { 
                id: 6, 
                name: "Hash Matcher", 
                icon: "fas fa-fingerprint",
                description: "Perfect score in Hash Match game (4/4)",
                earned: false 
            },
            { 
                id: 7, 
                name: "Network Defender", 
                icon: "fas fa-network-wired",
                description: "Fix all vulnerabilities in Network Scanner game",
                earned: false 
            },
            { 
                id: 8, 
                name: "Encryption Guru", 
                icon: "fas fa-lock",
                description: "Perfect score in Encryption Challenge game",
                earned: false 
            },
            { 
                id: 9, 
                name: "Social Engineer", 
                icon: "fas fa-user-secret",
                description: "Perfect score in Social Engineering Quiz",
                earned: false 
            },
            { 
                id: 10, 
                name: "Incident Responder", 
                icon: "fas fa-exclamation-triangle",
                description: "Perfect score in Incident Response Simulator",
                earned: false 
            },
            { 
                id: 11, 
                name: "Digital Detective", 
                icon: "fas fa-search",
                description: "Perfect score in Digital Forensics Puzzle",
                earned: false 
            },
            { 
                id: 12, 
                name: "Mission Expert", 
                icon: "fas fa-tasks",
                description: "Complete 5 missions with 100% score",
                earned: false 
            },
            { 
                id: 13, 
                name: "Quick Learner", 
                icon: "fas fa-bolt",
                description: "Complete 3 missions in one day",
                earned: false 
            },
            { 
                id: 14, 
                name: "Game Master", 
                icon: "fas fa-gamepad",
                description: "Play all 10 mini-games at least once",
                earned: false 
            },
            { 
                id: 15, 
                name: "Perfect Streak", 
                icon: "fas fa-star",
                description: "Get perfect scores in 5 different games",
                earned: false 
            },
            { 
                id: 16, 
                name: "XP Collector", 
                icon: "fas fa-coins",
                description: "Reach 5,000 total XP",
                earned: false 
            },
            { 
                id: 17, 
                name: "Level 10", 
                icon: "fas fa-level-up-alt",
                description: "Reach player level 10",
                earned: false 
            },
            { 
                id: 18, 
                name: "Security Specialist", 
                icon: "fas fa-shield-alt",
                description: "Reach the Security Specialist rank",
                earned: false 
            },
            { 
                id: 19, 
                name: "Threat Hunter", 
                icon: "fas fa-crosshairs",
                description: "Reach the Threat Hunter rank",
                earned: false 
            },
            { 
                id: 20, 
                name: "Cyber Defender", 
                icon: "fas fa-user-shield",
                description: "Reach the Cyber Defender rank",
                earned: false 
            },
            { 
                id: 21, 
                name: "Security Architect", 
                icon: "fas fa-chess-board",
                description: "Reach the Security Architect rank",
                earned: false 
            },
            { 
                id: 22, 
                name: "Mission Complete", 
                icon: "fas fa-trophy",
                description: "Complete all 20 missions",
                earned: false 
            },
            { 
                id: 23, 
                name: "Game Champion", 
                icon: "fas fa-crown",
                description: "Get perfect scores in all 10 mini-games",
                earned: false 
            },
            { 
                id: 24, 
                name: "XP Master", 
                icon: "fas fa-gem",
                description: "Reach 25,000 total XP",
                earned: false 
            },
            { 
                id: 25, 
                name: "Cybersecurity Expert", 
                icon: "fas fa-certificate",
                description: "Reach the Cybersecurity Expert rank",
                earned: false 
            }
        ];

        // Game State - COMPLETELY RESET TO BEGINNING
        let gameState = {
            agentName: "",
            avatar: 1,
            xp: 0,
            level: 1,
            completedMissions: 0,
            badges: 0,
            gamesPlayed: 0,
            currentRank: "Cyber Novice",
            certificateEarned: false,
            hasCompletedWelcome: false,
            // Track game scores - ALL RESET
            gameScores: {
                phishing: { played: false, score: 0, perfect: false },
                password: { played: false, score: 0, perfect: false },
                url: { played: false, score: 0, perfect: false },
                firewall: { played: false, score: 0, perfect: false },
                hash: { played: false, score: 0, perfect: false },
                network: { played: false, score: 0, perfect: false },
                encryption: { played: false, score: 0, perfect: false },
                social: { played: false, score: 0, perfect: false },
                incident: { played: false, score: 0, perfect: false },
                forensics: { played: false, score: 0, perfect: false }
            }
        };

        // Game Data for ALL Mini-Games
        const gameData = {
            phishing: {
                title: "Phishing Hunter",
                description: "Identify which emails are legitimate and which are phishing attempts.",
                emails: [
                    {
                        from: "security@yourbank.com",
                        subject: "Urgent: Account Security Alert",
                        body: "Dear customer, we detected suspicious activity on your account. Please click here to verify your identity immediately or your account will be suspended.",
                        isPhishing: true
                    },
                    {
                        from: "support@netflix.com",
                        subject: "Your Netflix Subscription",
                        body: "Your monthly Netflix subscription has been renewed. Click here to view your receipt and payment details.",
                        isPhishing: false
                    },
                    {
                        from: "noreply@amaz0n.com",
                        subject: "Order Confirmation #A123456789",
                        body: "Your order #12345 has been confirmed. Please click here to track your package. Note: You must verify your payment within 24 hours.",
                        isPhishing: true
                    },
                    {
                        from: "payments@paypal.com",
                        subject: "Payment Received - Transaction #PP987654321",
                        body: "You've received a payment of $150.00 from John Smith. Click here to view the transaction details in your PayPal account.",
                        isPhishing: false
                    }
                ]
            },
            password: {
                title: "Password Cracker",
                description: "Identify the weakest password from the options.",
                challenges: [
                    {
                        question: "Which password is the weakest and most vulnerable?",
                        options: ["P@ssw0rd123", "MyDogName2023", "Tr0ub4dor&3", "Xk8$2mLp#9Qw"],
                        correct: 1,
                        explanation: "'MyDogName2023' uses common personal information and patterns that are easily guessable."
                    },
                    {
                        question: "Which password follows cybersecurity best practices?",
                        options: ["12345678", "password", "Summer2023!", "CorrectHorseBatteryStaple"],
                        correct: 3,
                        explanation: "'CorrectHorseBatteryStaple' is a passphrase with high entropy and no personal information."
                    },
                    {
                        question: "Which password is most vulnerable to dictionary attacks?",
                        options: ["F1sh&Ch1ps", "M0nkeyBanana", "Sunshine123", "G7$kL2m#pQ"],
                        correct: 2,
                        explanation: "'Sunshine123' contains a common word followed by numbers, making it vulnerable to dictionary attacks."
                    },
                    {
                        question: "Which password would take the longest to crack?",
                        options: ["Admin123!", "Qwerty2024", "Winter#2024", "Th3Qu1ckBr0wnF0x!"],
                        correct: 3,
                        explanation: "'Th3Qu1ckBr0wnF0x!' combines length, complexity, and unpredictability for maximum security."
                    },
                    {
                        question: "What makes a password strong?",
                        options: ["Using your birth year", "Replacing letters with similar numbers", "Length and randomness", "Using dictionary words backwards"],
                        correct: 2,
                        explanation: "Length and randomness are the most important factors for password strength."
                    }
                ]
            },
            url: {
                title: "URL Decoder",
                description: "Analyze URLs to identify which ones are malicious.",
                challenges: [
                    {
                        url: "https://secure-bank-login.com/verify",
                        analysis: "Uses 'secure-bank-login' which mimics legitimate banking sites but the domain is not a real bank.",
                        isMalicious: true
                    },
                    {
                        url: "https://www.amazon.com/gp/product/B08N5WRWNW",
                        analysis: "Legitimate Amazon product URL with proper domain structure.",
                        isMalicious: false
                    },
                    {
                        url: "http://paypa1-security-update.com/login",
                        analysis: "Uses 'paypa1' (with number 1 instead of letter l) - classic typosquatting technique.",
                        isMalicious: true
                    },
                    {
                        url: "https://github.com/security/advisories",
                        analysis: "Legitimate GitHub security advisories page.",
                        isMalicious: false
                    },
                    {
                        url: "https://update-facebook.xyz/profile",
                        analysis: "Uses '.xyz' domain which is often used for malicious sites pretending to be Facebook.",
                        isMalicious: true
                    }
                ]
            },
            firewall: {
                title: "Firewall Builder",
                description: "Drag firewall rules in the correct order to block attacks while allowing legitimate traffic.",
                rules: [
                    { id: 1, text: "Block all traffic from known malicious IP addresses", correctPosition: 1 },
                    { id: 2, text: "Allow established connections", correctPosition: 2 },
                    { id: 3, text: "Allow HTTP/HTTPS traffic on ports 80/443", correctPosition: 3 },
                    { id: 4, text: "Allow SSH on port 22 from management network", correctPosition: 4 },
                    { id: 5, text: "Block all other incoming traffic", correctPosition: 5 }
                ]
            },
            hash: {
                title: "Hash Match",
                description: "Match plain text with their correct hash values.",
                pairs: [
                    { plain: "password123", hash: "482c811da5d5b4bc6d497ffa98491e38" },
                    { plain: "admin", hash: "21232f297a57a5a743894a0e4a801fc3" },
                    { plain: "hello", hash: "5d41402abc4b2a76b9719d911017c592" },
                    { plain: "cybersecurity", hash: "9b5c3a7e9f2d1c4a6b8e0d7f5a3c2b1e" }
                ]
            },
            network: {
                title: "Network Scanner",
                description: "Scan network devices and identify vulnerabilities.",
                devices: [
                    { id: 1, name: "Web Server", type: "server", vulnerable: true, ports: [80, 443, 22], description: "Running outdated Apache version" },
                    { id: 2, name: "Database Server", type: "database", vulnerable: false, ports: [3306], description: "Properly configured MySQL" },
                    { id: 3, name: "File Server", type: "server", vulnerable: true, ports: [21, 445], description: "Anonymous FTP enabled" },
                    { id: 4, name: "Router", type: "network", vulnerable: false, ports: [23, 80], description: "Latest firmware, strong passwords" },
                    { id: 5, name: "Workstation", type: "desktop", vulnerable: true, ports: [135, 139, 445], description: "Unpatched Windows vulnerabilities" }
                ]
            },
            encryption: {
                title: "Encryption Challenge",
                description: "Answer questions about encryption algorithms and techniques.",
                questions: [
                    {
                        question: "Which encryption algorithm is considered most secure for general use?",
                        options: ["DES", "AES-256", "RC4", "Blowfish"],
                        correct: 1,
                        explanation: "AES-256 is currently considered the most secure symmetric encryption algorithm for general use."
                    },
                    {
                        question: "What is the main advantage of asymmetric encryption?",
                        options: ["Faster encryption speed", "No need to share secret keys", "Smaller key sizes", "Easier to implement"],
                        correct: 1,
                        explanation: "Asymmetric encryption uses public/private key pairs, eliminating the need to share secret keys."
                    },
                    {
                        question: "Which of these is NOT a hashing algorithm?",
                        options: ["SHA-256", "MD5", "RSA", "SHA-1"],
                        correct: 2,
                        explanation: "RSA is an encryption algorithm, not a hashing algorithm."
                    },
                    {
                        question: "What does SSL/TLS provide for web communications?",
                        options: ["Faster page loading", "Encryption and authentication", "Malware scanning", "Content compression"],
                        correct: 1,
                        explanation: "SSL/TLS provides encryption for data in transit and authentication of servers."
                    }
                ]
            },
            social: {
                title: "Social Engineering Quiz",
                description: "Identify social engineering tactics and defense strategies.",
                questions: [
                    {
                        question: "What is the primary goal of social engineering?",
                        options: ["To hack computers directly", "To manipulate people into revealing information", "To spread malware", "To overload networks"],
                        correct: 1,
                        explanation: "Social engineering manipulates people, not computers, to gain unauthorized access or information."
                    },
                    {
                        question: "Which technique involves creating a fabricated scenario?",
                        options: ["Phishing", "Pretexting", "Baiting", "Tailgating"],
                        correct: 1,
                        explanation: "Pretexting involves creating a false scenario to obtain information under false pretenses."
                    },
                    {
                        question: "What should you do if you receive a suspicious call asking for credentials?",
                        options: ["Provide minimal information", "Verify the caller's identity through official channels", "Hang up immediately", "Ask for a callback number"],
                        correct: 1,
                        explanation: "Always verify identity through official, independent channels before sharing sensitive information."
                    },
                    {
                        question: "Which psychological principle do social engineers often exploit?",
                        options: ["Authority and urgency", "Logical reasoning", "Technical knowledge", "Mathematical ability"],
                        correct: 0,
                        explanation: "Social engineers exploit authority, urgency, reciprocity, and other psychological principles."
                    }
                ]
            },
            incident: {
                title: "Incident Response",
                description: "Choose the correct steps in incident response order.",
                scenarios: [
                    {
                        scenario: "You discover a ransomware infection on a critical server.",
                        steps: [
                            "Isolate the infected system from the network",
                            "Identify the ransomware variant and scope",
                            "Notify the incident response team",
                            "Begin recovery from backups",
                            "Document the incident and lessons learned"
                        ],
                        correctOrder: [2, 0, 1, 3, 4]
                    },
                    {
                        scenario: "A data breach is suspected involving customer information.",
                        steps: [
                            "Secure and preserve evidence",
                            "Determine what data was compromised",
                            "Notify legal and compliance teams",
                            "Implement additional monitoring",
                            "Communicate with affected parties"
                        ],
                        correctOrder: [1, 0, 2, 4, 3]
                    }
                ]
            },
            forensics: {
                title: "Digital Forensics",
                description: "Analyze digital evidence to solve cybersecurity puzzles.",
                puzzles: [
                    {
                        evidence: "Log file shows failed login attempts from IP 192.168.1.100 at 2:30 AM",
                        question: "What type of attack is this likely to be?",
                        options: ["Phishing", "Brute force attack", "Malware infection", "DNS spoofing"],
                        correct: 1,
                        explanation: "Multiple failed login attempts, especially at unusual hours, suggest a brute force attack."
                    },
                    {
                        evidence: "File modified timestamp doesn't match creation timestamp",
                        question: "What does this inconsistency suggest?",
                        options: ["Normal file operation", "Possible evidence tampering", "Hardware failure", "Software bug"],
                        correct: 1,
                        explanation: "Timestamp inconsistencies can indicate file tampering or attempts to hide activities."
                    }
                ]
            }
        };

        // =============================================
        // SAVE/LOAD SYSTEM - SOLUTION 1 + 2 + 3
        // =============================================
        const SAVE_KEY = 'cyberguard-save-data';
        let autoSaveInterval;

        // Function to save game progress
        function saveGame() {
            const saveData = {
                agentName: gameState.agentName,
                avatar: gameState.avatar,
                xp: gameState.xp,
                level: gameState.level,
                completedMissions: gameState.completedMissions,
                badges: gameState.badges,
                gamesPlayed: gameState.gamesPlayed,
                currentRank: gameState.currentRank,
                certificateEarned: gameState.certificateEarned,
                hasCompletedWelcome: gameState.hasCompletedWelcome,
                gameScores: gameState.gameScores,
                // Save mission progress
                missions: missions.map(m => ({
                    id: m.id,
                    completed: m.completed,
                    active: m.active,
                    locked: m.locked
                })),
                // Save badge progress
                badgesState: badges.map(b => ({
                    id: b.id,
                    earned: b.earned
                })),
                // Save timestamp
                lastSaved: new Date().toISOString()
            };
            
            localStorage.setItem(SAVE_KEY, JSON.stringify(saveData));
            console.log('Game saved!');
            showNotification('Game progress saved successfully!', 'Save Complete');
        }

        // Function to load game progress
        function loadGame() {
            const saved = localStorage.getItem(SAVE_KEY);
            if (!saved) {
                console.log('No saved game found.');
                showNotification('No saved game found. Starting fresh.', 'Load Failed');
                return false;
            }
            
            try {
                const saveData = JSON.parse(saved);
                
                // Restore gameState
                gameState.agentName = saveData.agentName;
                gameState.avatar = saveData.avatar;
                gameState.xp = saveData.xp;
                gameState.level = saveData.level;
                gameState.completedMissions = saveData.completedMissions;
                gameState.badges = saveData.badges;
                gameState.gamesPlayed = saveData.gamesPlayed;
                gameState.currentRank = saveData.currentRank;
                gameState.certificateEarned = saveData.certificateEarned;
                gameState.hasCompletedWelcome = saveData.hasCompletedWelcome;
                gameState.gameScores = saveData.gameScores;
                
                // Restore missions
                if (saveData.missions) {
                    saveData.missions.forEach(savedMission => {
                        const mission = missions.find(m => m.id === savedMission.id);
                        if (mission) {
                            mission.completed = savedMission.completed;
                            mission.active = savedMission.active;
                            mission.locked = savedMission.locked;
                        }
                    });
                }
                
                // Restore badges
                if (saveData.badgesState) {
                    saveData.badgesState.forEach(savedBadge => {
                        const badge = badges.find(b => b.id === savedBadge.id);
                        if (badge) {
                            badge.earned = savedBadge.earned;
                        }
                    });
                }
                
                console.log('Game loaded successfully!');
                showNotification(`Game loaded! Welcome back, ${gameState.agentName}!`, 'Load Successful');
                return true;
            } catch (error) {
                console.error('Error loading saved game:', error);
                showNotification('Error loading saved game. Starting fresh.', 'Load Error');
                return false;
            }
        }

        // Function to reset and clear saved data
        function resetGame() {
            if (confirm('Are you sure you want to reset all progress? This cannot be undone!')) {
                localStorage.removeItem(SAVE_KEY);
                stopAutoSave();
                resetAllProgress();
                showNotification('All progress has been reset. Starting fresh!', 'Reset Complete');
            }
        }

        // Function to start auto-save
        function startAutoSave() {
            // Clear existing interval if any
            if (autoSaveInterval) {
                clearInterval(autoSaveInterval);
            }
            
            // Save every 30 seconds
            autoSaveInterval = setInterval(() => {
                if (gameState.hasCompletedWelcome) {
                    saveGame();
                }
            }, 30000); // 30 seconds
            
            console.log('Auto-save started (every 30 seconds)');
        }

        // Function to stop auto-save
        function stopAutoSave() {
            if (autoSaveInterval) {
                clearInterval(autoSaveInterval);
                autoSaveInterval = null;
                console.log('Auto-save stopped');
            }
        }

        // =============================================
        // END OF SAVE/LOAD SYSTEM
        // =============================================

        // DOM Elements
        const welcomeModal = document.getElementById('welcome-modal');
        const welcomeForm = document.getElementById('welcome-form');
        const agentNameInput = document.getElementById('agent-name-input');
        const avatarOptions = document.querySelectorAll('.avatar-option');
        const navbar = document.getElementById('navbar');
        const mainContent = document.getElementById('main-content');
        const pages = document.querySelectorAll('.page');
        const navLinks = document.querySelectorAll('.nav-link');
        const notification = document.getElementById('notification');
        const notificationTitle = document.getElementById('notification-title');
        const notificationMessage = document.getElementById('notification-message');
        const missionModal = document.getElementById('mission-modal');
        const missionModalTitle = document.getElementById('mission-modal-title');
        const missionModalBody = document.getElementById('mission-modal-body');
        const missionClose = document.getElementById('mission-close');
        const gameModal = document.getElementById('game-modal');
        const gameModalTitle = document.getElementById('game-modal-title');
        const gameModalBody = document.getElementById('game-modal-body');
        const gameClose = document.getElementById('game-close');
        const certificateModal = document.getElementById('certificate-modal');
        const certificateClose = document.getElementById('certificate-close');
        const closeCertificateBtn = document.getElementById('close-certificate-btn');
        const downloadCertificateBtn = document.getElementById('download-certificate-btn');
        const viewCertificateBtn = document.getElementById('view-certificate-btn');
        
        // Save/Load buttons
        const saveGameBtn = document.getElementById('save-game-btn');
        const loadGameBtn = document.getElementById('load-game-btn');
        const resetGameBtn = document.getElementById('reset-game-btn');
        
        // Profile elements
        const agentNameDisplay = document.getElementById('agent-name-display');
        const profileNameDisplay = document.getElementById('profile-name-display');
        const profileAvatar = document.getElementById('profile-avatar');
        const avatarIcon = document.getElementById('avatar-icon');
        const avatarUpload = document.getElementById('avatar-upload');
        
        // Stats elements
        const xpCount = document.getElementById('xp-count');
        const levelBadge = document.getElementById('level-badge');
        const completedMissionsElement = document.getElementById('completed-missions');
        const totalXp = document.getElementById('total-xp');
        const currentRank = document.getElementById('current-rank');
        const badgesEarned = document.getElementById('badges-earned');
        
        // Profile page elements
        const profileLevel = document.getElementById('profile-level');
        const profileXp = document.getElementById('profile-xp');
        const profileMissions = document.getElementById('profile-missions');
        const profileBadges = document.getElementById('profile-badges');
        const profileGames = document.getElementById('profile-games');
        const currentXp = document.getElementById('current-xp');
        const nextLevelXp = document.getElementById('next-level-xp');
        const levelProgress = document.getElementById('level-progress');
        const rankProgress = document.getElementById('rank-progress');
        const badgesGrid = document.getElementById('badges-grid');
        
        // Certificate elements
        const certificateName = document.getElementById('certificate-name');
        const certificateDate = document.getElementById('certificate-date');
        const certificateId = document.getElementById('certificate-id');
        
        // Learning Hub elements
        const hubTopics = document.querySelectorAll('.hub-topic');
        const hubTitle = document.getElementById('hub-title');
        const hubContent = document.getElementById('hub-content');

        // Reset function to clear all progress
        function resetAllProgress() {
            // Reset game state to beginning
            gameState = {
                agentName: "",
                avatar: 1,
                xp: 0,
                level: 1,
                completedMissions: 0,
                badges: 0,
                gamesPlayed: 0,
                currentRank: "Cyber Novice",
                certificateEarned: false,
                hasCompletedWelcome: false,
                gameScores: {
                    phishing: { played: false, score: 0, perfect: false },
                    password: { played: false, score: 0, perfect: false },
                    url: { played: false, score: 0, perfect: false },
                    firewall: { played: false, score: 0, perfect: false },
                    hash: { played: false, score: 0, perfect: false },
                    network: { played: false, score: 0, perfect: false },
                    encryption: { played: false, score: 0, perfect: false },
                    social: { played: false, score: 0, perfect: false },
                    incident: { played: false, score: 0, perfect: false },
                    forensics: { played: false, score: 0, perfect: false }
                }
            };
            
            // Reset missions
            missions.forEach((mission, index) => {
                mission.completed = false;
                mission.active = (index === 0);
                mission.locked = (index !== 0);
            });
            
            // Reset badges
            badges.forEach(badge => {
                badge.earned = false;
            });
            
            // Reset UI
            updateStats();
            loadDashboardMissions();
            loadAllMissions();
            loadBadges();
            updateCertificateButton();
            
            // Show welcome modal
            welcomeModal.classList.add('active');
            navbar.style.display = 'none';
            mainContent.style.display = 'none';
        }

        // Initialize the game
        function initGame() {
            // Try to load saved game first
            const loaded = loadGame();
            
            if (!loaded) {
                // No saved game found, start fresh
                resetAllProgress();
            } else {
                // Game loaded successfully, show main interface
                welcomeModal.classList.remove('active');
                navbar.style.display = 'flex';
                mainContent.style.display = 'block';
                updateStats();
                loadDashboardMissions();
                loadAllMissions();
                loadBadges();
                updateCertificateButton();
                
                // Start auto-save
                startAutoSave();
            }
            
            // Setup event listeners
            setupEventListeners();
            
            // Load learning hub content
            loadLearningContent('phishing');
            
            // Update footer years
            updateFooterYears();
            
            // Setup auto-save and page unload handlers
            setupSaveHandlers();
        }

        // Setup save/load handlers
        function setupSaveHandlers() {
            // Save on page unload
            window.addEventListener('beforeunload', () => {
                if (gameState.hasCompletedWelcome) {
                    saveGame();
                }
            });

            // Save when tab becomes inactive
            document.addEventListener('visibilitychange', () => {
                if (document.hidden && gameState.hasCompletedWelcome) {
                    saveGame();
                }
            });
        }

        // Update footer years to 2025
        function updateFooterYears() {
            const footerElements = document.querySelectorAll('.footer p');
            footerElements.forEach(footer => {
                footer.innerHTML = footer.innerHTML.replace(/2024/g, '2025');
            });
        }

        // Setup event listeners
        function setupEventListeners() {
            // Welcome form
            welcomeForm.addEventListener('submit', (e) => {
                e.preventDefault();
                const name = agentNameInput.value.trim() || "Agent";
                gameState.agentName = name;
                gameState.avatar = parseInt(document.querySelector('.avatar-option.selected').getAttribute('data-avatar'));
                gameState.hasCompletedWelcome = true;
                welcomeModal.classList.remove('active');
                startGame();
            });
            
            // Avatar selection
            avatarOptions.forEach(option => {
                option.addEventListener('click', () => {
                    avatarOptions.forEach(opt => opt.classList.remove('selected'));
                    option.classList.add('selected');
                });
            });
            
            // Navigation
            navLinks.forEach(link => {
                link.addEventListener('click', (e) => {
                    e.preventDefault();
                    const pageId = link.getAttribute('data-page');
                    
                    // Update active nav link
                    navLinks.forEach(navLink => navLink.classList.remove('active'));
                    link.classList.add('active');
                    
                    // Show selected page
                    pages.forEach(page => page.classList.remove('active'));
                    document.getElementById(pageId).classList.add('active');
                    
                    // Load specific page data
                    if (pageId === 'dashboard') {
                        loadDashboardMissions();
                    } else if (pageId === 'missions') {
                        loadAllMissions();
                    } else if (pageId === 'profile') {
                        loadProfileData();
                    } else if (pageId === 'hub') {
                        // Learning hub is already loaded
                    }
                });
            });
            
            // Mission modal close
            missionClose.addEventListener('click', () => {
                missionModal.classList.remove('active');
            });
            
            // Game modal close
            gameClose.addEventListener('click', () => {
                gameModal.classList.remove('active');
            });
            
            // Certificate modal close
            certificateClose.addEventListener('click', () => {
                certificateModal.classList.remove('active');
            });
            
            closeCertificateBtn.addEventListener('click', () => {
                certificateModal.classList.remove('active');
            });
            
            // View certificate button
            viewCertificateBtn.addEventListener('click', () => {
                showCertificate();
            });
            
            // Download certificate button
            downloadCertificateBtn.addEventListener('click', () => {
                downloadCertificate();
            });
            
            // Save/Load buttons
            saveGameBtn.addEventListener('click', () => {
                if (gameState.hasCompletedWelcome) {
                    saveGame();
                } else {
                    showNotification('Please complete the welcome setup first.', 'Cannot Save');
                }
            });
            
            loadGameBtn.addEventListener('click', () => {
                if (confirm('Load saved game? Current unsaved progress will be lost.')) {
                    const loaded = loadGame();
                    if (loaded) {
                        updateStats();
                        loadDashboardMissions();
                        loadAllMissions();
                        loadBadges();
                        updateCertificateButton();
                        showNotification('Game loaded successfully!', 'Load Complete');
                    }
                }
            });
            
            resetGameBtn.addEventListener('click', () => {
                resetGame();
            });
            
            // Profile editing
            profileNameDisplay.addEventListener('click', () => {
                const currentName = profileNameDisplay.textContent;
                const input = document.createElement('input');
                input.type = 'text';
                input.value = currentName;
                input.className = 'profile-name-input';
                
                input.addEventListener('blur', () => {
                    saveProfileName(input.value);
                });
                
                input.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') {
                        saveProfileName(input.value);
                    }
                });
                
                profileNameDisplay.replaceWith(input);
                input.focus();
            });
            
            // Profile avatar click
            profileAvatar.addEventListener('click', () => {
                avatarUpload.click();
            });
            
            avatarUpload.addEventListener('change', (e) => {
                if (e.target.files && e.target.files[0]) {
                    const reader = new FileReader();
                    reader.onload = (event) => {
                        showNotification("Avatar updated! (Note: Image would be saved in a real application)", "Profile Updated");
                    };
                    reader.readAsDataURL(e.target.files[0]);
                }
            });
            
            // Game start buttons
            document.querySelectorAll('.start-game-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const gameType = e.target.getAttribute('data-game');
                    startMiniGame(gameType);
                });
            });
            
            // Learning hub topics
            hubTopics.forEach(topic => {
                topic.addEventListener('click', () => {
                    // Update active topic
                    hubTopics.forEach(t => t.classList.remove('active'));
                    topic.classList.add('active');
                    
                    // Load content
                    const topicId = topic.getAttribute('data-topic');
                    loadLearningContent(topicId);
                });
            });
            
            // Mission buttons (delegated event listener)
            document.addEventListener('click', (e) => {
                if (e.target.classList.contains('mission-btn')) {
                    const missionId = parseInt(e.target.getAttribute('data-id'));
                    const mission = missions.find(m => m.id === missionId);
                    
                    if (mission && !mission.completed && !mission.locked) {
                        startMission(mission);
                    }
                }
                
                // Mission question options
                if (e.target.classList.contains('option-btn') && !e.target.classList.contains('correct') && !e.target.classList.contains('incorrect')) {
                    const questionIndex = parseInt(e.target.closest('.mission-question').getAttribute('data-index'));
                    const optionIndex = parseInt(e.target.getAttribute('data-option'));
                    
                    selectMissionAnswer(questionIndex, optionIndex);
                }
                
                // Mission next question button
                if (e.target.id === 'next-question-btn') {
                    nextMissionQuestion();
                }
                
                // Mission submit button
                if (e.target.id === 'submit-mission') {
                    submitMissionAnswers();
                }
            });
            
            // Close modal when clicking outside
            window.addEventListener('click', (e) => {
                if (e.target === missionModal) {
                    missionModal.classList.remove('active');
                }
                if (e.target === gameModal) {
                    gameModal.classList.remove('active');
                }
                if (e.target === certificateModal) {
                    certificateModal.classList.remove('active');
                }
            });
        }

        // Start the game after welcome
        function startGame() {
            navbar.style.display = 'flex';
            mainContent.style.display = 'block';
            updateStats();
            loadDashboardMissions();
            loadAllMissions();
            loadBadges();
            showNotification(`Welcome to CyberGuard Quest, ${gameState.agentName}! Complete your first mission to earn XP.`, "Welcome Agent");
            
            // Start auto-save
            startAutoSave();
            
            // Save initial state
            setTimeout(() => saveGame(), 1000);
        }

        // Update game stats
        function updateStats() {
            // Update agent name
            agentNameDisplay.textContent = gameState.agentName;
            profileNameDisplay.textContent = gameState.agentName;
            
            // Update avatar
            const avatarIcons = ['fa-user-secret', 'fa-user-ninja', 'fa-user-shield', 'fa-robot', 'fa-hat-wizard', 'fa-mask'];
            avatarIcon.className = `fas ${avatarIcons[gameState.avatar - 1] || 'fa-user-secret'}`;
            
            // Update XP and level
            xpCount.textContent = gameState.xp;
            
            // Calculate level based on XP: Level = floor(XP / 250) + 1
            const newLevel = Math.floor(gameState.xp / 250) + 1;
            if (newLevel > gameState.level) {
                gameState.level = newLevel;
                showNotification(`Level Up! You reached Level ${gameState.level}!`, "Level Up!");
            } else {
                gameState.level = newLevel;
            }
            
            // Ensure level is at least 1
            if (gameState.level < 1) gameState.level = 1;
            
            levelBadge.textContent = `Level ${gameState.level}`;
            
            // Update stats
            completedMissionsElement.textContent = `${gameState.completedMissions}/${missions.length}`;
            totalXp.textContent = gameState.xp;
            currentRank.textContent = gameState.currentRank;
            badgesEarned.textContent = `${gameState.badges}/${badges.length}`;
            
            // Update profile stats
            profileLevel.textContent = gameState.level;
            profileXp.textContent = gameState.xp;
            profileMissions.textContent = `${gameState.completedMissions}/${missions.length}`;
            profileBadges.textContent = `${gameState.badges}/${badges.length}`;
            profileGames.textContent = gameState.gamesPlayed;
            
            // Calculate XP for next level
            const xpForCurrentLevel = (gameState.level - 1) * 250;
            const xpForNextLevel = gameState.level * 250;
            
            currentXp.textContent = gameState.xp;
            nextLevelXp.textContent = xpForNextLevel;
            
            // Update level progress bar
            const levelProgressPercent = Math.min(((gameState.xp - xpForCurrentLevel) / (xpForNextLevel - xpForCurrentLevel)) * 100, 100);
            levelProgress.style.width = `${levelProgressPercent}%`;
            
            // Update rank based on XP
            updateRank();
            
            // Update rank progression display
            updateRankProgression();
            
            // Check for badges
            checkBadges();
            
            // Update certificate button
            updateCertificateButton();
            
            // Auto-save when stats change
            if (gameState.hasCompletedWelcome) {
                setTimeout(() => saveGame(), 500);
            }
        }

        // Update player rank
        function updateRank() {
            const oldRank = gameState.currentRank;
            
            // Rank thresholds in ascending order
            if (gameState.xp >= 25000) {
                gameState.currentRank = "Cybersecurity Expert";
            } else if (gameState.xp >= 15000) {
                gameState.currentRank = "Security Architect";
            } else if (gameState.xp >= 10000) {
                gameState.currentRank = "Cyber Defender";
            } else if (gameState.xp >= 6000) {
                gameState.currentRank = "Threat Hunter";
            } else if (gameState.xp >= 3500) {
                gameState.currentRank = "Security Specialist";
            } else if (gameState.xp >= 1500) {
                gameState.currentRank = "Cyber Analyst";
            } else if (gameState.xp >= 500) {
                gameState.currentRank = "Security Trainee";
            } else {
                gameState.currentRank = "Cyber Novice";
            }
            
            // Update display if rank changed
            if (oldRank !== gameState.currentRank) {
                currentRank.textContent = gameState.currentRank;
                document.getElementById('profile-title').textContent = gameState.currentRank;
                
                // Award rank badges
                if (gameState.currentRank === "Security Specialist") awardBadge(18);
                if (gameState.currentRank === "Threat Hunter") awardBadge(19);
                if (gameState.currentRank === "Cyber Defender") awardBadge(20);
                if (gameState.currentRank === "Security Architect") awardBadge(21);
                if (gameState.currentRank === "Cybersecurity Expert") {
                    awardBadge(25);
                    gameState.certificateEarned = true;
                    updateCertificateButton();
                    showNotification("Congratulations! You've reached the highest rank: Cybersecurity Expert! You've earned a certificate.", "Legendary Achievement!");
                } else if (oldRank !== gameState.currentRank) {
                    showNotification(`Congratulations! You've been promoted to ${gameState.currentRank}!`, "Rank Up!");
                }
            } else {
                // Always ensure the profile title is updated even if rank didn't change
                document.getElementById('profile-title').textContent = gameState.currentRank;
            }
        }

        // Update rank progression display
        function updateRankProgression() {
            // Rank XP thresholds
            const rankXP = {
                "Cyber Novice": 0,
                "Security Trainee": 500,
                "Cyber Analyst": 1500,
                "Security Specialist": 3500,
                "Threat Hunter": 6000,
                "Cyber Defender": 10000,
                "Security Architect": 15000,
                "Cybersecurity Expert": 25000
            };
            
            const ranks = Object.keys(rankXP);
            const currentRank = gameState.currentRank;
            const currentIndex = ranks.indexOf(currentRank);
            
            // Update next rank display
            const nextRankNameElement = document.getElementById('next-rank-name');
            const nextRankXpElement = document.getElementById('next-rank-xp');
            
            if (currentIndex < ranks.length - 1) {
                // There is a next rank
                const nextRank = ranks[currentIndex + 1];
                const nextRankXP = rankXP[nextRank];
                const currentRankXP = rankXP[currentRank];
                
                nextRankNameElement.textContent = nextRank;
                nextRankXpElement.textContent = nextRankXP;
                
                // Calculate progress percentage
                const progress = gameState.xp - currentRankXP;
                const total = nextRankXP - currentRankXP;
                const progressPercent = Math.min((progress / total) * 100, 100);
                
                rankProgress.style.width = `${progressPercent}%`;
            } else {
                // At highest rank
                nextRankNameElement.textContent = currentRank;
                nextRankXpElement.textContent = rankXP[currentRank];
                rankProgress.style.width = '100%';
            }
        }

        // Load missions on dashboard
        function loadDashboardMissions() {
            const dashboardMissions = document.getElementById('dashboard-missions');
            dashboardMissions.innerHTML = '';
            
            // Show only active and next missions on dashboard
            const activeMission = missions.find(m => m.active);
            const nextMissions = missions.filter(m => !m.completed && !m.active && !m.locked).slice(0, 2);
            const missionsToShow = activeMission ? [activeMission, ...nextMissions] : nextMissions.slice(0, 3);
            
            missionsToShow.forEach(mission => {
                const missionCard = createMissionCard(mission);
                dashboardMissions.appendChild(missionCard);
            });
        }

        // Load all missions on missions page
        function loadAllMissions() {
            const missionsGrid = document.getElementById('missions-grid');
            missionsGrid.innerHTML = '';
            
            missions.forEach(mission => {
                const missionCard = createMissionCard(mission);
                missionsGrid.appendChild(missionCard);
            });
        }

        // Create mission card HTML
        function createMissionCard(mission) {
            const card = document.createElement('div');
            card.className = 'mission-card';
            
            if (mission.completed) card.classList.add('completed');
            if (mission.active) card.classList.add('active');
            if (mission.locked) card.classList.add('locked');
            
            card.innerHTML = `
                <div class="mission-header">
                    <div class="mission-icon">
                        <i class="${mission.icon}"></i>
                    </div>
                    <div class="mission-xp">
                        <i class="fas fa-star"></i> ${mission.xp} XP
                    </div>
                </div>
                <h3 class="mission-title">${mission.title}</h3>
                <p class="mission-desc">${mission.description}</p>
                <div class="mission-tags">
                    ${mission.tags.map(tag => `<span class="mission-tag">${tag}</span>`).join('')}
                </div>
                <button class="mission-btn" data-id="${mission.id}" ${mission.locked ? 'disabled' : ''}>
                    ${mission.completed ? 'Completed' : mission.active ? 'Continue Mission' : mission.locked ? 'Locked' : 'Start Mission'}
                </button>
            `;
            
            return card;
        }

        // Start a mission
        function startMission(mission) {
            missionModalTitle.textContent = `Mission: ${mission.title}`;
            missionModalBody.innerHTML = '';
            
            // Reset mission state
            gameState.currentMissionQuestion = 0;
            gameState.selectedAnswers = mission.questions ? new Array(mission.questions.length).fill(null) : [];
            
            // Create mission content
            const missionContent = document.createElement('div');
            
            // Mission objective
            const objectiveDiv = document.createElement('div');
            objectiveDiv.className = 'mission-objective';
            objectiveDiv.innerHTML = `
                <div class="objective-title">Mission Objective</div>
                <p>${mission.description}</p>
                <ul class="task-list">
                    ${mission.tasks ? mission.tasks.map(task => `<li class="task-item"><i class="fas fa-circle" style="font-size: 0.5rem;"></i> ${task}</li>`).join('') : ''}
                </ul>
            `;
            missionContent.appendChild(objectiveDiv);
            
            // Mission questions
            if (mission.questions && mission.questions.length > 0) {
                loadMissionQuestion(mission, 0, missionContent);
                
                // Mission controls
                const controlsDiv = document.createElement('div');
                controlsDiv.className = 'mission-controls';
                controlsDiv.innerHTML = `
                    <button class="btn btn-primary" id="next-question-btn" disabled>Next Question (1/${mission.questions.length})</button>
                    <button class="btn btn-secondary" id="mission-close-btn">Cancel</button>
                `;
                missionContent.appendChild(controlsDiv);
                
                // Add event listener for close button
                setTimeout(() => {
                    document.getElementById('mission-close-btn').addEventListener('click', () => {
                        missionModal.classList.remove('active');
                    });
                }, 100);
            } else {
                // For missions without questions
                const noQuestionsDiv = document.createElement('div');
                noQuestionsDiv.className = 'mission-question';
                noQuestionsDiv.innerHTML = `
                    <p>This mission content is under development. Check back soon!</p>
                `;
                missionContent.appendChild(noQuestionsDiv);
                
                const controlsDiv = document.createElement('div');
                controlsDiv.className = 'mission-controls';
                controlsDiv.innerHTML = `
                    <button class="btn btn-secondary" id="mission-close-btn">Close</button>
                `;
                missionContent.appendChild(controlsDiv);
                
                setTimeout(() => {
                    document.getElementById('mission-close-btn').addEventListener('click', () => {
                        missionModal.classList.remove('active');
                    });
                }, 100);
            }
            
            missionModalBody.appendChild(missionContent);
            missionModal.classList.add('active');
        }

        // Load mission question
        function loadMissionQuestion(mission, questionIndex, container) {
            const question = mission.questions[questionIndex];
            const questionDiv = document.createElement('div');
            questionDiv.className = 'mission-question';
            questionDiv.setAttribute('data-index', questionIndex);
            
            questionDiv.innerHTML = `
                <div class="question-text">${question.question}</div>
                <div class="options-grid">
                    ${question.options.map((option, index) => `
                        <button class="option-btn" data-option="${index}">${option}</button>
                    `).join('')}
                </div>
            `;
            
            // Clear previous question and add new one
            const existingQuestion = container.querySelector('.mission-question');
            if (existingQuestion) {
                existingQuestion.remove();
            }
            
            // Insert after objective
            const objectiveDiv = container.querySelector('.mission-objective');
            objectiveDiv.insertAdjacentElement('afterend', questionDiv);
            
            // Update next button text
            const nextBtn = document.getElementById('next-question-btn');
            if (nextBtn) {
                if (questionIndex === mission.questions.length - 1) {
                    nextBtn.textContent = `Submit Mission (${questionIndex + 1}/${mission.questions.length})`;
                    nextBtn.id = 'submit-mission';
                } else {
                    nextBtn.textContent = `Next Question (${questionIndex + 1}/${mission.questions.length})`;
                    nextBtn.id = 'next-question-btn';
                }
                nextBtn.disabled = true;
            }
        }

        // Select answer in mission
        function selectMissionAnswer(questionIndex, optionIndex) {
            const questionDiv = document.querySelector(`.mission-question[data-index="${questionIndex}"]`);
            if (!questionDiv) return;
            
            questionDiv.querySelectorAll('.option-btn').forEach(btn => {
                btn.classList.remove('selected');
            });
            
            const selectedBtn = questionDiv.querySelector(`.option-btn[data-option="${optionIndex}"]`);
            if (selectedBtn) {
                selectedBtn.classList.add('selected');
                
                gameState.selectedAnswers[questionIndex] = optionIndex;
                
                const mission = missions.find(m => m.active);
                if (mission && mission.questions) {
                    const nextBtn = document.getElementById(questionIndex === mission.questions.length - 1 ? 'submit-mission' : 'next-question-btn');
                    if (nextBtn) {
                        nextBtn.disabled = false;
                    }
                }
            }
        }

        // Next mission question
        function nextMissionQuestion() {
            const mission = missions.find(m => m.active);
            if (!mission || !mission.questions) return;
            
            gameState.currentMissionQuestion++;
            
            if (gameState.currentMissionQuestion < mission.questions.length) {
                const missionContent = document.getElementById('mission-modal-body');
                loadMissionQuestion(mission, gameState.currentMissionQuestion, missionContent);
            }
        }

        // Submit mission answers
        function submitMissionAnswers() {
            const mission = missions.find(m => m.active);
            if (!mission || !mission.questions) return;
            
            // Check if all questions are answered
            for (let i = 0; i < mission.questions.length; i++) {
                if (gameState.selectedAnswers[i] === null) {
                    showNotification(`Please answer question ${i + 1} before submitting.`, "Incomplete Mission");
                    return;
                }
            }
            
            let correctAnswers = 0;
            const questions = mission.questions;
            
            // Check answers
            for (let i = 0; i < questions.length; i++) {
                const question = questions[i];
                const userAnswer = gameState.selectedAnswers[i];
                const isCorrect = userAnswer === question.correct;
                
                if (isCorrect) correctAnswers++;
                
                // Show correct/incorrect for each option
                const questionDiv = document.querySelector(`.mission-question[data-index="${i}"]`);
                if (questionDiv) {
                    questionDiv.querySelectorAll('.option-btn').forEach(btn => {
                        const optionIndex = parseInt(btn.getAttribute('data-option'));
                        
                        if (optionIndex === question.correct) {
                            btn.classList.add('correct');
                        } else if (optionIndex === userAnswer && !isCorrect) {
                            btn.classList.add('incorrect');
                        }
                        
                        btn.disabled = true;
                    });
                }
            }
            
            // Calculate score
            const scorePercent = (correctAnswers / questions.length) * 100;
            const xpEarned = Math.floor((scorePercent / 100) * mission.xp);
            
            // Update mission content with results
            const missionContent = document.getElementById('mission-modal-body');
            const resultsDiv = document.createElement('div');
            resultsDiv.className = 'mission-question';
            resultsDiv.innerHTML = `
                <h3>Mission Results</h3>
                <p>You got ${correctAnswers} out of ${questions.length} questions correct (${scorePercent.toFixed(0)}%)</p>
                <p>XP Earned: ${xpEarned}</p>
                ${scorePercent >= 70 ? 
                    `<p class="success" style="color: var(--success); font-weight: bold;">Mission Successful!</p>
                     <p>The mission window will close in 3 seconds...</p>` : 
                    `<p class="warning" style="color: var(--warning);">You need at least 70% to complete the mission. Try again!</p>`
                }
            `;
            
            missionContent.appendChild(resultsDiv);
            
            // Remove old controls
            const oldControls = missionContent.querySelector('.mission-controls');
            if (oldControls) oldControls.remove();
            
            if (scorePercent >= 70) {
                // Complete the mission immediately
                completeMission(mission.id, xpEarned, scorePercent === 100);
                
                // Auto-close modal after 3 seconds
                setTimeout(() => {
                    missionModal.classList.remove('active');
                }, 3000);
            } else {
                // Failed - show retry button
                const controlsDiv = document.createElement('div');
                controlsDiv.className = 'mission-controls';
                controlsDiv.innerHTML = `
                    <button class="btn btn-primary" id="retry-mission-btn">Retry Mission</button>
                    <button class="btn btn-secondary" id="mission-close-btn">Close</button>
                `;
                missionContent.appendChild(controlsDiv);
                
                setTimeout(() => {
                    document.getElementById('retry-mission-btn').addEventListener('click', () => {
                        startMission(mission);
                    });
                    document.getElementById('mission-close-btn').addEventListener('click', () => {
                        missionModal.classList.remove('active');
                    });
                }, 100);
            }
        }

        // Complete a mission
        function completeMission(missionId, xpEarned, perfectScore = false) {
            const mission = missions.find(m => m.id === missionId);
            if (!mission || mission.completed) return;
            
            // Update mission state
            mission.completed = true;
            mission.active = false;
            
            // Update game state
            gameState.xp += xpEarned;
            gameState.completedMissions++;
            gameState.gamesPlayed++;
            
            // Award badge for first mission
            if (missionId === 1) {
                awardBadge(1);
                showNotification(`First mission completed! You earned ${xpEarned} XP and unlocked the "First Mission" badge!`, "Mission Complete");
            } else {
                showNotification(`Mission "${mission.title}" completed! You earned ${xpEarned} XP.`, "Mission Complete");
            }
            
            // Find and unlock the next mission in the chain
            const currentIndex = missions.findIndex(m => m.id === missionId);
            if (currentIndex + 1 < missions.length) {
                const nextMission = missions[currentIndex + 1];
                nextMission.locked = false;
                nextMission.active = true;
                
                // Show notification about next mission
                setTimeout(() => {
                    showNotification(`New mission unlocked: "${nextMission.title}"`, "Mission Unlocked");
                }, 1500);
            }
            
            // Update UI
            updateStats();
            loadDashboardMissions();
            loadAllMissions();
            
            // Auto-save after mission completion
            saveGame();
        }

        // Start a mini-game
        function startMiniGame(gameType) {
            const game = gameData[gameType];
            if (!game) {
                showNotification("Game not found!", "Error");
                return;
            }
            
            gameModalTitle.textContent = game.title;
            gameModalBody.innerHTML = '';
            
            // Create game content based on type
            switch(gameType) {
                case 'phishing':
                    startPhishingGame();
                    break;
                case 'password':
                    startPasswordGame();
                    break;
                case 'url':
                    startURLGame();
                    break;
                case 'firewall':
                    startFirewallGame();
                    break;
                case 'hash':
                    startHashGame();
                    break;
                case 'network':
                    startNetworkGame();
                    break;
                case 'encryption':
                    startEncryptionGame();
                    break;
                case 'social':
                    startSocialGame();
                    break;
                case 'incident':
                    startIncidentGame();
                    break;
                case 'forensics':
                    startForensicsGame();
                    break;
                default:
                    gameModalBody.innerHTML = `<p>Game type "${gameType}" is not implemented yet.</p>`;
            }
            
            gameModal.classList.add('active');
        }

        // Phishing Hunter Game
        function startPhishingGame() {
            const emails = gameData.phishing.emails;
            let currentEmail = 0;
            let score = 0;
            const totalEmails = emails.length;
            
            function loadEmail() {
                if (currentEmail >= totalEmails) {
                    // Game completed
                    const xpEarned = Math.floor((score / totalEmails) * 100);
                    const perfect = score === totalEmails;
                    
                    gameModalBody.innerHTML = `
                        <div class="mission-objective">
                            <div class="objective-title">Game Results</div>
                            <p>You identified ${score} out of ${totalEmails} emails correctly!</p>
                            <p>XP Earned: ${xpEarned}</p>
                            ${perfect ? 
                                `<p style="color: var(--success); font-weight: bold;">Perfect Score! You've earned the Phishing Hunter badge!</p>` : 
                                `<p>Try again for a perfect score!</p>`
                            }
                        </div>
                        <div class="mission-controls">
                            <button class="btn btn-primary" id="play-again-btn">Play Again</button>
                            <button class="btn btn-secondary" id="close-game-btn">Close</button>
                        </div>
                    `;
                    
                    // Update game state
                    gameState.gamesPlayed++;
                    gameState.xp += xpEarned;
                    gameState.gameScores.phishing = { played: true, score: score, perfect: perfect };
                    
                    if (perfect) {
                        awardBadge(2);
                    }
                    
                    // Auto-save after game
                    saveGame();
                    
                    setTimeout(() => {
                        document.getElementById('play-again-btn').addEventListener('click', startPhishingGame);
                        document.getElementById('close-game-btn').addEventListener('click', () => {
                            gameModal.classList.remove('active');
                            updateStats();
                        });
                    }, 100);
                    
                    return;
                }
                
                const email = emails[currentEmail];
                
                gameModalBody.innerHTML = `
                    <div class="mission-objective">
                        <div class="objective-title">Email ${currentEmail + 1} of ${totalEmails}</div>
                        <p>Is this email legitimate or a phishing attempt?</p>
                    </div>
                    
                    <div class="mission-question">
                        <div class="question-text">
                            <strong>From:</strong> ${email.from}<br>
                            <strong>Subject:</strong> ${email.subject}<br><br>
                            ${email.body}
                        </div>
                    </div>
                    
                    <div class="mission-controls">
                        <button class="btn btn-primary" id="legitimate-btn">Legitimate Email</button>
                        <button class="btn btn-danger" id="phishing-btn" style="background-color: rgba(255, 0, 60, 0.2); color: var(--danger); border-color: var(--danger);">Phishing Attempt</button>
                    </div>
                    
                    <div style="text-align: center; margin-top: 1rem;">
                        <p>Score: ${score}/${currentEmail}</p>
                    </div>
                `;
                
                setTimeout(() => {
                    document.getElementById('legitimate-btn').addEventListener('click', () => {
                        if (!email.isPhishing) {
                            score++;
                            showNotification("Correct! This is a legitimate email.", "Good Job!");
                        } else {
                            showNotification("Incorrect! This is a phishing attempt.", "Try Again!");
                        }
                        currentEmail++;
                        setTimeout(loadEmail, 1000);
                    });
                    
                    document.getElementById('phishing-btn').addEventListener('click', () => {
                        if (email.isPhishing) {
                            score++;
                            showNotification("Correct! This is a phishing attempt.", "Good Job!");
                        } else {
                            showNotification("Incorrect! This is a legitimate email.", "Try Again!");
                        }
                        currentEmail++;
                        setTimeout(loadEmail, 1000);
                    });
                }, 100);
            }
            
            loadEmail();
        }

        // Password Cracker Game
        function startPasswordGame() {
            const challenges = gameData.password.challenges;
            let currentChallenge = 0;
            let score = 0;
            const totalChallenges = challenges.length;
            
            function loadChallenge() {
                if (currentChallenge >= totalChallenges) {
                    // Game completed
                    const xpEarned = Math.floor((score / totalChallenges) * 150);
                    const perfect = score === totalChallenges;
                    
                    gameModalBody.innerHTML = `
                        <div class="mission-objective">
                            <div class="objective-title">Game Results</div>
                            <p>You answered ${score} out of ${totalChallenges} questions correctly!</p>
                            <p>XP Earned: ${xpEarned}</p>
                            ${perfect ? 
                                `<p style="color: var(--success); font-weight: bold;">Perfect Score! You've earned the Password Master badge!</p>` : 
                                `<p>Try again for a perfect score!</p>`
                            }
                        </div>
                        <div class="mission-controls">
                            <button class="btn btn-primary" id="play-again-btn">Play Again</button>
                            <button class="btn btn-secondary" id="close-game-btn">Close</button>
                        </div>
                    `;
                    
                    // Update game state
                    gameState.gamesPlayed++;
                    gameState.xp += xpEarned;
                    gameState.gameScores.password = { played: true, score: score, perfect: perfect };
                    
                    if (perfect) {
                        awardBadge(3);
                    }
                    
                    // Auto-save after game
                    saveGame();
                    
                    setTimeout(() => {
                        document.getElementById('play-again-btn').addEventListener('click', startPasswordGame);
                        document.getElementById('close-game-btn').addEventListener('click', () => {
                            gameModal.classList.remove('active');
                            updateStats();
                        });
                    }, 100);
                    
                    return;
                }
                
                const challenge = challenges[currentChallenge];
                
                gameModalBody.innerHTML = `
                    <div class="mission-objective">
                        <div class="objective-title">Question ${currentChallenge + 1} of ${totalChallenges}</div>
                        <p>${challenge.question}</p>
                    </div>
                    
                    <div class="mission-question">
                        <div class="options-grid">
                            ${challenge.options.map((option, index) => `
                                <button class="option-btn" data-option="${index}">${option}</button>
                            `).join('')}
                        </div>
                    </div>
                    
                    <div class="mission-controls">
                        <button class="btn btn-primary" id="submit-answer-btn" disabled>Submit Answer</button>
                    </div>
                    
                    <div style="text-align: center; margin-top: 1rem;">
                        <p>Score: ${score}/${currentChallenge}</p>
                    </div>
                `;
                
                setTimeout(() => {
                    let selectedAnswer = null;
                    
                    // Add click listeners to options
                    document.querySelectorAll('.option-btn').forEach(btn => {
                        btn.addEventListener('click', () => {
                            document.querySelectorAll('.option-btn').forEach(b => b.classList.remove('selected'));
                            btn.classList.add('selected');
                            selectedAnswer = parseInt(btn.getAttribute('data-option'));
                            document.getElementById('submit-answer-btn').disabled = false;
                        });
                    });
                    
                    // Submit answer
                    document.getElementById('submit-answer-btn').addEventListener('click', () => {
                        if (selectedAnswer === challenge.correct) {
                            score++;
                            showNotification("Correct! " + challenge.explanation, "Well Done!");
                        } else {
                            showNotification("Incorrect. " + challenge.explanation, "Try Again!");
                        }
                        
                        // Show correct answer
                        document.querySelectorAll('.option-btn').forEach((btn, index) => {
                            if (index === challenge.correct) {
                                btn.classList.add('correct');
                            } else if (index === selectedAnswer && index !== challenge.correct) {
                                btn.classList.add('incorrect');
                            }
                            btn.disabled = true;
                        });
                        
                        document.getElementById('submit-answer-btn').disabled = true;
                        
                        // Move to next question after delay
                        setTimeout(() => {
                            currentChallenge++;
                            loadChallenge();
                        }, 2000);
                    });
                }, 100);
            }
            
            loadChallenge();
        }

        // URL Decoder Game
        function startURLGame() {
            const challenges = gameData.url.challenges;
            let currentChallenge = 0;
            let score = 0;
            const totalChallenges = challenges.length;
            
            function loadChallenge() {
                if (currentChallenge >= totalChallenges) {
                    // Game completed
                    const xpEarned = Math.floor((score / totalChallenges) * 125);
                    const perfect = score === totalChallenges;
                    
                    gameModalBody.innerHTML = `
                        <div class="mission-objective">
                            <div class="objective-title">Game Results</div>
                            <p>You identified ${score} out of ${totalChallenges} URLs correctly!</p>
                            <p>XP Earned: ${xpEarned}</p>
                            ${perfect ? 
                                `<p style="color: var(--success); font-weight: bold;">Perfect Score! You've earned the URL Analyst badge!</p>` : 
                                `<p>Try again for a perfect score!</p>`
                            }
                        </div>
                        <div class="mission-controls">
                            <button class="btn btn-primary" id="play-again-btn">Play Again</button>
                            <button class="btn btn-secondary" id="close-game-btn">Close</button>
                        </div>
                    `;
                    
                    // Update game state
                    gameState.gamesPlayed++;
                    gameState.xp += xpEarned;
                    gameState.gameScores.url = { played: true, score: score, perfect: perfect };
                    
                    if (perfect) {
                        awardBadge(4);
                    }
                    
                    // Auto-save after game
                    saveGame();
                    
                    setTimeout(() => {
                        document.getElementById('play-again-btn').addEventListener('click', startURLGame);
                        document.getElementById('close-game-btn').addEventListener('click', () => {
                            gameModal.classList.remove('active');
                            updateStats();
                        });
                    }, 100);
                    
                    return;
                }
                
                const challenge = challenges[currentChallenge];
                
                gameModalBody.innerHTML = `
                    <div class="mission-objective">
                        <div class="objective-title">URL ${currentChallenge + 1} of ${totalChallenges}</div>
                        <p>Is this URL safe or malicious?</p>
                    </div>
                    
                    <div class="mission-question">
                        <div class="question-text">
                            <strong>URL:</strong> ${challenge.url}<br><br>
                            <strong>Analysis:</strong> ${challenge.analysis}
                        </div>
                    </div>
                    
                    <div class="mission-controls">
                        <button class="btn btn-primary" id="safe-btn">Safe URL</button>
                        <button class="btn btn-danger" id="malicious-btn" style="background-color: rgba(255, 0, 60, 0.2); color: var(--danger); border-color: var(--danger);">Malicious URL</button>
                    </div>
                    
                    <div style="text-align: center; margin-top: 1rem;">
                        <p>Score: ${score}/${currentChallenge}</p>
                    </div>
                `;
                
                setTimeout(() => {
                    document.getElementById('safe-btn').addEventListener('click', () => {
                        if (!challenge.isMalicious) {
                            score++;
                            showNotification("Correct! This URL is safe.", "Good Job!");
                        } else {
                            showNotification("Incorrect! This URL is malicious.", "Try Again!");
                        }
                        currentChallenge++;
                        setTimeout(loadChallenge, 1000);
                    });
                    
                    document.getElementById('malicious-btn').addEventListener('click', () => {
                        if (challenge.isMalicious) {
                            score++;
                            showNotification("Correct! This URL is malicious.", "Good Job!");
                        } else {
                            showNotification("Incorrect! This URL is safe.", "Try Again!");
                        }
                        currentChallenge++;
                        setTimeout(loadChallenge, 1000);
                    });
                }, 100);
            }
            
            loadChallenge();
        }

        // Firewall Builder Game (Drag and Drop)
        function startFirewallGame() {
            const rules = [...gameData.firewall.rules];
            let shuffledRules = [...rules].sort(() => Math.random() - 0.5);
            let droppedRules = [];
            
            gameModalBody.innerHTML = `
                <div class="mission-objective">
                    <div class="objective-title">Firewall Builder</div>
                    <p>Drag firewall rules from the left to the right drop zone in the correct order. Rules should block attacks first while allowing legitimate traffic.</p>
                </div>
                
                <div class="drag-drop-container">
                    <div class="drag-source" id="drag-source">
                        <h4>Available Rules</h4>
                        ${shuffledRules.map(rule => `
                            <div class="drag-item" data-id="${rule.id}" draggable="true">
                                ${rule.text}
                            </div>
                        `).join('')}
                    </div>
                    
                    <div class="drop-target" id="drop-target">
                        <h4>Firewall Rule Order</h4>
                        <p>Drop rules here in correct order</p>
                    </div>
                </div>
                
                <div class="mission-controls">
                    <button class="btn btn-primary" id="check-firewall-btn">Check Order</button>
                    <button class="btn btn-secondary" id="reset-firewall-btn">Reset Game</button>
                </div>
            `;
            
            // Setup drag and drop
            const dragItems = document.querySelectorAll('.drag-item');
            const dropTarget = document.getElementById('drop-target');
            
            dragItems.forEach(item => {
                item.addEventListener('dragstart', (e) => {
                    e.dataTransfer.setData('text/plain', e.target.getAttribute('data-id'));
                    e.target.classList.add('dragging');
                });
                
                item.addEventListener('dragend', (e) => {
                    e.target.classList.remove('dragging');
                });
            });
            
            dropTarget.addEventListener('dragover', (e) => {
                e.preventDefault();
                dropTarget.classList.add('drag-over');
            });
            
            dropTarget.addEventListener('dragleave', () => {
                dropTarget.classList.remove('drag-over');
            });
            
            dropTarget.addEventListener('drop', (e) => {
                e.preventDefault();
                dropTarget.classList.remove('drag-over');
                
                const ruleId = e.dataTransfer.getData('text/plain');
                const draggedItem = document.querySelector(`.drag-item[data-id="${ruleId}"]`);
                
                if (draggedItem) {
                    // Remove from source
                    draggedItem.remove();
                    
                    // Add to drop target
                    const newItem = draggedItem.cloneNode(true);
                    newItem.classList.remove('dragging');
                    newItem.draggable = false;
                    dropTarget.appendChild(newItem);
                    
                    // Track dropped rules
                    droppedRules.push(parseInt(ruleId));
                }
            });
            
            // Check order button
            document.getElementById('check-firewall-btn').addEventListener('click', () => {
                // Check if all rules are placed
                if (droppedRules.length !== rules.length) {
                    showNotification("Please place all firewall rules in the drop zone.", "Incomplete");
                    return;
                }
                
                // Check order
                let correct = 0;
                for (let i = 0; i < droppedRules.length; i++) {
                    const rule = rules.find(r => r.id === droppedRules[i]);
                    if (rule && rule.correctPosition === i + 1) {
                        correct++;
                    }
                }
                
                const score = correct;
                const perfect = score === rules.length;
                const xpEarned = Math.floor((score / rules.length) * 200);
                
                // Show results
                const resultsDiv = document.createElement('div');
                resultsDiv.className = 'mission-question';
                resultsDiv.innerHTML = `
                    <h3>Firewall Configuration Results</h3>
                    <p>You placed ${correct} out of ${rules.length} rules in the correct position!</p>
                    <p>XP Earned: ${xpEarned}</p>
                    ${perfect ? 
                        `<p style="color: var(--success); font-weight: bold;">Perfect Score! You've earned the Firewall Expert badge!</p>` : 
                        `<p>The correct order is: ${rules.sort((a, b) => a.correctPosition - b.correctPosition).map(r => r.text).join(' → ')}</p>`
                    }
                `;
                
                gameModalBody.appendChild(resultsDiv);
                
                // Update game state
                gameState.gamesPlayed++;
                gameState.xp += xpEarned;
                gameState.gameScores.firewall = { played: true, score: score, perfect: perfect };
                
                if (perfect) {
                    awardBadge(5);
                }
                
                // Auto-save after game
                saveGame();
                
                // Disable check button
                document.getElementById('check-firewall-btn').disabled = true;
            });
            
            // Reset button
            document.getElementById('reset-firewall-btn').addEventListener('click', startFirewallGame);
        }

        // Hash Match Game
        function startHashGame() {
            const pairs = gameData.hash.pairs;
            let selectedPlain = null;
            let selectedHash = null;
            let matchedPairs = 0;
            let attempts = 0;
            
            // Shuffle pairs
            const shuffledPairs = [...pairs].sort(() => Math.random() - 0.5);
            const plainTexts = shuffledPairs.map(p => p.plain);
            const hashes = shuffledPairs.map(p => p.hash).sort(() => Math.random() - 0.5);
            
            gameModalBody.innerHTML = `
                <div class="mission-objective">
                    <div class="objective-title">Hash Match Game</div>
                    <p>Click on a plain text and its matching hash value. Match all pairs to win!</p>
                </div>
                
                <div class="hash-pairs">
                    <div>
                        <h4>Plain Text</h4>
                        ${plainTexts.map((text, index) => `
                            <div class="hash-item" data-type="plain" data-index="${index}">${text}</div>
                        `).join('')}
                    </div>
                    <div>
                        <h4>Hash Values</h4>
                        ${hashes.map((hash, index) => `
                            <div class="hash-item" data-type="hash" data-index="${index}">${hash}</div>
                        `).join('')}
                    </div>
                </div>
                
                <div class="mission-controls">
                    <button class="btn btn-primary" id="check-match-btn" disabled>Check Match</button>
                    <button class="btn btn-secondary" id="reset-hash-btn">Reset Game</button>
                </div>
                
                <div style="text-align: center; margin-top: 1rem;">
                    <p>Matched: ${matchedPairs}/${pairs.length} | Attempts: ${attempts}</p>
                </div>
            `;
            
            // Hash item click handlers
            const hashItems = document.querySelectorAll('.hash-item');
            
            hashItems.forEach(item => {
                item.addEventListener('click', () => {
                    const type = item.getAttribute('data-type');
                    const index = item.getAttribute('data-index');
                    
                    // Deselect all items of same type
                    document.querySelectorAll(`.hash-item[data-type="${type}"]`).forEach(i => {
                        i.classList.remove('selected');
                    });
                    
                    // Select this item
                    item.classList.add('selected');
                    
                    if (type === 'plain') {
                        selectedPlain = { text: plainTexts[index], originalIndex: shuffledPairs.findIndex(p => p.plain === plainTexts[index]) };
                    } else {
                        selectedHash = { hash: hashes[index] };
                    }
                    
                    // Enable check button if both selected
                    if (selectedPlain && selectedHash) {
                        document.getElementById('check-match-btn').disabled = false;
                    }
                });
            });
            
            // Check match button
            document.getElementById('check-match-btn').addEventListener('click', () => {
                attempts++;
                
                // Find the original pair for the selected plain text
                const originalPair = shuffledPairs[selectedPlain.originalIndex];
                
                if (selectedHash.hash === originalPair.hash) {
                    // Correct match
                    showNotification("Correct match! The hash values match.", "Good Job!");
                    
                    // Mark both items as matched
                    document.querySelectorAll(`.hash-item[data-type="plain"][data-index="${selectedPlain.originalIndex}"], .hash-item[data-type="hash"]`).forEach(item => {
                        if (item.textContent === selectedPlain.text || item.textContent === selectedHash.hash) {
                            item.classList.add('matched');
                            item.classList.remove('selected');
                            item.style.cursor = 'default';
                        }
                    });
                    
                    matchedPairs++;
                    
                    // Update score display
                    document.querySelector('div:last-child p').textContent = `Matched: ${matchedPairs}/${pairs.length} | Attempts: ${attempts}`;
                    
                    // Check if game completed
                    if (matchedPairs === pairs.length) {
                        const xpEarned = Math.floor((pairs.length / (attempts + pairs.length)) * 180);
                        const perfect = attempts === pairs.length;
                        
                        const resultsDiv = document.createElement('div');
                        resultsDiv.className = 'mission-question';
                        resultsDiv.innerHTML = `
                            <h3>Game Complete!</h3>
                            <p>You matched all ${pairs.length} hash pairs in ${attempts} attempts!</p>
                            <p>XP Earned: ${xpEarned}</p>
                            ${perfect ? 
                                `<p style="color: var(--success); font-weight: bold;">Perfect Score! You've earned the Hash Matcher badge!</p>` : 
                                `<p>Great job! Try for a perfect score next time.</p>`
                            }
                        `;
                        
                        gameModalBody.appendChild(resultsDiv);
                        
                        // Update game state
                        gameState.gamesPlayed++;
                        gameState.xp += xpEarned;
                        gameState.gameScores.hash = { played: true, score: matchedPairs, perfect: perfect };
                        
                        if (perfect) {
                            awardBadge(6);
                        }
                        
                        // Auto-save after game
                        saveGame();
                        
                        document.getElementById('check-match-btn').disabled = true;
                    }
                } else {
                    // Incorrect match
                    showNotification("Incorrect match. Try again!", "No Match");
                    
                    // Deselect items
                    document.querySelectorAll('.hash-item').forEach(item => {
                        item.classList.remove('selected');
                    });
                    
                    selectedPlain = null;
                    selectedHash = null;
                }
                
                document.getElementById('check-match-btn').disabled = true;
            });
            
            // Reset button
            document.getElementById('reset-hash-btn').addEventListener('click', startHashGame);
        }

        // Network Scanner Game
        function startNetworkGame() {
            // Function to randomize vulnerable devices each game
            function getRandomizedDevices() {
                // Copy the original devices
                const devices = JSON.parse(JSON.stringify(gameData.network.devices));
                
                // Randomly select 3 devices to be vulnerable (out of 5)
                const vulnerableIndices = new Set();
                while (vulnerableIndices.size < 3) {
                    const randomIndex = Math.floor(Math.random() * devices.length);
                    vulnerableIndices.add(randomIndex);
                }
                
                // Set vulnerability status
                devices.forEach((device, index) => {
                    device.vulnerable = vulnerableIndices.has(index);
                    device.scanned = false; // Reset scanned status
                    device.fixed = false; // Reset fixed status
                });
                
                // Shuffle the order of devices
                for (let i = devices.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [devices[i], devices[j]] = [devices[j], devices[i]];
                }
                
                return devices;
            }
            
            // Initialize game state
            let devices = getRandomizedDevices();
            let scannedDevices = 0;
            let vulnerableFound = 0;
            let fixedDevices = 0;
            const totalVulnerable = devices.filter(d => d.vulnerable).length;
            let selectedDevice = null;
            
            // Create initial game UI
            gameModalBody.innerHTML = `
                <div class="mission-objective">
                    <div class="objective-title">Network Scanner</div>
                    <p>Click on network devices to scan them. All devices look the same initially. You need to scan each device to discover if it's vulnerable.</p>
                    <p>Vulnerable devices: ${totalVulnerable}</p>
                </div>
                
                <div class="network-map" id="network-map">
                    ${devices.map(device => `
                        <div class="network-node" data-id="${device.id}">
                            <i class="fas fa-${device.type === 'server' ? 'server' : device.type === 'database' ? 'database' : device.type === 'network' ? 'router' : 'desktop'}"></i>
                            <h4>${device.name}</h4>
                            <p id="status-${device.id}">Status: Unknown</p>
                        </div>
                    `).join('')}
                </div>
                
                <div id="device-info" style="margin: 1rem 0; padding: 1rem; background: rgba(0,0,0,0.3); border-radius: 8px; display: none;">
                    <h4 id="device-info-title">Device Information</h4>
                    <p id="device-info-desc"></p>
                    <p><strong>Open Ports:</strong> <span id="device-ports"></span></p>
                    <p><strong>Status:</strong> <span id="device-status">Unknown</span></p>
                </div>
                
                <div class="mission-controls">
                    <button class="btn btn-primary" id="scan-device-btn">Scan Device</button>
                    <button class="btn btn-danger" id="fix-vulnerable-btn" disabled>Fix Vulnerable Device</button>
                    <button class="btn btn-secondary" id="reset-network-btn">Reset Game</button>
                </div>
                
                <div style="text-align: center; margin-top: 1rem;">
                    <p>Scanned: <span id="scanned-count">0</span>/${devices.length} | Vulnerabilities Fixed: <span id="fixed-count">0</span>/${totalVulnerable}</p>
                </div>
            `;
            
            // Device click handlers
            const deviceNodes = document.querySelectorAll('.network-node');
            const deviceInfoDiv = document.getElementById('device-info');
            const deviceInfoTitle = document.getElementById('device-info-title');
            const deviceInfoDesc = document.getElementById('device-info-desc');
            const devicePorts = document.getElementById('device-ports');
            const deviceStatus = document.getElementById('device-status');
            const scannedCount = document.getElementById('scanned-count');
            const fixedCount = document.getElementById('fixed-count');
            const scanDeviceBtn = document.getElementById('scan-device-btn');
            const fixVulnerableBtn = document.getElementById('fix-vulnerable-btn');
            
            deviceNodes.forEach(node => {
                node.addEventListener('click', () => {
                    // Remove selection from all nodes
                    deviceNodes.forEach(n => n.classList.remove('selected'));
                    
                    // Select this node
                    node.classList.add('selected');
                    const deviceId = parseInt(node.getAttribute('data-id'));
                    selectedDevice = devices.find(d => d.id === deviceId);
                    
                    // Show device info
                    if (selectedDevice) {
                        deviceInfoDiv.style.display = 'block';
                        deviceInfoTitle.textContent = selectedDevice.name;
                        deviceInfoDesc.textContent = selectedDevice.description;
                        devicePorts.textContent = selectedDevice.ports.join(', ');
                        
                        // Show status based on whether device has been scanned
                        if (selectedDevice.scanned) {
                            if (selectedDevice.vulnerable) {
                                deviceStatus.textContent = 'VULNERABLE - Needs fixing!';
                                deviceStatus.style.color = 'var(--danger)';
                            } else {
                                deviceStatus.textContent = 'SECURE';
                                deviceStatus.style.color = 'var(--success)';
                            }
                        } else {
                            deviceStatus.textContent = 'Not Scanned Yet';
                            deviceStatus.style.color = '#a0aec0';
                        }
                        
                        // Enable appropriate buttons
                        scanDeviceBtn.disabled = false;
                        fixVulnerableBtn.disabled = !selectedDevice.vulnerable || selectedDevice.fixed;
                    }
                });
            });
            
            // Scan device button
            scanDeviceBtn.addEventListener('click', () => {
                if (!selectedDevice) {
                    showNotification("Please select a device first!", "No Device Selected");
                    return;
                }
                
                // Mark as scanned if not already
                if (!selectedDevice.scanned) {
                    selectedDevice.scanned = true;
                    scannedDevices++;
                    scannedCount.textContent = scannedDevices;
                    
                    // Update node appearance based on vulnerability
                    const node = document.querySelector(`.network-node[data-id="${selectedDevice.id}"]`);
                    const statusElement = document.getElementById(`status-${selectedDevice.id}`);
                    
                    if (selectedDevice.vulnerable) {
                        node.classList.add('vulnerable');
                        statusElement.textContent = 'Status: VULNERABLE';
                        statusElement.style.color = 'var(--danger)';
                        vulnerableFound++;
                        
                        showNotification(`VULNERABILITY DETECTED on ${selectedDevice.name}!`, "Security Alert!");
                    } else {
                        node.classList.add('secure');
                        statusElement.textContent = 'Status: SECURE';
                        statusElement.style.color = 'var(--success)';
                        
                        showNotification(`${selectedDevice.name} is secure.`, "Scan Complete");
                    }
                    
                    // Update device info status
                    if (selectedDevice.vulnerable) {
                        deviceStatus.textContent = 'VULNERABLE - Needs fixing!';
                        deviceStatus.style.color = 'var(--danger)';
                    } else {
                        deviceStatus.textContent = 'SECURE';
                        deviceStatus.style.color = 'var(--success)';
                    }
                    
                    // Enable fix button if vulnerable
                    fixVulnerableBtn.disabled = !selectedDevice.vulnerable;
                } else {
                    showNotification(`${selectedDevice.name} already scanned.`, "Already Scanned");
                }
            });
            
            // Fix vulnerable button
            fixVulnerableBtn.addEventListener('click', () => {
                if (!selectedDevice || !selectedDevice.vulnerable || selectedDevice.fixed) {
                    showNotification("This device is not vulnerable or already fixed.", "Cannot Fix");
                    return;
                }
                
                // Fix the vulnerability
                selectedDevice.vulnerable = false;
                selectedDevice.fixed = true;
                fixedDevices++;
                fixedCount.textContent = fixedDevices;
                
                // Update node appearance
                const node = document.querySelector(`.network-node[data-id="${selectedDevice.id}"]`);
                node.classList.remove('vulnerable');
                node.classList.add('secure');
                
                const statusElement = document.getElementById(`status-${selectedDevice.id}`);
                statusElement.textContent = 'Status: SECURE (Fixed)';
                statusElement.style.color = 'var(--success)';
                
                // Update device info
                deviceStatus.textContent = 'SECURE (Fixed)';
                deviceStatus.style.color = 'var(--success)';
                
                // Disable fix button
                fixVulnerableBtn.disabled = true;
                
                showNotification(`Vulnerability fixed on ${selectedDevice.name}!`, "Device Secured");
                
                // Check if all vulnerabilities are fixed
                if (fixedDevices === totalVulnerable) {
                    // Game completed successfully
                    const xpEarned = 250;
                    const perfect = true;
                    
                    // Update game state
                    gameState.gamesPlayed++;
                    gameState.xp += xpEarned;
                    gameState.gameScores.network = { played: true, score: totalVulnerable, perfect: perfect };
                    
                    // Award badge
                    awardBadge(7);
                    
                    // Auto-save after game
                    saveGame();
                    
                    // Update stats
                    updateStats();
                    
                    // Show success message
                    const resultsDiv = document.createElement('div');
                    resultsDiv.className = 'mission-question';
                    resultsDiv.innerHTML = `
                        <h3>Network Secured!</h3>
                        <p>🎉 You successfully identified and fixed all ${totalVulnerable} vulnerable devices!</p>
                        <p>XP Earned: ${xpEarned}</p>
                        <p style="color: var(--success); font-weight: bold;">Perfect Score! You've earned the Network Defender badge!</p>
                        <p>Game window will close in 3 seconds...</p>
                    `;
                    
                    gameModalBody.appendChild(resultsDiv);
                    
                    // Disable all buttons
                    scanDeviceBtn.disabled = true;
                    fixVulnerableBtn.disabled = true;
                    
                    // Auto-close modal after 3 seconds
                    setTimeout(() => {
                        gameModal.classList.remove('active');
                    }, 3000);
                }
            });
            
            // Reset button - starts a completely new game with new randomization
            document.getElementById('reset-network-btn').addEventListener('click', startNetworkGame);
        }

        // Encryption Challenge Game
        function startEncryptionGame() {
            const questions = gameData.encryption.questions;
            let currentQuestion = 0;
            let score = 0;
            const totalQuestions = questions.length;
            
            function loadQuestion() {
                if (currentQuestion >= totalQuestions) {
                    // Game completed
                    const xpEarned = Math.floor((score / totalQuestions) * 175);
                    const perfect = score === totalQuestions;
                    
                    gameModalBody.innerHTML = `
                        <div class="mission-objective">
                            <div class="objective-title">Game Results</div>
                            <p>You answered ${score} out of ${totalQuestions} questions correctly!</p>
                            <p>XP Earned: ${xpEarned}</p>
                            ${perfect ? 
                                `<p style="color: var(--success); font-weight: bold;">Perfect Score! You've earned the Encryption Guru badge!</p>` : 
                                `<p>Try again for a perfect score!</p>`
                            }
                        </div>
                        <div class="mission-controls">
                            <button class="btn btn-primary" id="play-again-btn">Play Again</button>
                            <button class="btn btn-secondary" id="close-game-btn">Close</button>
                        </div>
                    `;
                    
                    // Update game state
                    gameState.gamesPlayed++;
                    gameState.xp += xpEarned;
                    gameState.gameScores.encryption = { played: true, score: score, perfect: perfect };
                    
                    if (perfect) {
                        awardBadge(8);
                    }
                    
                    // Auto-save after game
                    saveGame();
                    
                    setTimeout(() => {
                        document.getElementById('play-again-btn').addEventListener('click', startEncryptionGame);
                        document.getElementById('close-game-btn').addEventListener('click', () => {
                            gameModal.classList.remove('active');
                            updateStats();
                        });
                    }, 100);
                    
                    return;
                }
                
                const question = questions[currentQuestion];
                
                gameModalBody.innerHTML = `
                    <div class="mission-objective">
                        <div class="objective-title">Question ${currentQuestion + 1} of ${totalQuestions}</div>
                        <p>${question.question}</p>
                    </div>
                    
                    <div class="mission-question">
                        <div class="options-grid">
                            ${question.options.map((option, index) => `
                                <button class="option-btn" data-option="${index}">${option}</button>
                            `).join('')}
                        </div>
                    </div>
                    
                    <div class="mission-controls">
                        <button class="btn btn-primary" id="submit-answer-btn" disabled>Submit Answer</button>
                    </div>
                    
                    <div style="text-align: center; margin-top: 1rem;">
                        <p>Score: ${score}/${currentQuestion}</p>
                    </div>
                `;
                
                setTimeout(() => {
                    let selectedAnswer = null;
                    
                    // Add click listeners to options
                    document.querySelectorAll('.option-btn').forEach(btn => {
                        btn.addEventListener('click', () => {
                            document.querySelectorAll('.option-btn').forEach(b => b.classList.remove('selected'));
                            btn.classList.add('selected');
                            selectedAnswer = parseInt(btn.getAttribute('data-option'));
                            document.getElementById('submit-answer-btn').disabled = false;
                        });
                    });
                    
                    // Submit answer
                    document.getElementById('submit-answer-btn').addEventListener('click', () => {
                        if (selectedAnswer === question.correct) {
                            score++;
                            showNotification("Correct! " + question.explanation, "Well Done!");
                        } else {
                            showNotification("Incorrect. " + question.explanation, "Try Again!");
                        }
                        
                        // Show correct answer
                        document.querySelectorAll('.option-btn').forEach((btn, index) => {
                            if (index === question.correct) {
                                btn.classList.add('correct');
                            } else if (index === selectedAnswer && index !== question.correct) {
                                btn.classList.add('incorrect');
                            }
                            btn.disabled = true;
                        });
                        
                        document.getElementById('submit-answer-btn').disabled = true;
                        
                        // Move to next question after delay
                        setTimeout(() => {
                            currentQuestion++;
                            loadQuestion();
                        }, 2000);
                    });
                }, 100);
            }
            
            loadQuestion();
        }

        // Social Engineering Quiz
        function startSocialGame() {
            const questions = gameData.social.questions;
            let currentQuestion = 0;
            let score = 0;
            const totalQuestions = questions.length;
            
            function loadQuestion() {
                if (currentQuestion >= totalQuestions) {
                    // Game completed
                    const xpEarned = Math.floor((score / totalQuestions) * 160);
                    const perfect = score === totalQuestions;
                    
                    gameModalBody.innerHTML = `
                        <div class="mission-objective">
                            <div class="objective-title">Game Results</div>
                            <p>You answered ${score} out of ${totalQuestions} questions correctly!</p>
                            <p>XP Earned: ${xpEarned}</p>
                            ${perfect ? 
                                `<p style="color: var(--success); font-weight: bold;">Perfect Score! You've earned the Social Engineer badge!</p>` : 
                                `<p>Try again for a perfect score!</p>`
                            }
                        </div>
                        <div class="mission-controls">
                            <button class="btn btn-primary" id="play-again-btn">Play Again</button>
                            <button class="btn btn-secondary" id="close-game-btn">Close</button>
                        </div>
                    `;
                    
                    // Update game state
                    gameState.gamesPlayed++;
                    gameState.xp += xpEarned;
                    gameState.gameScores.social = { played: true, score: score, perfect: perfect };
                    
                    if (perfect) {
                        awardBadge(9);
                    }
                    
                    // Auto-save after game
                    saveGame();
                    
                    setTimeout(() => {
                        document.getElementById('play-again-btn').addEventListener('click', startSocialGame);
                        document.getElementById('close-game-btn').addEventListener('click', () => {
                            gameModal.classList.remove('active');
                            updateStats();
                        });
                    }, 100);
                    
                    return;
                }
                
                const question = questions[currentQuestion];
                
                gameModalBody.innerHTML = `
                    <div class="mission-objective">
                        <div class="objective-title">Question ${currentQuestion + 1} of ${totalQuestions}</div>
                        <p>${question.question}</p>
                    </div>
                    
                    <div class="mission-question">
                        <div class="options-grid">
                            ${question.options.map((option, index) => `
                                <button class="option-btn" data-option="${index}">${option}</button>
                            `).join('')}
                        </div>
                    </div>
                    
                    <div class="mission-controls">
                        <button class="btn btn-primary" id="submit-answer-btn" disabled>Submit Answer</button>
                    </div>
                    
                    <div style="text-align: center; margin-top: 1rem;">
                        <p>Score: ${score}/${currentQuestion}</p>
                    </div>
                `;
                
                setTimeout(() => {
                    let selectedAnswer = null;
                    
                    // Add click listeners to options
                    document.querySelectorAll('.option-btn').forEach(btn => {
                        btn.addEventListener('click', () => {
                            document.querySelectorAll('.option-btn').forEach(b => b.classList.remove('selected'));
                            btn.classList.add('selected');
                            selectedAnswer = parseInt(btn.getAttribute('data-option'));
                            document.getElementById('submit-answer-btn').disabled = false;
                        });
                    });
                    
                    // Submit answer
                    document.getElementById('submit-answer-btn').addEventListener('click', () => {
                        if (selectedAnswer === question.correct) {
                            score++;
                            showNotification("Correct! " + question.explanation, "Well Done!");
                        } else {
                            showNotification("Incorrect. " + question.explanation, "Try Again!");
                        }
                        
                        // Show correct answer
                        document.querySelectorAll('.option-btn').forEach((btn, index) => {
                            if (index === question.correct) {
                                btn.classList.add('correct');
                            } else if (index === selectedAnswer && index !== question.correct) {
                                btn.classList.add('incorrect');
                            }
                            btn.disabled = true;
                        });
                        
                        document.getElementById('submit-answer-btn').disabled = true;
                        
                        // Move to next question after delay
                        setTimeout(() => {
                            currentQuestion++;
                            loadQuestion();
                        }, 2000);
                    });
                }, 100);
            }
            
            loadQuestion();
        }

        // Incident Response Game
        function startIncidentGame() {
            const scenarios = gameData.incident.scenarios;
            let currentScenario = 0;
            let score = 0;
            
            function loadScenario() {
                if (currentScenario >= scenarios.length) {
                    // Game completed
                    const xpEarned = Math.floor((score / 2) * 200); // 2 scenarios
                    const perfect = score === 2;
                    
                    gameModalBody.innerHTML = `
                        <div class="mission-objective">
                            <div class="objective-title">Game Results</div>
                            <p>You completed ${score} out of ${scenarios.length} scenarios correctly!</p>
                            <p>XP Earned: ${xpEarned}</p>
                            ${perfect ? 
                                `<p style="color: var(--success); font-weight: bold;">Perfect Score! You've earned the Incident Responder badge!</p>` : 
                                `<p>Try again for a perfect score!</p>`
                            }
                        </div>
                        <div class="mission-controls">
                            <button class="btn btn-primary" id="play-again-btn">Play Again</button>
                            <button class="btn btn-secondary" id="close-game-btn">Close</button>
                        </div>
                    `;
                    
                    // Update game state
                    gameState.gamesPlayed++;
                    gameState.xp += xpEarned;
                    gameState.gameScores.incident = { played: true, score: score, perfect: perfect };
                    
                    if (perfect) {
                        awardBadge(10);
                    }
                    
                    // Auto-save after game
                    saveGame();
                    
                    setTimeout(() => {
                        document.getElementById('play-again-btn').addEventListener('click', startIncidentGame);
                        document.getElementById('close-game-btn').addEventListener('click', () => {
                            gameModal.classList.remove('active');
                            updateStats();
                        });
                    }, 100);
                    
                    return;
                }
                
                const scenario = scenarios[currentScenario];
                const shuffledSteps = [...scenario.steps].sort(() => Math.random() - 0.5);
                
                gameModalBody.innerHTML = `
                    <div class="mission-objective">
                        <div class="objective-title">Scenario ${currentScenario + 1} of ${scenarios.length}</div>
                        <p>${scenario.scenario}</p>
                        <p>Drag the steps into the correct incident response order:</p>
                    </div>
                    
                    <div class="drag-drop-container">
                        <div class="drag-source" id="drag-source">
                            <h4>Available Steps</h4>
                            ${shuffledSteps.map((step, index) => `
                                <div class="drag-item" data-index="${index}" draggable="true">
                                    ${step}
                                </div>
                            `).join('')}
                        </div>
                        
                        <div class="drop-target" id="drop-target">
                            <h4>Correct Order</h4>
                            <p>Drop steps here in correct sequence</p>
                        </div>
                    </div>
                    
                    <div class="mission-controls">
                        <button class="btn btn-primary" id="check-order-btn">Check Order</button>
                        <button class="btn btn-secondary" id="reset-scenario-btn">Reset</button>
                    </div>
                `;
                
                // Setup drag and drop
                const dragItems = document.querySelectorAll('.drag-item');
                const dropTarget = document.getElementById('drop-target');
                let droppedSteps = [];
                
                dragItems.forEach(item => {
                    item.addEventListener('dragstart', (e) => {
                        e.dataTransfer.setData('text/plain', e.target.getAttribute('data-index'));
                        e.target.classList.add('dragging');
                    });
                    
                    item.addEventListener('dragend', (e) => {
                        e.target.classList.remove('dragging');
                    });
                });
                
                dropTarget.addEventListener('dragover', (e) => {
                    e.preventDefault();
                    dropTarget.classList.add('drag-over');
                });
                
                dropTarget.addEventListener('dragleave', () => {
                    dropTarget.classList.remove('drag-over');
                });
                
                dropTarget.addEventListener('drop', (e) => {
                    e.preventDefault();
                    dropTarget.classList.remove('drag-over');
                    
                    const stepIndex = e.dataTransfer.getData('text/plain');
                    const draggedItem = document.querySelector(`.drag-item[data-index="${stepIndex}"]`);
                    
                    if (draggedItem) {
                        // Remove from source
                        draggedItem.remove();
                        
                        // Add to drop target
                        const newItem = draggedItem.cloneNode(true);
                        newItem.classList.remove('dragging');
                        newItem.draggable = false;
                        dropTarget.appendChild(newItem);
                        
                        // Track dropped steps
                        droppedSteps.push(parseInt(stepIndex));
                    }
                });
                
                // Check order button
                document.getElementById('check-order-btn').addEventListener('click', () => {
                    // Check if all steps are placed
                    if (droppedSteps.length !== scenario.steps.length) {
                        showNotification("Please place all steps in the correct order.", "Incomplete");
                        return;
                    }
                    
                    // Check order
                    let correct = 0;
                    for (let i = 0; i < droppedSteps.length; i++) {
                        if (scenario.correctOrder[i] === droppedSteps[i]) {
                            correct++;
                        }
                    }
                    
                    const isPerfect = correct === scenario.steps.length;
                    
                    // Show results
                    const resultsDiv = document.createElement('div');
                    resultsDiv.className = 'mission-question';
                    
                    if (isPerfect) {
                        resultsDiv.innerHTML = `
                            <h3>Correct!</h3>
                            <p>You placed all steps in the correct incident response order!</p>
                            <p>Correct sequence: ${scenario.steps.join(' → ')}</p>
                        `;
                        score++;
                    } else {
                        resultsDiv.innerHTML = `
                            <h3>Incorrect Order</h3>
                            <p>You placed ${correct} out of ${scenario.steps.length} steps correctly.</p>
                            <p>Correct sequence: ${scenario.steps.join(' → ')}</p>
                        `;
                    }
                    
                    gameModalBody.appendChild(resultsDiv);
                    
                    // Disable check button
                    document.getElementById('check-order-btn').disabled = true;
                    
                    // Move to next scenario after delay
                    setTimeout(() => {
                        currentScenario++;
                        loadScenario();
                    }, 3000);
                });
                
                // Reset button
                document.getElementById('reset-scenario-btn').addEventListener('click', loadScenario);
            }
            
            loadScenario();
        }

        // Digital Forensics Game
        function startForensicsGame() {
            const puzzles = gameData.forensics.puzzles;
            let currentPuzzle = 0;
            let score = 0;
            const totalPuzzles = puzzles.length;
            
            function loadPuzzle() {
                if (currentPuzzle >= totalPuzzles) {
                    // Game completed
                    const xpEarned = Math.floor((score / totalPuzzles) * 190);
                    const perfect = score === totalPuzzles;
                    
                    gameModalBody.innerHTML = `
                        <div class="mission-objective">
                            <div class="objective-title">Game Results</div>
                            <p>You solved ${score} out of ${totalPuzzles} forensic puzzles correctly!</p>
                            <p>XP Earned: ${xpEarned}</p>
                            ${perfect ? 
                                `<p style="color: var(--success); font-weight: bold;">Perfect Score! You've earned the Digital Detective badge!</p>` : 
                                `<p>Try again for a perfect score!</p>`
                            }
                        </div>
                        <div class="mission-controls">
                            <button class="btn btn-primary" id="play-again-btn">Play Again</button>
                            <button class="btn btn-secondary" id="close-game-btn">Close</button>
                        </div>
                    `;
                    
                    // Update game state
                    gameState.gamesPlayed++;
                    gameState.xp += xpEarned;
                    gameState.gameScores.forensics = { played: true, score: score, perfect: perfect };
                    
                    if (perfect) {
                        awardBadge(11);
                    }
                    
                    // Auto-save after game
                    saveGame();
                    
                    setTimeout(() => {
                        document.getElementById('play-again-btn').addEventListener('click', startForensicsGame);
                        document.getElementById('close-game-btn').addEventListener('click', () => {
                            gameModal.classList.remove('active');
                            updateStats();
                        });
                    }, 100);
                    
                    return;
                }
                
                const puzzle = puzzles[currentPuzzle];
                
                gameModalBody.innerHTML = `
                    <div class="mission-objective">
                        <div class="objective-title">Forensic Puzzle ${currentPuzzle + 1} of ${totalPuzzles}</div>
                        <p><strong>Evidence:</strong> ${puzzle.evidence}</p>
                        <p><strong>Question:</strong> ${puzzle.question}</p>
                    </div>
                    
                    <div class="mission-question">
                        <div class="options-grid">
                            ${puzzle.options.map((option, index) => `
                                <button class="option-btn" data-option="${index}">${option}</button>
                            `).join('')}
                        </div>
                    </div>
                    
                    <div class="mission-controls">
                        <button class="btn btn-primary" id="submit-answer-btn" disabled>Submit Answer</button>
                    </div>
                    
                    <div style="text-align: center; margin-top: 1rem;">
                        <p>Solved: ${score}/${currentPuzzle}</p>
                    </div>
                `;
                
                setTimeout(() => {
                    let selectedAnswer = null;
                    
                    // Add click listeners to options
                    document.querySelectorAll('.option-btn').forEach(btn => {
                        btn.addEventListener('click', () => {
                            document.querySelectorAll('.option-btn').forEach(b => b.classList.remove('selected'));
                            btn.classList.add('selected');
                            selectedAnswer = parseInt(btn.getAttribute('data-option'));
                            document.getElementById('submit-answer-btn').disabled = false;
                        });
                    });
                    
                    // Submit answer
                    document.getElementById('submit-answer-btn').addEventListener('click', () => {
                        if (selectedAnswer === puzzle.correct) {
                            score++;
                            showNotification("Correct! " + puzzle.explanation, "Well Done!");
                        } else {
                            showNotification("Incorrect. " + puzzle.explanation, "Try Again!");
                        }
                        
                        // Show correct answer
                        document.querySelectorAll('.option-btn').forEach((btn, index) => {
                            if (index === puzzle.correct) {
                                btn.classList.add('correct');
                            } else if (index === selectedAnswer && index !== puzzle.correct) {
                                btn.classList.add('incorrect');
                            }
                            btn.disabled = true;
                        });
                        
                        document.getElementById('submit-answer-btn').disabled = true;
                        
                        // Move to next puzzle after delay
                        setTimeout(() => {
                            currentPuzzle++;
                            loadPuzzle();
                        }, 2000);
                    });
                }, 100);
            }
            
            loadPuzzle();
        }

        // Award a badge
        function awardBadge(badgeId) {
            const badge = badges.find(b => b.id === badgeId);
            if (badge && !badge.earned) {
                badge.earned = true;
                gameState.badges++;
                showNotification(`Congratulations! You earned the "${badge.name}" badge!`, "Badge Earned");
                loadBadges();
                
                // Auto-save when badge is earned
                saveGame();
            }
        }

        // Check for badge achievements
        function checkBadges() {
            // Mission completion badges
            if (gameState.completedMissions >= 5) {
                awardBadge(12);
            }
            
            if (gameState.completedMissions === missions.length) {
                awardBadge(22);
            }
            
            // XP badges
            if (gameState.xp >= 5000) awardBadge(16);
            if (gameState.xp >= 25000) awardBadge(24);
            
            // Level badge
            if (gameState.level >= 10) awardBadge(17);
            
            // Count perfect games
            const perfectGames = Object.values(gameState.gameScores).filter(score => score.perfect).length;
            if (perfectGames >= 5) awardBadge(15);
            if (perfectGames === 10) awardBadge(23);
            
            // Count games played
            const gamesPlayed = Object.values(gameState.gameScores).filter(score => score.played).length;
            if (gamesPlayed === 10) awardBadge(14);
        }

        // Load badges
        function loadBadges() {
            badgesGrid.innerHTML = '';
            
            badges.forEach(badge => {
                const badgeDiv = document.createElement('div');
                badgeDiv.className = `badge ${badge.earned ? 'earned' : ''}`;
                badgeDiv.innerHTML = `
                    <i class="${badge.icon} badge-icon"></i>
                    <div class="badge-title">${badge.name}</div>
                    <div class="badge-description">${badge.description}</div>
                `;
                badgesGrid.appendChild(badgeDiv);
            });
        }

        // Save profile name
        function saveProfileName(name) {
            if (name.trim()) {
                gameState.agentName = name.trim();
                updateStats();
                
                const input = document.querySelector('.profile-name-input');
                if (input) {
                    const nameDisplay = document.createElement('h2');
                    nameDisplay.className = 'profile-name';
                    nameDisplay.textContent = gameState.agentName;
                    nameDisplay.addEventListener('click', () => {
                        const currentName = nameDisplay.textContent;
                        const input = document.createElement('input');
                        input.type = 'text';
                        input.value = currentName;
                        input.className = 'profile-name-input';
                        
                        input.addEventListener('blur', () => {
                            saveProfileName(input.value);
                        });
                        
                        input.addEventListener('keypress', (e) => {
                            if (e.key === 'Enter') {
                                saveProfileName(input.value);
                            }
                        });
                        
                        nameDisplay.replaceWith(input);
                        input.focus();
                    });
                    
                    input.replaceWith(nameDisplay);
                }
                
                // Auto-save when profile name changes
                saveGame();
            }
        }

        // Load profile data
        function loadProfileData() {
            document.getElementById('profile-title').textContent = gameState.currentRank;
            updateRankProgression();
        }

        // Update certificate button
        function updateCertificateButton() {
            if (gameState.certificateEarned) {
                viewCertificateBtn.disabled = false;
                viewCertificateBtn.innerHTML = '<i class="fas fa-certificate"></i> View Certificate';
            } else {
                viewCertificateBtn.disabled = true;
                viewCertificateBtn.innerHTML = '<i class="fas fa-lock"></i> Certificate Locked';
            }
        }

        // Show certificate
        function showCertificate() {
            if (!gameState.certificateEarned) return;
            
            // Update certificate details
            certificateName.textContent = gameState.agentName;
            certificateDate.textContent = new Date().toLocaleDateString('en-US', {
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });
            certificateId.textContent = `CG-${new Date().getFullYear()}-${String(gameState.xp).padStart(6, '0')}`;
            
            certificateModal.classList.add('active');
        }

        // Download certificate as PDF
        async function downloadCertificate() {
            const certificate = document.getElementById('certificate');
            
            try {
                // Use html2canvas to capture the certificate
                const canvas = await html2canvas(certificate, {
                    scale: 2,
                    backgroundColor: '#0a0e17'
                });
                
                const imgData = canvas.toDataURL('image/png');
                
                // Use jsPDF to create PDF
                const { jsPDF } = window.jspdf;
                const pdf = new jsPDF('l', 'mm', 'a4');
                const pdfWidth = pdf.internal.pageSize.getWidth();
                const pdfHeight = pdf.internal.pageSize.getHeight();
                
                // Calculate dimensions to fit certificate in PDF
                const imgWidth = canvas.width;
                const imgHeight = canvas.height;
                const ratio = Math.min(pdfWidth / imgWidth, pdfHeight / imgHeight);
                const imgX = (pdfWidth - imgWidth * ratio) / 2;
                const imgY = (pdfHeight - imgHeight * ratio) / 2;
                
                pdf.addImage(imgData, 'PNG', imgX, imgY, imgWidth * ratio, imgHeight * ratio);
                pdf.save(`Cybersecurity_Certificate_${gameState.agentName.replace(/\s+/g, '_')}.pdf`);
                
                showNotification("Certificate downloaded successfully!", "Download Complete");
            } catch (error) {
                console.error("Error downloading certificate:", error);
                showNotification("Error downloading certificate. Please try again.", "Error");
            }
        }

        // Load learning hub content
        function loadLearningContent(topicId) {
            const content = learningContent[topicId];
            if (content) {
                hubTitle.textContent = content.title;
                hubContent.innerHTML = content.content;
            } else {
                hubTitle.textContent = "Topic Not Found";
                hubContent.innerHTML = "<p>Content for this topic is not available yet. Check back soon!</p>";
            }
        }

        // Show notification
        function showNotification(message, title = "Notification") {
            notificationTitle.textContent = title;
            notificationMessage.textContent = message;
            
            notification.classList.add('show');
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, 5000);
        }

        // Initialize the game when page loads
        window.addEventListener('DOMContentLoaded', initGame);
    </script>
</body>
</html>
